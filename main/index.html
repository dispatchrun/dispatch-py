
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.9">
    
    
      
        <title>Dispatch SDK</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.f2e4d321.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dispatch-python-sdk" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="Dispatch SDK" class="md-header__button md-logo" aria-label="Dispatch SDK" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Dispatch SDK
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Dispatch Python SDK
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch mode based on system preference"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch mode based on system preference" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Dispatch SDK" class="md-nav__button md-logo" aria-label="Dispatch SDK" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Dispatch SDK
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Dispatch Python SDK
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Dispatch Python SDK
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      API Reference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch" class="md-nav__link">
    <span class="md-ellipsis">
      dispatch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.DispatchID" class="md-nav__link">
    <span class="md-ellipsis">
      DispatchID
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.Call" class="md-nav__link">
    <span class="md-ellipsis">
      Call
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.Client" class="md-nav__link">
    <span class="md-ellipsis">
      Client
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Client">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.Client.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.Client.dispatch" class="md-nav__link">
    <span class="md-ellipsis">
      dispatch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.Error" class="md-nav__link">
    <span class="md-ellipsis">
      Error
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.Error.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.Error.from_exception" class="md-nav__link">
    <span class="md-ellipsis">
      from_exception
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.Input" class="md-nav__link">
    <span class="md-ellipsis">
      Input
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Input">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.Input.input_arguments" class="md-nav__link">
    <span class="md-ellipsis">
      input_arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.Output" class="md-nav__link">
    <span class="md-ellipsis">
      Output
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Output">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.Output.error" class="md-nav__link">
    <span class="md-ellipsis">
      error
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.Output.exit" class="md-nav__link">
    <span class="md-ellipsis">
      exit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.Output.poll" class="md-nav__link">
    <span class="md-ellipsis">
      poll
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.Output.tail_call" class="md-nav__link">
    <span class="md-ellipsis">
      tail_call
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.Output.value" class="md-nav__link">
    <span class="md-ellipsis">
      value
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.Status" class="md-nav__link">
    <span class="md-ellipsis">
      Status
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.poll" class="md-nav__link">
    <span class="md-ellipsis">
      poll
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.client" class="md-nav__link">
    <span class="md-ellipsis">
      client
    </span>
  </a>
  
    <nav class="md-nav" aria-label="client">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.client.Client" class="md-nav__link">
    <span class="md-ellipsis">
      Client
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Client">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.client.Client.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.client.Client.dispatch" class="md-nav__link">
    <span class="md-ellipsis">
      dispatch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.coroutine" class="md-nav__link">
    <span class="md-ellipsis">
      coroutine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="coroutine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.coroutine.CoroutineState" class="md-nav__link">
    <span class="md-ellipsis">
      CoroutineState
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.coroutine.exit" class="md-nav__link">
    <span class="md-ellipsis">
      exit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.coroutine.poll" class="md-nav__link">
    <span class="md-ellipsis">
      poll
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.coroutine.schedule" class="md-nav__link">
    <span class="md-ellipsis">
      schedule
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.experimental" class="md-nav__link">
    <span class="md-ellipsis">
      experimental
    </span>
  </a>
  
    <nav class="md-nav" aria-label="experimental">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable" class="md-nav__link">
    <span class="md-ellipsis">
      durable
    </span>
  </a>
  
    <nav class="md-nav" aria-label="durable">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.durable" class="md-nav__link">
    <span class="md-ellipsis">
      durable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.frame" class="md-nav__link">
    <span class="md-ellipsis">
      frame
    </span>
  </a>
  
    <nav class="md-nav" aria-label="frame">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.frame.__file__" class="md-nav__link">
    <span class="md-ellipsis">
      __file__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.frame.__name__" class="md-nav__link">
    <span class="md-ellipsis">
      __name__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.frame.__package__" class="md-nav__link">
    <span class="md-ellipsis">
      __package__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.frame.get_frame_ip" class="md-nav__link">
    <span class="md-ellipsis">
      get_frame_ip
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.frame.get_frame_sp" class="md-nav__link">
    <span class="md-ellipsis">
      get_frame_sp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.frame.get_frame_stack_at" class="md-nav__link">
    <span class="md-ellipsis">
      get_frame_stack_at
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.frame.get_frame_state" class="md-nav__link">
    <span class="md-ellipsis">
      get_frame_state
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.frame.set_frame_ip" class="md-nav__link">
    <span class="md-ellipsis">
      set_frame_ip
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.frame.set_frame_sp" class="md-nav__link">
    <span class="md-ellipsis">
      set_frame_sp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.frame.set_frame_stack_at" class="md-nav__link">
    <span class="md-ellipsis">
      set_frame_stack_at
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.frame.set_frame_state" class="md-nav__link">
    <span class="md-ellipsis">
      set_frame_state
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.function" class="md-nav__link">
    <span class="md-ellipsis">
      function
    </span>
  </a>
  
    <nav class="md-nav" aria-label="function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.function.DurableCoroutine" class="md-nav__link">
    <span class="md-ellipsis">
      DurableCoroutine
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.function.DurableFunction" class="md-nav__link">
    <span class="md-ellipsis">
      DurableFunction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.function.DurableGenerator" class="md-nav__link">
    <span class="md-ellipsis">
      DurableGenerator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.function.durable" class="md-nav__link">
    <span class="md-ellipsis">
      durable
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.registry" class="md-nav__link">
    <span class="md-ellipsis">
      registry
    </span>
  </a>
  
    <nav class="md-nav" aria-label="registry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.registry.RegisteredFunction" class="md-nav__link">
    <span class="md-ellipsis">
      RegisteredFunction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.registry.lookup_function" class="md-nav__link">
    <span class="md-ellipsis">
      lookup_function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.registry.register_function" class="md-nav__link">
    <span class="md-ellipsis">
      register_function
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.serializable" class="md-nav__link">
    <span class="md-ellipsis">
      serializable
    </span>
  </a>
  
    <nav class="md-nav" aria-label="serializable">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.serializable.Serializable" class="md-nav__link">
    <span class="md-ellipsis">
      Serializable
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor" class="md-nav__link">
    <span class="md-ellipsis">
      multicolor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="multicolor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.CustomYield" class="md-nav__link">
    <span class="md-ellipsis">
      CustomYield
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.GeneratorYield" class="md-nav__link">
    <span class="md-ellipsis">
      GeneratorYield
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.NoSourceError" class="md-nav__link">
    <span class="md-ellipsis">
      NoSourceError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.compile_function" class="md-nav__link">
    <span class="md-ellipsis">
      compile_function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.no_yields" class="md-nav__link">
    <span class="md-ellipsis">
      no_yields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.compile" class="md-nav__link">
    <span class="md-ellipsis">
      compile
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.compile.CallTransformer" class="md-nav__link">
    <span class="md-ellipsis">
      CallTransformer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.compile.FunctionColor" class="md-nav__link">
    <span class="md-ellipsis">
      FunctionColor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.compile.GeneratorTransformer" class="md-nav__link">
    <span class="md-ellipsis">
      GeneratorTransformer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.compile.compile_function" class="md-nav__link">
    <span class="md-ellipsis">
      compile_function
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.desugar" class="md-nav__link">
    <span class="md-ellipsis">
      desugar
    </span>
  </a>
  
    <nav class="md-nav" aria-label="desugar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.desugar.Desugar" class="md-nav__link">
    <span class="md-ellipsis">
      Desugar
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.desugar.desugar_function" class="md-nav__link">
    <span class="md-ellipsis">
      desugar_function
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.generator" class="md-nav__link">
    <span class="md-ellipsis">
      generator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="generator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.generator.YieldCounter" class="md-nav__link">
    <span class="md-ellipsis">
      YieldCounter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.generator.empty_generator" class="md-nav__link">
    <span class="md-ellipsis">
      empty_generator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.generator.is_generator" class="md-nav__link">
    <span class="md-ellipsis">
      is_generator
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.parse" class="md-nav__link">
    <span class="md-ellipsis">
      parse
    </span>
  </a>
  
    <nav class="md-nav" aria-label="parse">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.parse.NoSourceError" class="md-nav__link">
    <span class="md-ellipsis">
      NoSourceError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.parse.parse_function" class="md-nav__link">
    <span class="md-ellipsis">
      parse_function
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.template" class="md-nav__link">
    <span class="md-ellipsis">
      template
    </span>
  </a>
  
    <nav class="md-nav" aria-label="template">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.template.NameTransformer" class="md-nav__link">
    <span class="md-ellipsis">
      NameTransformer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.template.rewrite_template" class="md-nav__link">
    <span class="md-ellipsis">
      rewrite_template
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.yields" class="md-nav__link">
    <span class="md-ellipsis">
      yields
    </span>
  </a>
  
    <nav class="md-nav" aria-label="yields">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.yields.CustomYield" class="md-nav__link">
    <span class="md-ellipsis">
      CustomYield
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.yields.GeneratorYield" class="md-nav__link">
    <span class="md-ellipsis">
      GeneratorYield
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.yields.YieldType" class="md-nav__link">
    <span class="md-ellipsis">
      YieldType
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.yields.no_yields" class="md-nav__link">
    <span class="md-ellipsis">
      no_yields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.yields.yields" class="md-nav__link">
    <span class="md-ellipsis">
      yields
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.fastapi" class="md-nav__link">
    <span class="md-ellipsis">
      fastapi
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fastapi">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.fastapi.Dispatch" class="md-nav__link">
    <span class="md-ellipsis">
      Dispatch
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dispatch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.fastapi.Dispatch.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.function" class="md-nav__link">
    <span class="md-ellipsis">
      function
    </span>
  </a>
  
    <nav class="md-nav" aria-label="function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.function.PrimitiveFunctionType" class="md-nav__link">
    <span class="md-ellipsis">
      PrimitiveFunctionType
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.function.Function" class="md-nav__link">
    <span class="md-ellipsis">
      Function
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.function.Function.call_with" class="md-nav__link">
    <span class="md-ellipsis">
      call_with
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.function.Function.dispatch" class="md-nav__link">
    <span class="md-ellipsis">
      dispatch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.function.Function.primitive_call_with" class="md-nav__link">
    <span class="md-ellipsis">
      primitive_call_with
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.function.Function.primitive_dispatch" class="md-nav__link">
    <span class="md-ellipsis">
      primitive_dispatch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.function.Registry" class="md-nav__link">
    <span class="md-ellipsis">
      Registry
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Registry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.function.Registry.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.function.Registry.coroutine" class="md-nav__link">
    <span class="md-ellipsis">
      coroutine
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.function.Registry.function" class="md-nav__link">
    <span class="md-ellipsis">
      function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.function.Registry.primitive_function" class="md-nav__link">
    <span class="md-ellipsis">
      primitive_function
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.id" class="md-nav__link">
    <span class="md-ellipsis">
      id
    </span>
  </a>
  
    <nav class="md-nav" aria-label="id">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.id.DispatchID" class="md-nav__link">
    <span class="md-ellipsis">
      DispatchID
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.integrations" class="md-nav__link">
    <span class="md-ellipsis">
      integrations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="integrations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.integrations.http" class="md-nav__link">
    <span class="md-ellipsis">
      http
    </span>
  </a>
  
    <nav class="md-nav" aria-label="http">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.integrations.http.http_response_code_status" class="md-nav__link">
    <span class="md-ellipsis">
      http_response_code_status
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.integrations.httpx" class="md-nav__link">
    <span class="md-ellipsis">
      httpx
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.integrations.requests" class="md-nav__link">
    <span class="md-ellipsis">
      requests
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.proto" class="md-nav__link">
    <span class="md-ellipsis">
      proto
    </span>
  </a>
  
    <nav class="md-nav" aria-label="proto">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.proto.Call" class="md-nav__link">
    <span class="md-ellipsis">
      Call
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.proto.CallResult" class="md-nav__link">
    <span class="md-ellipsis">
      CallResult
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.proto.Error" class="md-nav__link">
    <span class="md-ellipsis">
      Error
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.proto.Error.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.proto.Error.from_exception" class="md-nav__link">
    <span class="md-ellipsis">
      from_exception
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.proto.Input" class="md-nav__link">
    <span class="md-ellipsis">
      Input
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Input">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.proto.Input.input_arguments" class="md-nav__link">
    <span class="md-ellipsis">
      input_arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.proto.Output" class="md-nav__link">
    <span class="md-ellipsis">
      Output
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Output">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.proto.Output.error" class="md-nav__link">
    <span class="md-ellipsis">
      error
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.proto.Output.exit" class="md-nav__link">
    <span class="md-ellipsis">
      exit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.proto.Output.poll" class="md-nav__link">
    <span class="md-ellipsis">
      poll
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.proto.Output.tail_call" class="md-nav__link">
    <span class="md-ellipsis">
      tail_call
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.proto.Output.value" class="md-nav__link">
    <span class="md-ellipsis">
      value
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.sdk" class="md-nav__link">
    <span class="md-ellipsis">
      sdk
    </span>
  </a>
  
    <nav class="md-nav" aria-label="sdk">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1" class="md-nav__link">
    <span class="md-ellipsis">
      v1
    </span>
  </a>
  
    <nav class="md-nav" aria-label="v1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.call_pb2" class="md-nav__link">
    <span class="md-ellipsis">
      call_pb2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.call_pb2_grpc" class="md-nav__link">
    <span class="md-ellipsis">
      call_pb2_grpc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.dispatch_pb2" class="md-nav__link">
    <span class="md-ellipsis">
      dispatch_pb2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.dispatch_pb2_grpc" class="md-nav__link">
    <span class="md-ellipsis">
      dispatch_pb2_grpc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dispatch_pb2_grpc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.dispatch_pb2_grpc.DispatchService" class="md-nav__link">
    <span class="md-ellipsis">
      DispatchService
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.dispatch_pb2_grpc.DispatchServiceServicer" class="md-nav__link">
    <span class="md-ellipsis">
      DispatchServiceServicer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DispatchServiceServicer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.dispatch_pb2_grpc.DispatchServiceServicer.Dispatch" class="md-nav__link">
    <span class="md-ellipsis">
      Dispatch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.dispatch_pb2_grpc.DispatchServiceStub" class="md-nav__link">
    <span class="md-ellipsis">
      DispatchServiceStub
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DispatchServiceStub">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.dispatch_pb2_grpc.DispatchServiceStub.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.error_pb2" class="md-nav__link">
    <span class="md-ellipsis">
      error_pb2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.error_pb2_grpc" class="md-nav__link">
    <span class="md-ellipsis">
      error_pb2_grpc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.exit_pb2" class="md-nav__link">
    <span class="md-ellipsis">
      exit_pb2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.exit_pb2_grpc" class="md-nav__link">
    <span class="md-ellipsis">
      exit_pb2_grpc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.function_pb2" class="md-nav__link">
    <span class="md-ellipsis">
      function_pb2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.function_pb2_grpc" class="md-nav__link">
    <span class="md-ellipsis">
      function_pb2_grpc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="function_pb2_grpc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.function_pb2_grpc.FunctionService" class="md-nav__link">
    <span class="md-ellipsis">
      FunctionService
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.function_pb2_grpc.FunctionServiceServicer" class="md-nav__link">
    <span class="md-ellipsis">
      FunctionServiceServicer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FunctionServiceServicer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.function_pb2_grpc.FunctionServiceServicer.Run" class="md-nav__link">
    <span class="md-ellipsis">
      Run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.function_pb2_grpc.FunctionServiceStub" class="md-nav__link">
    <span class="md-ellipsis">
      FunctionServiceStub
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FunctionServiceStub">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.function_pb2_grpc.FunctionServiceStub.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.poll_pb2" class="md-nav__link">
    <span class="md-ellipsis">
      poll_pb2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.poll_pb2_grpc" class="md-nav__link">
    <span class="md-ellipsis">
      poll_pb2_grpc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.status_pb2" class="md-nav__link">
    <span class="md-ellipsis">
      status_pb2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.status_pb2_grpc" class="md-nav__link">
    <span class="md-ellipsis">
      status_pb2_grpc
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.signature" class="md-nav__link">
    <span class="md-ellipsis">
      signature
    </span>
  </a>
  
    <nav class="md-nav" aria-label="signature">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.signature.sign_request" class="md-nav__link">
    <span class="md-ellipsis">
      sign_request
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.signature.verify_request" class="md-nav__link">
    <span class="md-ellipsis">
      verify_request
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.signature.digest" class="md-nav__link">
    <span class="md-ellipsis">
      digest
    </span>
  </a>
  
    <nav class="md-nav" aria-label="digest">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.signature.digest.generate_content_digest" class="md-nav__link">
    <span class="md-ellipsis">
      generate_content_digest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.signature.digest.verify_content_digest" class="md-nav__link">
    <span class="md-ellipsis">
      verify_content_digest
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.signature.key" class="md-nav__link">
    <span class="md-ellipsis">
      key
    </span>
  </a>
  
    <nav class="md-nav" aria-label="key">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.signature.key.KeyResolver" class="md-nav__link">
    <span class="md-ellipsis">
      KeyResolver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.signature.key.private_key_from_bytes" class="md-nav__link">
    <span class="md-ellipsis">
      private_key_from_bytes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.signature.key.private_key_from_pem" class="md-nav__link">
    <span class="md-ellipsis">
      private_key_from_pem
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.signature.key.public_key_from_bytes" class="md-nav__link">
    <span class="md-ellipsis">
      public_key_from_bytes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.signature.key.public_key_from_pem" class="md-nav__link">
    <span class="md-ellipsis">
      public_key_from_pem
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.signature.request" class="md-nav__link">
    <span class="md-ellipsis">
      request
    </span>
  </a>
  
    <nav class="md-nav" aria-label="request">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.signature.request.Request" class="md-nav__link">
    <span class="md-ellipsis">
      Request
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.status" class="md-nav__link">
    <span class="md-ellipsis">
      status
    </span>
  </a>
  
    <nav class="md-nav" aria-label="status">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.status.Status" class="md-nav__link">
    <span class="md-ellipsis">
      Status
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.status.register_error_type" class="md-nav__link">
    <span class="md-ellipsis">
      register_error_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.status.register_output_type" class="md-nav__link">
    <span class="md-ellipsis">
      register_output_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.status.status_for_error" class="md-nav__link">
    <span class="md-ellipsis">
      status_for_error
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.status.status_for_output" class="md-nav__link">
    <span class="md-ellipsis">
      status_for_output
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      API Reference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch" class="md-nav__link">
    <span class="md-ellipsis">
      dispatch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.DispatchID" class="md-nav__link">
    <span class="md-ellipsis">
      DispatchID
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.Call" class="md-nav__link">
    <span class="md-ellipsis">
      Call
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.Client" class="md-nav__link">
    <span class="md-ellipsis">
      Client
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Client">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.Client.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.Client.dispatch" class="md-nav__link">
    <span class="md-ellipsis">
      dispatch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.Error" class="md-nav__link">
    <span class="md-ellipsis">
      Error
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.Error.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.Error.from_exception" class="md-nav__link">
    <span class="md-ellipsis">
      from_exception
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.Input" class="md-nav__link">
    <span class="md-ellipsis">
      Input
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Input">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.Input.input_arguments" class="md-nav__link">
    <span class="md-ellipsis">
      input_arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.Output" class="md-nav__link">
    <span class="md-ellipsis">
      Output
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Output">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.Output.error" class="md-nav__link">
    <span class="md-ellipsis">
      error
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.Output.exit" class="md-nav__link">
    <span class="md-ellipsis">
      exit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.Output.poll" class="md-nav__link">
    <span class="md-ellipsis">
      poll
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.Output.tail_call" class="md-nav__link">
    <span class="md-ellipsis">
      tail_call
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.Output.value" class="md-nav__link">
    <span class="md-ellipsis">
      value
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.Status" class="md-nav__link">
    <span class="md-ellipsis">
      Status
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.poll" class="md-nav__link">
    <span class="md-ellipsis">
      poll
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.client" class="md-nav__link">
    <span class="md-ellipsis">
      client
    </span>
  </a>
  
    <nav class="md-nav" aria-label="client">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.client.Client" class="md-nav__link">
    <span class="md-ellipsis">
      Client
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Client">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.client.Client.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.client.Client.dispatch" class="md-nav__link">
    <span class="md-ellipsis">
      dispatch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.coroutine" class="md-nav__link">
    <span class="md-ellipsis">
      coroutine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="coroutine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.coroutine.CoroutineState" class="md-nav__link">
    <span class="md-ellipsis">
      CoroutineState
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.coroutine.exit" class="md-nav__link">
    <span class="md-ellipsis">
      exit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.coroutine.poll" class="md-nav__link">
    <span class="md-ellipsis">
      poll
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.coroutine.schedule" class="md-nav__link">
    <span class="md-ellipsis">
      schedule
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.experimental" class="md-nav__link">
    <span class="md-ellipsis">
      experimental
    </span>
  </a>
  
    <nav class="md-nav" aria-label="experimental">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable" class="md-nav__link">
    <span class="md-ellipsis">
      durable
    </span>
  </a>
  
    <nav class="md-nav" aria-label="durable">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.durable" class="md-nav__link">
    <span class="md-ellipsis">
      durable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.frame" class="md-nav__link">
    <span class="md-ellipsis">
      frame
    </span>
  </a>
  
    <nav class="md-nav" aria-label="frame">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.frame.__file__" class="md-nav__link">
    <span class="md-ellipsis">
      __file__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.frame.__name__" class="md-nav__link">
    <span class="md-ellipsis">
      __name__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.frame.__package__" class="md-nav__link">
    <span class="md-ellipsis">
      __package__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.frame.get_frame_ip" class="md-nav__link">
    <span class="md-ellipsis">
      get_frame_ip
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.frame.get_frame_sp" class="md-nav__link">
    <span class="md-ellipsis">
      get_frame_sp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.frame.get_frame_stack_at" class="md-nav__link">
    <span class="md-ellipsis">
      get_frame_stack_at
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.frame.get_frame_state" class="md-nav__link">
    <span class="md-ellipsis">
      get_frame_state
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.frame.set_frame_ip" class="md-nav__link">
    <span class="md-ellipsis">
      set_frame_ip
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.frame.set_frame_sp" class="md-nav__link">
    <span class="md-ellipsis">
      set_frame_sp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.frame.set_frame_stack_at" class="md-nav__link">
    <span class="md-ellipsis">
      set_frame_stack_at
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.frame.set_frame_state" class="md-nav__link">
    <span class="md-ellipsis">
      set_frame_state
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.function" class="md-nav__link">
    <span class="md-ellipsis">
      function
    </span>
  </a>
  
    <nav class="md-nav" aria-label="function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.function.DurableCoroutine" class="md-nav__link">
    <span class="md-ellipsis">
      DurableCoroutine
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.function.DurableFunction" class="md-nav__link">
    <span class="md-ellipsis">
      DurableFunction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.function.DurableGenerator" class="md-nav__link">
    <span class="md-ellipsis">
      DurableGenerator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.function.durable" class="md-nav__link">
    <span class="md-ellipsis">
      durable
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.registry" class="md-nav__link">
    <span class="md-ellipsis">
      registry
    </span>
  </a>
  
    <nav class="md-nav" aria-label="registry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.registry.RegisteredFunction" class="md-nav__link">
    <span class="md-ellipsis">
      RegisteredFunction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.registry.lookup_function" class="md-nav__link">
    <span class="md-ellipsis">
      lookup_function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.registry.register_function" class="md-nav__link">
    <span class="md-ellipsis">
      register_function
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.serializable" class="md-nav__link">
    <span class="md-ellipsis">
      serializable
    </span>
  </a>
  
    <nav class="md-nav" aria-label="serializable">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.durable.serializable.Serializable" class="md-nav__link">
    <span class="md-ellipsis">
      Serializable
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor" class="md-nav__link">
    <span class="md-ellipsis">
      multicolor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="multicolor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.CustomYield" class="md-nav__link">
    <span class="md-ellipsis">
      CustomYield
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.GeneratorYield" class="md-nav__link">
    <span class="md-ellipsis">
      GeneratorYield
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.NoSourceError" class="md-nav__link">
    <span class="md-ellipsis">
      NoSourceError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.compile_function" class="md-nav__link">
    <span class="md-ellipsis">
      compile_function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.no_yields" class="md-nav__link">
    <span class="md-ellipsis">
      no_yields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.compile" class="md-nav__link">
    <span class="md-ellipsis">
      compile
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.compile.CallTransformer" class="md-nav__link">
    <span class="md-ellipsis">
      CallTransformer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.compile.FunctionColor" class="md-nav__link">
    <span class="md-ellipsis">
      FunctionColor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.compile.GeneratorTransformer" class="md-nav__link">
    <span class="md-ellipsis">
      GeneratorTransformer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.compile.compile_function" class="md-nav__link">
    <span class="md-ellipsis">
      compile_function
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.desugar" class="md-nav__link">
    <span class="md-ellipsis">
      desugar
    </span>
  </a>
  
    <nav class="md-nav" aria-label="desugar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.desugar.Desugar" class="md-nav__link">
    <span class="md-ellipsis">
      Desugar
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.desugar.desugar_function" class="md-nav__link">
    <span class="md-ellipsis">
      desugar_function
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.generator" class="md-nav__link">
    <span class="md-ellipsis">
      generator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="generator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.generator.YieldCounter" class="md-nav__link">
    <span class="md-ellipsis">
      YieldCounter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.generator.empty_generator" class="md-nav__link">
    <span class="md-ellipsis">
      empty_generator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.generator.is_generator" class="md-nav__link">
    <span class="md-ellipsis">
      is_generator
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.parse" class="md-nav__link">
    <span class="md-ellipsis">
      parse
    </span>
  </a>
  
    <nav class="md-nav" aria-label="parse">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.parse.NoSourceError" class="md-nav__link">
    <span class="md-ellipsis">
      NoSourceError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.parse.parse_function" class="md-nav__link">
    <span class="md-ellipsis">
      parse_function
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.template" class="md-nav__link">
    <span class="md-ellipsis">
      template
    </span>
  </a>
  
    <nav class="md-nav" aria-label="template">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.template.NameTransformer" class="md-nav__link">
    <span class="md-ellipsis">
      NameTransformer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.template.rewrite_template" class="md-nav__link">
    <span class="md-ellipsis">
      rewrite_template
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.yields" class="md-nav__link">
    <span class="md-ellipsis">
      yields
    </span>
  </a>
  
    <nav class="md-nav" aria-label="yields">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.yields.CustomYield" class="md-nav__link">
    <span class="md-ellipsis">
      CustomYield
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.yields.GeneratorYield" class="md-nav__link">
    <span class="md-ellipsis">
      GeneratorYield
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.yields.YieldType" class="md-nav__link">
    <span class="md-ellipsis">
      YieldType
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.yields.no_yields" class="md-nav__link">
    <span class="md-ellipsis">
      no_yields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.experimental.multicolor.yields.yields" class="md-nav__link">
    <span class="md-ellipsis">
      yields
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.fastapi" class="md-nav__link">
    <span class="md-ellipsis">
      fastapi
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fastapi">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.fastapi.Dispatch" class="md-nav__link">
    <span class="md-ellipsis">
      Dispatch
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dispatch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.fastapi.Dispatch.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.function" class="md-nav__link">
    <span class="md-ellipsis">
      function
    </span>
  </a>
  
    <nav class="md-nav" aria-label="function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.function.PrimitiveFunctionType" class="md-nav__link">
    <span class="md-ellipsis">
      PrimitiveFunctionType
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.function.Function" class="md-nav__link">
    <span class="md-ellipsis">
      Function
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.function.Function.call_with" class="md-nav__link">
    <span class="md-ellipsis">
      call_with
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.function.Function.dispatch" class="md-nav__link">
    <span class="md-ellipsis">
      dispatch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.function.Function.primitive_call_with" class="md-nav__link">
    <span class="md-ellipsis">
      primitive_call_with
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.function.Function.primitive_dispatch" class="md-nav__link">
    <span class="md-ellipsis">
      primitive_dispatch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.function.Registry" class="md-nav__link">
    <span class="md-ellipsis">
      Registry
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Registry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.function.Registry.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.function.Registry.coroutine" class="md-nav__link">
    <span class="md-ellipsis">
      coroutine
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.function.Registry.function" class="md-nav__link">
    <span class="md-ellipsis">
      function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.function.Registry.primitive_function" class="md-nav__link">
    <span class="md-ellipsis">
      primitive_function
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.id" class="md-nav__link">
    <span class="md-ellipsis">
      id
    </span>
  </a>
  
    <nav class="md-nav" aria-label="id">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.id.DispatchID" class="md-nav__link">
    <span class="md-ellipsis">
      DispatchID
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.integrations" class="md-nav__link">
    <span class="md-ellipsis">
      integrations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="integrations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.integrations.http" class="md-nav__link">
    <span class="md-ellipsis">
      http
    </span>
  </a>
  
    <nav class="md-nav" aria-label="http">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.integrations.http.http_response_code_status" class="md-nav__link">
    <span class="md-ellipsis">
      http_response_code_status
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.integrations.httpx" class="md-nav__link">
    <span class="md-ellipsis">
      httpx
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.integrations.requests" class="md-nav__link">
    <span class="md-ellipsis">
      requests
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.proto" class="md-nav__link">
    <span class="md-ellipsis">
      proto
    </span>
  </a>
  
    <nav class="md-nav" aria-label="proto">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.proto.Call" class="md-nav__link">
    <span class="md-ellipsis">
      Call
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.proto.CallResult" class="md-nav__link">
    <span class="md-ellipsis">
      CallResult
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.proto.Error" class="md-nav__link">
    <span class="md-ellipsis">
      Error
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.proto.Error.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.proto.Error.from_exception" class="md-nav__link">
    <span class="md-ellipsis">
      from_exception
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.proto.Input" class="md-nav__link">
    <span class="md-ellipsis">
      Input
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Input">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.proto.Input.input_arguments" class="md-nav__link">
    <span class="md-ellipsis">
      input_arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.proto.Output" class="md-nav__link">
    <span class="md-ellipsis">
      Output
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Output">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.proto.Output.error" class="md-nav__link">
    <span class="md-ellipsis">
      error
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.proto.Output.exit" class="md-nav__link">
    <span class="md-ellipsis">
      exit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.proto.Output.poll" class="md-nav__link">
    <span class="md-ellipsis">
      poll
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.proto.Output.tail_call" class="md-nav__link">
    <span class="md-ellipsis">
      tail_call
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.proto.Output.value" class="md-nav__link">
    <span class="md-ellipsis">
      value
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.sdk" class="md-nav__link">
    <span class="md-ellipsis">
      sdk
    </span>
  </a>
  
    <nav class="md-nav" aria-label="sdk">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1" class="md-nav__link">
    <span class="md-ellipsis">
      v1
    </span>
  </a>
  
    <nav class="md-nav" aria-label="v1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.call_pb2" class="md-nav__link">
    <span class="md-ellipsis">
      call_pb2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.call_pb2_grpc" class="md-nav__link">
    <span class="md-ellipsis">
      call_pb2_grpc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.dispatch_pb2" class="md-nav__link">
    <span class="md-ellipsis">
      dispatch_pb2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.dispatch_pb2_grpc" class="md-nav__link">
    <span class="md-ellipsis">
      dispatch_pb2_grpc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dispatch_pb2_grpc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.dispatch_pb2_grpc.DispatchService" class="md-nav__link">
    <span class="md-ellipsis">
      DispatchService
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.dispatch_pb2_grpc.DispatchServiceServicer" class="md-nav__link">
    <span class="md-ellipsis">
      DispatchServiceServicer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DispatchServiceServicer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.dispatch_pb2_grpc.DispatchServiceServicer.Dispatch" class="md-nav__link">
    <span class="md-ellipsis">
      Dispatch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.dispatch_pb2_grpc.DispatchServiceStub" class="md-nav__link">
    <span class="md-ellipsis">
      DispatchServiceStub
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DispatchServiceStub">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.dispatch_pb2_grpc.DispatchServiceStub.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.error_pb2" class="md-nav__link">
    <span class="md-ellipsis">
      error_pb2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.error_pb2_grpc" class="md-nav__link">
    <span class="md-ellipsis">
      error_pb2_grpc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.exit_pb2" class="md-nav__link">
    <span class="md-ellipsis">
      exit_pb2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.exit_pb2_grpc" class="md-nav__link">
    <span class="md-ellipsis">
      exit_pb2_grpc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.function_pb2" class="md-nav__link">
    <span class="md-ellipsis">
      function_pb2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.function_pb2_grpc" class="md-nav__link">
    <span class="md-ellipsis">
      function_pb2_grpc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="function_pb2_grpc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.function_pb2_grpc.FunctionService" class="md-nav__link">
    <span class="md-ellipsis">
      FunctionService
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.function_pb2_grpc.FunctionServiceServicer" class="md-nav__link">
    <span class="md-ellipsis">
      FunctionServiceServicer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FunctionServiceServicer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.function_pb2_grpc.FunctionServiceServicer.Run" class="md-nav__link">
    <span class="md-ellipsis">
      Run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.function_pb2_grpc.FunctionServiceStub" class="md-nav__link">
    <span class="md-ellipsis">
      FunctionServiceStub
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FunctionServiceStub">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.function_pb2_grpc.FunctionServiceStub.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.poll_pb2" class="md-nav__link">
    <span class="md-ellipsis">
      poll_pb2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.poll_pb2_grpc" class="md-nav__link">
    <span class="md-ellipsis">
      poll_pb2_grpc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.status_pb2" class="md-nav__link">
    <span class="md-ellipsis">
      status_pb2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.sdk.v1.status_pb2_grpc" class="md-nav__link">
    <span class="md-ellipsis">
      status_pb2_grpc
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.signature" class="md-nav__link">
    <span class="md-ellipsis">
      signature
    </span>
  </a>
  
    <nav class="md-nav" aria-label="signature">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.signature.sign_request" class="md-nav__link">
    <span class="md-ellipsis">
      sign_request
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.signature.verify_request" class="md-nav__link">
    <span class="md-ellipsis">
      verify_request
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.signature.digest" class="md-nav__link">
    <span class="md-ellipsis">
      digest
    </span>
  </a>
  
    <nav class="md-nav" aria-label="digest">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.signature.digest.generate_content_digest" class="md-nav__link">
    <span class="md-ellipsis">
      generate_content_digest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.signature.digest.verify_content_digest" class="md-nav__link">
    <span class="md-ellipsis">
      verify_content_digest
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.signature.key" class="md-nav__link">
    <span class="md-ellipsis">
      key
    </span>
  </a>
  
    <nav class="md-nav" aria-label="key">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.signature.key.KeyResolver" class="md-nav__link">
    <span class="md-ellipsis">
      KeyResolver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.signature.key.private_key_from_bytes" class="md-nav__link">
    <span class="md-ellipsis">
      private_key_from_bytes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.signature.key.private_key_from_pem" class="md-nav__link">
    <span class="md-ellipsis">
      private_key_from_pem
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.signature.key.public_key_from_bytes" class="md-nav__link">
    <span class="md-ellipsis">
      public_key_from_bytes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.signature.key.public_key_from_pem" class="md-nav__link">
    <span class="md-ellipsis">
      public_key_from_pem
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.signature.request" class="md-nav__link">
    <span class="md-ellipsis">
      request
    </span>
  </a>
  
    <nav class="md-nav" aria-label="request">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.signature.request.Request" class="md-nav__link">
    <span class="md-ellipsis">
      Request
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dispatch.status" class="md-nav__link">
    <span class="md-ellipsis">
      status
    </span>
  </a>
  
    <nav class="md-nav" aria-label="status">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dispatch.status.Status" class="md-nav__link">
    <span class="md-ellipsis">
      Status
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.status.register_error_type" class="md-nav__link">
    <span class="md-ellipsis">
      register_error_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.status.register_output_type" class="md-nav__link">
    <span class="md-ellipsis">
      register_output_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.status.status_for_error" class="md-nav__link">
    <span class="md-ellipsis">
      status_for_error
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatch.status.status_for_output" class="md-nav__link">
    <span class="md-ellipsis">
      status_for_output
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="dispatch-python-sdk">Dispatch Python SDK</h1>
<p>This is the API reference for the Python SDK of Dispatch.</p>
<ul>
<li>Tutorials and guides: <a href="https://docs.stealthrocket.cloud">docs.stealthrocket.cloud</a>.</li>
<li>Source: <a href="https://github.com/stealthrocket/dispatch-sdk-python">stealthrocket/dispatch-sdk-python</a>.</li>
</ul>
<h2 id="api-reference">API Reference</h2>
<hr />


<div class="doc doc-object doc-module">



<a id="dispatch"></a>
  <div class="doc doc-contents first">
  
      <p>The Dispatch SDK for Python.</p>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h2 id="dispatch.DispatchID" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">DispatchID</span><span class="p">:</span> <span class="n">TypeAlias</span> <span class="o">=</span> <span class="nb">str</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Unique identifier in Dispatch.</p>
<p>It should be treated as an opaque value.</p>
  </div>

</div>


<div class="doc doc-object doc-class">



<h2 id="dispatch.Call" class="doc doc-heading">
          <code>Call</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">

  
      <p>Instruction to call a function.</p>
<p>Though this class can be built manually, it is recommended to use the
with_call method of a Function instead.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/proto.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Call</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Instruction to call a function.</span>

<span class="sd">    Though this class can be built manually, it is recommended to use the</span>
<span class="sd">    with_call method of a Function instead.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">function</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">input</span><span class="p">:</span> <span class="n">Any</span>
    <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">correlation_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_as_proto</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">call_pb</span><span class="o">.</span><span class="n">Call</span><span class="p">:</span>
        <span class="n">input_bytes</span> <span class="o">=</span> <span class="n">_pb_any_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">call_pb</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span>
            <span class="n">correlation_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">correlation_id</span><span class="p">,</span>
            <span class="n">endpoint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="p">,</span>
            <span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">,</span>
            <span class="nb">input</span><span class="o">=</span><span class="n">input_bytes</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="dispatch.Client" class="doc doc-heading">
          <code>Client</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Client for the Dispatch API.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Client</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Client for the Dispatch API.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">api_url</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new Dispatch client.</span>

<span class="sd">        Args:</span>
<span class="sd">            api_key: Dispatch API key to use for authentication. Uses the value of</span>
<span class="sd">              the DISPATCH_API_KEY environment variable by default.</span>

<span class="sd">            api_url: The URL of the Dispatch API to use. Uses the value of the</span>
<span class="sd">              DISPATCH_API_URL environment variable if set, otherwise</span>
<span class="sd">              defaults to the public Dispatch API (DEFAULT_API_URL).</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: if the API key is missing.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">api_key</span><span class="p">:</span>
            <span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DISPATCH_API_KEY&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">api_key</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;missing API key: set it with the DISPATCH_API_KEY environment variable&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">api_url</span><span class="p">:</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DISPATCH_API_URL&quot;</span><span class="p">,</span> <span class="n">DEFAULT_API_URL</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">api_url</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;missing API URL: set it with the DISPATCH_API_URL environment variable&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">api_url</span> <span class="o">=</span> <span class="n">api_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_stub</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;api_url&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_url</span><span class="p">,</span> <span class="s2">&quot;api_key&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_url</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;api_url&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;api_key&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_stub</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_init_stub</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;initializing client for Dispatch API at URL </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_url</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api_url</span><span class="p">)</span>
        <span class="k">match</span> <span class="n">result</span><span class="o">.</span><span class="n">scheme</span><span class="p">:</span>
            <span class="k">case</span> <span class="s2">&quot;http&quot;</span><span class="p">:</span>
                <span class="n">creds</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">local_channel_credentials</span><span class="p">()</span>
            <span class="k">case</span> <span class="s2">&quot;https&quot;</span><span class="p">:</span>
                <span class="n">creds</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">ssl_channel_credentials</span><span class="p">()</span>
            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid API scheme: &#39;</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">scheme</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="n">call_creds</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">access_token_call_credentials</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">)</span>
        <span class="n">creds</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">composite_channel_credentials</span><span class="p">(</span><span class="n">creds</span><span class="p">,</span> <span class="n">call_creds</span><span class="p">)</span>
        <span class="n">channel</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">secure_channel</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">netloc</span><span class="p">,</span> <span class="n">creds</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_stub</span> <span class="o">=</span> <span class="n">dispatch_grpc</span><span class="o">.</span><span class="n">DispatchServiceStub</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">calls</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Call</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">DispatchID</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dispatch function calls.</span>

<span class="sd">        Args:</span>
<span class="sd">            calls: Calls to dispatch.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Identifiers for the function calls, in the same order as the inputs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">calls_proto</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">_as_proto</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">calls</span><span class="p">]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;dispatching </span><span class="si">%d</span><span class="s2"> function call(s)&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">calls_proto</span><span class="p">))</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">dispatch_pb</span><span class="o">.</span><span class="n">DispatchRequest</span><span class="p">(</span><span class="n">calls</span><span class="o">=</span><span class="n">calls_proto</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stub</span><span class="o">.</span><span class="n">Dispatch</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="n">dispatch_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">DispatchID</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">dispatch_ids</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">logger</span><span class="o">.</span><span class="n">isEnabledFor</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;dispatched </span><span class="si">%d</span><span class="s2"> function call(s): </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">calls_proto</span><span class="p">),</span>
                <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dispatch_ids</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">dispatch_ids</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="dispatch.Client.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">api_url</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Create a new Dispatch client.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>api_key</code></td>
          <td>
                <code>None | str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dispatch API key to use for authentication. Uses the value of
the DISPATCH_API_KEY environment variable by default.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>api_url</code></td>
          <td>
                <code>None | str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The URL of the Dispatch API to use. Uses the value of the
DISPATCH_API_URL environment variable if set, otherwise
defaults to the public Dispatch API (DEFAULT_API_URL).</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>ValueError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>if the API key is missing.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>dispatch/client.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">api_url</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new Dispatch client.</span>

<span class="sd">    Args:</span>
<span class="sd">        api_key: Dispatch API key to use for authentication. Uses the value of</span>
<span class="sd">          the DISPATCH_API_KEY environment variable by default.</span>

<span class="sd">        api_url: The URL of the Dispatch API to use. Uses the value of the</span>
<span class="sd">          DISPATCH_API_URL environment variable if set, otherwise</span>
<span class="sd">          defaults to the public Dispatch API (DEFAULT_API_URL).</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: if the API key is missing.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">api_key</span><span class="p">:</span>
        <span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DISPATCH_API_KEY&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">api_key</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;missing API key: set it with the DISPATCH_API_KEY environment variable&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">api_url</span><span class="p">:</span>
        <span class="n">api_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DISPATCH_API_URL&quot;</span><span class="p">,</span> <span class="n">DEFAULT_API_URL</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">api_url</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;missing API URL: set it with the DISPATCH_API_URL environment variable&quot;</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">api_url</span> <span class="o">=</span> <span class="n">api_url</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_init_stub</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="dispatch.Client.dispatch" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">dispatch</span><span class="p">(</span><span class="n">calls</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Dispatch function calls.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>calls</code></td>
          <td>
                <code><span title="typing.Iterable">Iterable</span>[<a class="autorefs autorefs-internal" title="dispatch.proto.Call" href="#dispatch.proto.Call">Call</a>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Calls to dispatch.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Iterable">Iterable</span>[<a class="autorefs autorefs-internal" title="dispatch.id.DispatchID" href="#dispatch.id.DispatchID">DispatchID</a>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Identifiers for the function calls, in the same order as the inputs.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>dispatch/client.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">calls</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Call</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">DispatchID</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dispatch function calls.</span>

<span class="sd">    Args:</span>
<span class="sd">        calls: Calls to dispatch.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Identifiers for the function calls, in the same order as the inputs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">calls_proto</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">_as_proto</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">calls</span><span class="p">]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;dispatching </span><span class="si">%d</span><span class="s2"> function call(s)&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">calls_proto</span><span class="p">))</span>
    <span class="n">req</span> <span class="o">=</span> <span class="n">dispatch_pb</span><span class="o">.</span><span class="n">DispatchRequest</span><span class="p">(</span><span class="n">calls</span><span class="o">=</span><span class="n">calls_proto</span><span class="p">)</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stub</span><span class="o">.</span><span class="n">Dispatch</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
    <span class="n">dispatch_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">DispatchID</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">dispatch_ids</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">logger</span><span class="o">.</span><span class="n">isEnabledFor</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;dispatched </span><span class="si">%d</span><span class="s2"> function call(s): </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">calls_proto</span><span class="p">),</span>
            <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dispatch_ids</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">dispatch_ids</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="dispatch.Error" class="doc doc-heading">
          <code>Error</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Error when running a function.</p>
<p>This is not a Python exception, but potentially part of a CallResult or
Output.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/proto.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Error</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Error when running a function.</span>

<span class="sd">    This is not a Python exception, but potentially part of a CallResult or</span>
<span class="sd">    Output.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">Status</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new Error.</span>

<span class="sd">        Args:</span>
<span class="sd">            status: categorization of the error.</span>
<span class="sd">            type: arbitrary string, used for humans. Optional.</span>
<span class="sd">            message: arbitrary message. Optional.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Neither type or message was provided or status is</span>
<span class="sd">              invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">message</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least one of type or message is required&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="n">Status</span><span class="o">.</span><span class="n">OK</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Status cannot be OK&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_exception</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">ex</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">Status</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Error</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an Error from a Python exception, using its class qualified</span>
<span class="sd">        named as type.</span>

<span class="sd">        The status tries to be inferred, but can be overridden. If it is not</span>
<span class="sd">        provided or cannot be inferred, it defaults to TEMPORARY_ERROR.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">status_for_error</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Error</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">ex</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__qualname__</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_from_proto</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">proto</span><span class="p">:</span> <span class="n">error_pb</span><span class="o">.</span><span class="n">Error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Error</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">Status</span><span class="o">.</span><span class="n">UNSPECIFIED</span><span class="p">,</span> <span class="n">proto</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">proto</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_as_proto</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">error_pb</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">error_pb</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="dispatch.Error.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Create a new Error.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>status</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="dispatch.status.Status" href="#dispatch.status.Status">Status</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>categorization of the error.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>type</code></td>
          <td>
                <code>str | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>arbitrary string, used for humans. Optional.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>message</code></td>
          <td>
                <code>str | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>arbitrary message. Optional.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>ValueError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Neither type or message was provided or status is
invalid.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>dispatch/proto.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">Status</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new Error.</span>

<span class="sd">    Args:</span>
<span class="sd">        status: categorization of the error.</span>
<span class="sd">        type: arbitrary string, used for humans. Optional.</span>
<span class="sd">        message: arbitrary message. Optional.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Neither type or message was provided or status is</span>
<span class="sd">          invalid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">message</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least one of type or message is required&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="n">Status</span><span class="o">.</span><span class="n">OK</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Status cannot be OK&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="dispatch.Error.from_exception" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">from_exception</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Create an Error from a Python exception, using its class qualified
named as type.</p>
<p>The status tries to be inferred, but can be overridden. If it is not
provided or cannot be inferred, it defaults to TEMPORARY_ERROR.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/proto.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_exception</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">ex</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">Status</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Error</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create an Error from a Python exception, using its class qualified</span>
<span class="sd">    named as type.</span>

<span class="sd">    The status tries to be inferred, but can be overridden. If it is not</span>
<span class="sd">    provided or cannot be inferred, it defaults to TEMPORARY_ERROR.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">status_for_error</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Error</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">ex</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__qualname__</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="dispatch.Input" class="doc doc-heading">
          <code>Input</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>The input to a primitive function.</p>
<p>Functions always take a single argument of type Input. When the function is
run for the first time, it receives the input. When the function is a coroutine
that's resuming after a yield point, it receives the results of the yield
directive. Use the is_first_call and is_resume properties to differentiate
between the two cases.</p>
<p>This class is intended to be used as read-only.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/proto.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Input</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The input to a primitive function.</span>

<span class="sd">    Functions always take a single argument of type Input. When the function is</span>
<span class="sd">    run for the first time, it receives the input. When the function is a coroutine</span>
<span class="sd">    that&#39;s resuming after a yield point, it receives the results of the yield</span>
<span class="sd">    directive. Use the is_first_call and is_resume properties to differentiate</span>
<span class="sd">    between the two cases.</span>

<span class="sd">    This class is intended to be used as read-only.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">:</span> <span class="n">function_pb</span><span class="o">.</span><span class="n">RunRequest</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_input</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">HasField</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_input</span><span class="p">:</span>
            <span class="n">input_pb</span> <span class="o">=</span> <span class="n">google</span><span class="o">.</span><span class="n">protobuf</span><span class="o">.</span><span class="n">wrappers_pb2</span><span class="o">.</span><span class="n">BytesValue</span><span class="p">()</span>
            <span class="n">req</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">Unpack</span><span class="p">(</span><span class="n">input_pb</span><span class="p">)</span>
            <span class="n">input_bytes</span> <span class="o">=</span> <span class="n">input_pb</span><span class="o">.</span><span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_input</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">input_bytes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">state_bytes</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">poll_result</span><span class="o">.</span><span class="n">coroutine_state</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_bytes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_coroutine_state</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">state_bytes</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_coroutine_state</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_call_results</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">CallResult</span><span class="o">.</span><span class="n">_from_proto</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">req</span><span class="o">.</span><span class="n">poll_result</span><span class="o">.</span><span class="n">results</span>
            <span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_first_call</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_input</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_resume</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_first_call</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">input</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_first_call</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input</span>

    <span class="k">def</span> <span class="nf">input_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns positional and keyword arguments carried by the input.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_first_call</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_input</span><span class="p">,</span> <span class="n">_Arguments</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;input does not hold arguments&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input</span><span class="o">.</span><span class="n">kwargs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">coroutine_state</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_resume</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coroutine_state</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">call_results</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">CallResult</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_resume</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_results</span>

    <span class="k">def</span> <span class="nf">_assert_first_call</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_resume</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This input is for a resumed coroutine&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_assert_resume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_first_call</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This input is for a first function call&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="dispatch.Input.input_arguments" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">input_arguments</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns positional and keyword arguments carried by the input.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/proto.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">input_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns positional and keyword arguments carried by the input.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_assert_first_call</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_input</span><span class="p">,</span> <span class="n">_Arguments</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;input does not hold arguments&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input</span><span class="o">.</span><span class="n">kwargs</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="dispatch.Output" class="doc doc-heading">
          <code>Output</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>The output of a primitive function.</p>
<p>This class is meant to be instantiated and returned by authors of functions
to indicate the follow up action they need to take. Use the various class
methods create an instance of this class. For example Output.value() or
Output.poll().</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/proto.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Output</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The output of a primitive function.</span>

<span class="sd">    This class is meant to be instantiated and returned by authors of functions</span>
<span class="sd">    to indicate the follow up action they need to take. Use the various class</span>
<span class="sd">    methods create an instance of this class. For example Output.value() or</span>
<span class="sd">    Output.poll().</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proto</span><span class="p">:</span> <span class="n">function_pb</span><span class="o">.</span><span class="n">RunResponse</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_message</span> <span class="o">=</span> <span class="n">proto</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">Status</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Terminally exit the function with the provided return value.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">status_for_output</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="n">CallResult</span><span class="o">.</span><span class="n">from_value</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="n">Error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Terminally exit the function with the provided error.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="n">CallResult</span><span class="o">.</span><span class="n">from_error</span><span class="p">(</span><span class="n">error</span><span class="p">),</span> <span class="n">status</span><span class="o">=</span><span class="n">error</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">tail_call</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">tail_call</span><span class="p">:</span> <span class="n">Call</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Terminally exit the function, and instruct the orchestrator to</span>
<span class="sd">        tail call the specified function.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">tail_call</span><span class="o">=</span><span class="n">tail_call</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">exit</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tail_call</span><span class="p">:</span> <span class="n">Call</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">status</span><span class="p">:</span> <span class="n">Status</span> <span class="o">=</span> <span class="n">Status</span><span class="o">.</span><span class="n">OK</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Terminally exit the function.&quot;&quot;&quot;</span>
        <span class="n">result_proto</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">_as_proto</span><span class="p">()</span> <span class="k">if</span> <span class="n">result</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">tail_call_proto</span> <span class="o">=</span> <span class="n">tail_call</span><span class="o">.</span><span class="n">_as_proto</span><span class="p">()</span> <span class="k">if</span> <span class="n">tail_call</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">Output</span><span class="p">(</span>
            <span class="n">function_pb</span><span class="o">.</span><span class="n">RunResponse</span><span class="p">(</span>
                <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">_proto</span><span class="p">,</span>
                <span class="n">exit</span><span class="o">=</span><span class="n">exit_pb</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="n">result_proto</span><span class="p">,</span> <span class="n">tail_call</span><span class="o">=</span><span class="n">tail_call_proto</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">poll</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">calls</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">Call</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Suspend the function with a set of Calls, instructing the</span>
<span class="sd">        orchestrator to resume the function with the provided state when</span>
<span class="sd">        call results are ready.&quot;&quot;&quot;</span>
        <span class="n">state_bytes</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="n">poll</span> <span class="o">=</span> <span class="n">poll_pb</span><span class="o">.</span><span class="n">Poll</span><span class="p">(</span>
            <span class="n">coroutine_state</span><span class="o">=</span><span class="n">state_bytes</span><span class="p">,</span>
            <span class="c1"># FIXME: make this configurable</span>
            <span class="n">max_results</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">max_wait</span><span class="o">=</span><span class="n">duration_pb2</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">calls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">calls</span><span class="p">:</span>
                <span class="n">poll</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">_as_proto</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">Output</span><span class="p">(</span>
            <span class="n">function_pb</span><span class="o">.</span><span class="n">RunResponse</span><span class="p">(</span>
                <span class="n">status</span><span class="o">=</span><span class="n">status_pb</span><span class="o">.</span><span class="n">STATUS_OK</span><span class="p">,</span>
                <span class="n">poll</span><span class="o">=</span><span class="n">poll</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="dispatch.Output.error" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">error</span><span class="p">(</span><span class="n">error</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Terminally exit the function with the provided error.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/proto.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="n">Error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Terminally exit the function with the provided error.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="n">CallResult</span><span class="o">.</span><span class="n">from_error</span><span class="p">(</span><span class="n">error</span><span class="p">),</span> <span class="n">status</span><span class="o">=</span><span class="n">error</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="dispatch.Output.exit" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">exit</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tail_call</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">Status</span><span class="o">.</span><span class="n">OK</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Terminally exit the function.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/proto.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">exit</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tail_call</span><span class="p">:</span> <span class="n">Call</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">Status</span> <span class="o">=</span> <span class="n">Status</span><span class="o">.</span><span class="n">OK</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Terminally exit the function.&quot;&quot;&quot;</span>
    <span class="n">result_proto</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">_as_proto</span><span class="p">()</span> <span class="k">if</span> <span class="n">result</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">tail_call_proto</span> <span class="o">=</span> <span class="n">tail_call</span><span class="o">.</span><span class="n">_as_proto</span><span class="p">()</span> <span class="k">if</span> <span class="n">tail_call</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">Output</span><span class="p">(</span>
        <span class="n">function_pb</span><span class="o">.</span><span class="n">RunResponse</span><span class="p">(</span>
            <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">_proto</span><span class="p">,</span>
            <span class="n">exit</span><span class="o">=</span><span class="n">exit_pb</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="n">result_proto</span><span class="p">,</span> <span class="n">tail_call</span><span class="o">=</span><span class="n">tail_call_proto</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="dispatch.Output.poll" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">poll</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">calls</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Suspend the function with a set of Calls, instructing the
orchestrator to resume the function with the provided state when
call results are ready.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/proto.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">poll</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">calls</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">Call</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Suspend the function with a set of Calls, instructing the</span>
<span class="sd">    orchestrator to resume the function with the provided state when</span>
<span class="sd">    call results are ready.&quot;&quot;&quot;</span>
    <span class="n">state_bytes</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
    <span class="n">poll</span> <span class="o">=</span> <span class="n">poll_pb</span><span class="o">.</span><span class="n">Poll</span><span class="p">(</span>
        <span class="n">coroutine_state</span><span class="o">=</span><span class="n">state_bytes</span><span class="p">,</span>
        <span class="c1"># FIXME: make this configurable</span>
        <span class="n">max_results</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">max_wait</span><span class="o">=</span><span class="n">duration_pb2</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">calls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">calls</span><span class="p">:</span>
            <span class="n">poll</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">_as_proto</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">Output</span><span class="p">(</span>
        <span class="n">function_pb</span><span class="o">.</span><span class="n">RunResponse</span><span class="p">(</span>
            <span class="n">status</span><span class="o">=</span><span class="n">status_pb</span><span class="o">.</span><span class="n">STATUS_OK</span><span class="p">,</span>
            <span class="n">poll</span><span class="o">=</span><span class="n">poll</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="dispatch.Output.tail_call" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">tail_call</span><span class="p">(</span><span class="n">tail_call</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Terminally exit the function, and instruct the orchestrator to
tail call the specified function.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/proto.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">tail_call</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">tail_call</span><span class="p">:</span> <span class="n">Call</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Terminally exit the function, and instruct the orchestrator to</span>
<span class="sd">    tail call the specified function.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">tail_call</span><span class="o">=</span><span class="n">tail_call</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="dispatch.Output.value" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Terminally exit the function with the provided return value.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/proto.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">Status</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Terminally exit the function with the provided return value.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">status_for_output</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="n">CallResult</span><span class="o">.</span><span class="n">from_value</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="dispatch.Status" class="doc doc-heading">
          <code>Status</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code>int</code>, <code><span title="enum.Enum">Enum</span></code></p>

  
      <p>Enumeration of the possible values that can be used in the return status
of functions.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/status.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@enum</span><span class="o">.</span><span class="n">unique</span>
<span class="k">class</span> <span class="nc">Status</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Enumeration of the possible values that can be used in the return status</span>
<span class="sd">    of functions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">UNSPECIFIED</span> <span class="o">=</span> <span class="n">status_pb</span><span class="o">.</span><span class="n">STATUS_UNSPECIFIED</span>
    <span class="n">OK</span> <span class="o">=</span> <span class="n">status_pb</span><span class="o">.</span><span class="n">STATUS_OK</span>
    <span class="n">TIMEOUT</span> <span class="o">=</span> <span class="n">status_pb</span><span class="o">.</span><span class="n">STATUS_TIMEOUT</span>
    <span class="n">THROTTLED</span> <span class="o">=</span> <span class="n">status_pb</span><span class="o">.</span><span class="n">STATUS_THROTTLED</span>
    <span class="n">INVALID_ARGUMENT</span> <span class="o">=</span> <span class="n">status_pb</span><span class="o">.</span><span class="n">STATUS_INVALID_ARGUMENT</span>
    <span class="n">INVALID_RESPONSE</span> <span class="o">=</span> <span class="n">status_pb</span><span class="o">.</span><span class="n">STATUS_INVALID_RESPONSE</span>
    <span class="n">TEMPORARY_ERROR</span> <span class="o">=</span> <span class="n">status_pb</span><span class="o">.</span><span class="n">STATUS_TEMPORARY_ERROR</span>
    <span class="n">PERMANENT_ERROR</span> <span class="o">=</span> <span class="n">status_pb</span><span class="o">.</span><span class="n">STATUS_PERMANENT_ERROR</span>
    <span class="n">INCOMPATIBLE_STATE</span> <span class="o">=</span> <span class="n">status_pb</span><span class="o">.</span><span class="n">STATUS_INCOMPATIBLE_STATE</span>

    <span class="n">_proto</span><span class="p">:</span> <span class="n">status_pb</span><span class="o">.</span><span class="n">Status</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>



<div class="doc doc-object doc-function">



<h2 id="dispatch.poll" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">poll</span><span class="p">(</span><span class="n">calls</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Suspend the function with a set of Calls, instructing the
orchestrator to resume the coroutine when call results are ready.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/coroutine.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@coroutine</span>
<span class="nd">@durable</span>
<span class="k">def</span> <span class="nf">poll</span><span class="p">(</span><span class="n">calls</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Call</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">CallResult</span><span class="p">]:</span>  <span class="c1"># type: ignore[misc]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Suspend the function with a set of Calls, instructing the</span>
<span class="sd">    orchestrator to resume the coroutine when call results are ready.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">yield</span> <span class="n">Poll</span><span class="p">(</span><span class="n">calls</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-module">



<h2 id="dispatch.client" class="doc doc-heading">
          <code>client</code>


</h2>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="dispatch.client.Client" class="doc doc-heading">
          <code>Client</code>


</h3>


  <div class="doc doc-contents ">

  
      <p>Client for the Dispatch API.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Client</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Client for the Dispatch API.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">api_url</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new Dispatch client.</span>

<span class="sd">        Args:</span>
<span class="sd">            api_key: Dispatch API key to use for authentication. Uses the value of</span>
<span class="sd">              the DISPATCH_API_KEY environment variable by default.</span>

<span class="sd">            api_url: The URL of the Dispatch API to use. Uses the value of the</span>
<span class="sd">              DISPATCH_API_URL environment variable if set, otherwise</span>
<span class="sd">              defaults to the public Dispatch API (DEFAULT_API_URL).</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: if the API key is missing.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">api_key</span><span class="p">:</span>
            <span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DISPATCH_API_KEY&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">api_key</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;missing API key: set it with the DISPATCH_API_KEY environment variable&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">api_url</span><span class="p">:</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DISPATCH_API_URL&quot;</span><span class="p">,</span> <span class="n">DEFAULT_API_URL</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">api_url</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;missing API URL: set it with the DISPATCH_API_URL environment variable&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">api_url</span> <span class="o">=</span> <span class="n">api_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_stub</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;api_url&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_url</span><span class="p">,</span> <span class="s2">&quot;api_key&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_url</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;api_url&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;api_key&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_stub</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_init_stub</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;initializing client for Dispatch API at URL </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_url</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api_url</span><span class="p">)</span>
        <span class="k">match</span> <span class="n">result</span><span class="o">.</span><span class="n">scheme</span><span class="p">:</span>
            <span class="k">case</span> <span class="s2">&quot;http&quot;</span><span class="p">:</span>
                <span class="n">creds</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">local_channel_credentials</span><span class="p">()</span>
            <span class="k">case</span> <span class="s2">&quot;https&quot;</span><span class="p">:</span>
                <span class="n">creds</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">ssl_channel_credentials</span><span class="p">()</span>
            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid API scheme: &#39;</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">scheme</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="n">call_creds</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">access_token_call_credentials</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">)</span>
        <span class="n">creds</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">composite_channel_credentials</span><span class="p">(</span><span class="n">creds</span><span class="p">,</span> <span class="n">call_creds</span><span class="p">)</span>
        <span class="n">channel</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">secure_channel</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">netloc</span><span class="p">,</span> <span class="n">creds</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_stub</span> <span class="o">=</span> <span class="n">dispatch_grpc</span><span class="o">.</span><span class="n">DispatchServiceStub</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">calls</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Call</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">DispatchID</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dispatch function calls.</span>

<span class="sd">        Args:</span>
<span class="sd">            calls: Calls to dispatch.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Identifiers for the function calls, in the same order as the inputs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">calls_proto</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">_as_proto</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">calls</span><span class="p">]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;dispatching </span><span class="si">%d</span><span class="s2"> function call(s)&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">calls_proto</span><span class="p">))</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">dispatch_pb</span><span class="o">.</span><span class="n">DispatchRequest</span><span class="p">(</span><span class="n">calls</span><span class="o">=</span><span class="n">calls_proto</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stub</span><span class="o">.</span><span class="n">Dispatch</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="n">dispatch_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">DispatchID</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">dispatch_ids</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">logger</span><span class="o">.</span><span class="n">isEnabledFor</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;dispatched </span><span class="si">%d</span><span class="s2"> function call(s): </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">calls_proto</span><span class="p">),</span>
                <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dispatch_ids</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">dispatch_ids</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h4 id="dispatch.client.Client.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">api_url</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Create a new Dispatch client.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>api_key</code></td>
          <td>
                <code>None | str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dispatch API key to use for authentication. Uses the value of
the DISPATCH_API_KEY environment variable by default.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>api_url</code></td>
          <td>
                <code>None | str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The URL of the Dispatch API to use. Uses the value of the
DISPATCH_API_URL environment variable if set, otherwise
defaults to the public Dispatch API (DEFAULT_API_URL).</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>ValueError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>if the API key is missing.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>dispatch/client.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">api_url</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new Dispatch client.</span>

<span class="sd">    Args:</span>
<span class="sd">        api_key: Dispatch API key to use for authentication. Uses the value of</span>
<span class="sd">          the DISPATCH_API_KEY environment variable by default.</span>

<span class="sd">        api_url: The URL of the Dispatch API to use. Uses the value of the</span>
<span class="sd">          DISPATCH_API_URL environment variable if set, otherwise</span>
<span class="sd">          defaults to the public Dispatch API (DEFAULT_API_URL).</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: if the API key is missing.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">api_key</span><span class="p">:</span>
        <span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DISPATCH_API_KEY&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">api_key</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;missing API key: set it with the DISPATCH_API_KEY environment variable&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">api_url</span><span class="p">:</span>
        <span class="n">api_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DISPATCH_API_URL&quot;</span><span class="p">,</span> <span class="n">DEFAULT_API_URL</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">api_url</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;missing API URL: set it with the DISPATCH_API_URL environment variable&quot;</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">api_url</span> <span class="o">=</span> <span class="n">api_url</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_init_stub</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="dispatch.client.Client.dispatch" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">dispatch</span><span class="p">(</span><span class="n">calls</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Dispatch function calls.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>calls</code></td>
          <td>
                <code><span title="typing.Iterable">Iterable</span>[<a class="autorefs autorefs-internal" title="dispatch.proto.Call" href="#dispatch.proto.Call">Call</a>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Calls to dispatch.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Iterable">Iterable</span>[<a class="autorefs autorefs-internal" title="dispatch.id.DispatchID" href="#dispatch.id.DispatchID">DispatchID</a>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Identifiers for the function calls, in the same order as the inputs.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>dispatch/client.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">calls</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Call</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">DispatchID</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dispatch function calls.</span>

<span class="sd">    Args:</span>
<span class="sd">        calls: Calls to dispatch.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Identifiers for the function calls, in the same order as the inputs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">calls_proto</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">_as_proto</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">calls</span><span class="p">]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;dispatching </span><span class="si">%d</span><span class="s2"> function call(s)&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">calls_proto</span><span class="p">))</span>
    <span class="n">req</span> <span class="o">=</span> <span class="n">dispatch_pb</span><span class="o">.</span><span class="n">DispatchRequest</span><span class="p">(</span><span class="n">calls</span><span class="o">=</span><span class="n">calls_proto</span><span class="p">)</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stub</span><span class="o">.</span><span class="n">Dispatch</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
    <span class="n">dispatch_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">DispatchID</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">dispatch_ids</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">logger</span><span class="o">.</span><span class="n">isEnabledFor</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;dispatched </span><span class="si">%d</span><span class="s2"> function call(s): </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">calls_proto</span><span class="p">),</span>
            <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dispatch_ids</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">dispatch_ids</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="dispatch.coroutine" class="doc doc-heading">
          <code>coroutine</code>


</h2>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="dispatch.coroutine.CoroutineState" class="doc doc-heading">
          <code>CoroutineState</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">

  
      <p>Serialized representation of a coroutine.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/coroutine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">CoroutineState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Serialized representation of a coroutine.&quot;&quot;&quot;</span>

    <span class="n">coroutine</span><span class="p">:</span> <span class="n">DurableCoroutine</span>
    <span class="n">version</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>



<div class="doc doc-object doc-function">



<h3 id="dispatch.coroutine.exit" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">exit</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tail_call</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Exit exits a coroutine, with an optional result and
optional tail call.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/coroutine.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@coroutine</span>
<span class="nd">@durable</span>
<span class="k">def</span> <span class="nf">exit</span><span class="p">(</span><span class="n">result</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tail_call</span><span class="p">:</span> <span class="n">Call</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Exit exits a coroutine, with an optional result and</span>
<span class="sd">    optional tail call.&quot;&quot;&quot;</span>
    <span class="k">yield</span> <span class="n">Exit</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">tail_call</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="dispatch.coroutine.poll" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">poll</span><span class="p">(</span><span class="n">calls</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Suspend the function with a set of Calls, instructing the
orchestrator to resume the coroutine when call results are ready.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/coroutine.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@coroutine</span>
<span class="nd">@durable</span>
<span class="k">def</span> <span class="nf">poll</span><span class="p">(</span><span class="n">calls</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Call</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">CallResult</span><span class="p">]:</span>  <span class="c1"># type: ignore[misc]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Suspend the function with a set of Calls, instructing the</span>
<span class="sd">    orchestrator to resume the coroutine when call results are ready.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">yield</span> <span class="n">Poll</span><span class="p">(</span><span class="n">calls</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="dispatch.coroutine.schedule" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">schedule</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="nb">input</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Schedule schedules a coroutine with the provided input.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/coroutine.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">schedule</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">DurableFunction</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">Input</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Schedule schedules a coroutine with the provided input.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># (Re)hydrate the coroutine.</span>
        <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">is_first_call</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;starting coroutine&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">input_arguments</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;incorrect input for function&quot;</span><span class="p">)</span>

            <span class="n">coro</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">send</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;resuming coroutine with </span><span class="si">%d</span><span class="s2"> bytes of state and </span><span class="si">%d</span><span class="s2"> call result(s)&quot;</span><span class="p">,</span>
                <span class="nb">len</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">coroutine_state</span><span class="p">),</span>
                <span class="nb">len</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">call_results</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">coroutine_state</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">coroutine_state</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coroutine_state</span><span class="p">,</span> <span class="n">CoroutineState</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;invalid coroutine state&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">coroutine_state</span><span class="o">.</span><span class="n">version</span> <span class="o">!=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;coroutine state version mismatch: &#39;</span><span class="si">{</span><span class="n">coroutine_state</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">&#39; vs. current &#39;</span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                    <span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">PickleError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;coroutine state is incompatible&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">Output</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="n">Error</span><span class="o">.</span><span class="n">from_exception</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">Status</span><span class="o">.</span><span class="n">INCOMPATIBLE_STATE</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="n">coro</span> <span class="o">=</span> <span class="n">coroutine_state</span><span class="o">.</span><span class="n">coroutine</span>
            <span class="n">send</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">call_results</span>

        <span class="c1"># Run the coroutine until its next yield or return.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">directive</span> <span class="o">=</span> <span class="n">coro</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">send</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;coroutine returned&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Output</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="c1"># Handle directives that it yields.</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;handling coroutine directive: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">directive</span><span class="p">)</span>
        <span class="k">match</span> <span class="n">directive</span><span class="p">:</span>
            <span class="k">case</span> <span class="n">Exit</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">Output</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span>
                    <span class="n">result</span><span class="o">=</span><span class="n">CallResult</span><span class="o">.</span><span class="n">from_value</span><span class="p">(</span><span class="n">directive</span><span class="o">.</span><span class="n">result</span><span class="p">),</span>
                    <span class="n">tail_call</span><span class="o">=</span><span class="n">directive</span><span class="o">.</span><span class="n">tail_call</span><span class="p">,</span>
                    <span class="n">status</span><span class="o">=</span><span class="n">status_for_output</span><span class="p">(</span><span class="n">directive</span><span class="o">.</span><span class="n">result</span><span class="p">),</span>
                <span class="p">)</span>

            <span class="k">case</span> <span class="n">Poll</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">coroutine_state</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
                        <span class="n">CoroutineState</span><span class="p">(</span><span class="n">coroutine</span><span class="o">=</span><span class="n">coro</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="n">pickle</span><span class="o">.</span><span class="n">PickleError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;coroutine could not be serialized&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">Output</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="n">Error</span><span class="o">.</span><span class="n">from_exception</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">Status</span><span class="o">.</span><span class="n">PERMANENT_ERROR</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">return</span> <span class="n">Output</span><span class="o">.</span><span class="n">poll</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="n">coroutine_state</span><span class="p">,</span> <span class="n">calls</span><span class="o">=</span><span class="n">directive</span><span class="o">.</span><span class="n">calls</span><span class="p">)</span>

            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;coroutine unexpectedly yielded &#39;</span><span class="si">{</span><span class="n">directive</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;@dispatch.coroutine: &#39;</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; raised an exception&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Output</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">Error</span><span class="o">.</span><span class="n">from_exception</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="dispatch.experimental" class="doc doc-heading">
          <code>experimental</code>


</h2>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="dispatch.experimental.durable" class="doc doc-heading">
          <code>durable</code>


</h3>

  <div class="doc doc-contents ">
  
      <p>A decorator that makes generators and coroutines serializable.</p>
<p>This module defines a @durable decorator that can be applied to generator
functions and async functions. The generator and coroutine instances
they create can be pickled.</p>
<p>Example usage:</p>
<pre><code>import pickle
from dispatch.experimental.durable import durable

@durable
def my_generator():
    for i in range(3):
        yield i

# Run the generator to its first yield point:
g = my_generator()
print(next(g))  # 0

# Make a copy, and consume the remaining items:
b = pickle.dumps(g)
g2 = pickle.loads(b)
print(next(g2))  # 1
print(next(g2))  # 2

# The original is not affected:
print(next(g))  # 1
print(next(g))  # 2
</code></pre>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h4 id="dispatch.experimental.durable.durable" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">durable</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Returns a "durable" function that creates serializable
generators or coroutines.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>fn</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A generator function or async function.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>dispatch/experimental/durable/function.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">durable</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DurableFunction</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a &quot;durable&quot; function that creates serializable</span>
<span class="sd">    generators or coroutines.</span>

<span class="sd">    Args:</span>
<span class="sd">        fn: A generator function or async function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">DurableFunction</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-module">



<h4 id="dispatch.experimental.durable.frame" class="doc doc-heading">
          <code>frame</code>


</h4>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="dispatch.experimental.durable.frame.__file__" class="doc doc-heading">
          <code class="highlight language-python"><span class="vm">__file__</span> <span class="o">=</span> <span class="s1">&#39;/opt/hostedtoolcache/Python/3.11.8/x64/lib/python3.11/site-packages/dispatch/experimental/durable/frame.cpython-311-x86_64-linux-gnu.so&#39;</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>str(object='') -&gt; str
str(bytes_or_buffer[, encoding[, errors]]) -&gt; str</p>
<p>Create a new string object from the given object. If encoding or
errors is specified, then the object must expose a data buffer
that will be decoded using the given encoding and error handler.
Otherwise, returns the result of object.<strong>str</strong>() (if defined)
or repr(object).
encoding defaults to sys.getdefaultencoding().
errors defaults to 'strict'.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="dispatch.experimental.durable.frame.__name__" class="doc doc-heading">
          <code class="highlight language-python"><span class="vm">__name__</span> <span class="o">=</span> <span class="s1">&#39;dispatch.experimental.durable.frame&#39;</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>str(object='') -&gt; str
str(bytes_or_buffer[, encoding[, errors]]) -&gt; str</p>
<p>Create a new string object from the given object. If encoding or
errors is specified, then the object must expose a data buffer
that will be decoded using the given encoding and error handler.
Otherwise, returns the result of object.<strong>str</strong>() (if defined)
or repr(object).
encoding defaults to sys.getdefaultencoding().
errors defaults to 'strict'.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="dispatch.experimental.durable.frame.__package__" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">__package__</span> <span class="o">=</span> <span class="s1">&#39;dispatch.experimental.durable&#39;</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>str(object='') -&gt; str
str(bytes_or_buffer[, encoding[, errors]]) -&gt; str</p>
<p>Create a new string object from the given object. If encoding or
errors is specified, then the object must expose a data buffer
that will be decoded using the given encoding and error handler.
Otherwise, returns the result of object.<strong>str</strong>() (if defined)
or repr(object).
encoding defaults to sys.getdefaultencoding().
errors defaults to 'strict'.</p>
  </div>

</div>




<div class="doc doc-object doc-function">



<h5 id="dispatch.experimental.durable.frame.get_frame_ip" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_frame_ip</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-builtin"><code>builtin</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Get instruction pointer of a generator or coroutine.</p>

  </div>

</div>


<div class="doc doc-object doc-function">



<h5 id="dispatch.experimental.durable.frame.get_frame_sp" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_frame_sp</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-builtin"><code>builtin</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Get stack pointer of a generator or coroutine.</p>

  </div>

</div>


<div class="doc doc-object doc-function">



<h5 id="dispatch.experimental.durable.frame.get_frame_stack_at" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_frame_stack_at</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-builtin"><code>builtin</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Get an object from a generator or coroutine's stack, as an (is_null, obj) tuple.</p>

  </div>

</div>


<div class="doc doc-object doc-function">



<h5 id="dispatch.experimental.durable.frame.get_frame_state" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_frame_state</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-builtin"><code>builtin</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Get frame state of a generator or coroutine.</p>

  </div>

</div>


<div class="doc doc-object doc-function">



<h5 id="dispatch.experimental.durable.frame.set_frame_ip" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">set_frame_ip</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-builtin"><code>builtin</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Set instruction pointer of a generator or coroutine.</p>

  </div>

</div>


<div class="doc doc-object doc-function">



<h5 id="dispatch.experimental.durable.frame.set_frame_sp" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">set_frame_sp</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-builtin"><code>builtin</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Set stack pointer of a generator or coroutine.</p>

  </div>

</div>


<div class="doc doc-object doc-function">



<h5 id="dispatch.experimental.durable.frame.set_frame_stack_at" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">set_frame_stack_at</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-builtin"><code>builtin</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Set or unset an object on the stack of a generator or coroutine.</p>

  </div>

</div>


<div class="doc doc-object doc-function">



<h5 id="dispatch.experimental.durable.frame.set_frame_state" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">set_frame_state</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-builtin"><code>builtin</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Set frame state of a generator or coroutine.</p>

  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="dispatch.experimental.durable.function" class="doc doc-heading">
          <code>function</code>


</h4>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="dispatch.experimental.durable.function.DurableCoroutine" class="doc doc-heading">
          <code>DurableCoroutine</code>


</h5>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="dispatch.experimental.durable.serializable.Serializable" href="#dispatch.experimental.durable.serializable.Serializable">Serializable</a></code>, <code><span title="typing.Coroutine">Coroutine</span>[<span title="dispatch.experimental.durable.function._YieldT">_YieldT</span>, <span title="dispatch.experimental.durable.function._SendT">_SendT</span>, <span title="dispatch.experimental.durable.function._ReturnT">_ReturnT</span>]</code></p>

  
      <p>A wrapper for a coroutine that makes it serializable (can be pickled).
Instances behave like the coroutines they wrap.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/experimental/durable/function.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DurableCoroutine</span><span class="p">(</span><span class="n">Serializable</span><span class="p">,</span> <span class="n">Coroutine</span><span class="p">[</span><span class="n">_YieldT</span><span class="p">,</span> <span class="n">_SendT</span><span class="p">,</span> <span class="n">_ReturnT</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A wrapper for a coroutine that makes it serializable (can be pickled).</span>
<span class="sd">    Instances behave like the coroutines they wrap.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">coroutine</span><span class="p">:</span> <span class="n">CoroutineType</span><span class="p">,</span>
        <span class="n">registered_fn</span><span class="p">:</span> <span class="n">RegisteredFunction</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coroutine</span> <span class="o">=</span> <span class="n">coroutine</span>
        <span class="n">Serializable</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coroutine</span><span class="p">,</span> <span class="n">registered_fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__await__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">_ReturnT</span><span class="p">]:</span>
        <span class="n">coroutine_wrapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coroutine</span><span class="o">.</span><span class="fm">__await__</span><span class="p">()</span>
        <span class="n">generator</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">GeneratorType</span><span class="p">,</span> <span class="n">coroutine_wrapper</span><span class="p">)</span>
        <span class="n">durable_coroutine_wrapper</span><span class="p">:</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">_ReturnT</span><span class="p">]</span> <span class="o">=</span> <span class="n">DurableGenerator</span><span class="p">(</span>
            <span class="n">generator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">registered_fn</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="n">coro_await</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">durable_coroutine_wrapper</span>

    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">send</span><span class="p">:</span> <span class="n">_SendT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_YieldT</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coroutine</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">send</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">throw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tb</span><span class="p">:</span> <span class="n">TracebackType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_YieldT</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coroutine</span><span class="o">.</span><span class="n">throw</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">tb</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coroutine</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">Serializable</span><span class="o">.</span><span class="n">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coroutine</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">CoroutineType</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cr_running</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coroutine</span><span class="o">.</span><span class="n">cr_running</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cr_suspended</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coroutine</span><span class="o">.</span><span class="n">cr_suspended</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cr_code</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CodeType</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coroutine</span><span class="o">.</span><span class="n">cr_code</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cr_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FrameType</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coroutine</span><span class="o">.</span><span class="n">cr_frame</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cr_await</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coroutine</span><span class="o">.</span><span class="n">cr_await</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cr_origin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coroutine</span><span class="o">.</span><span class="n">cr_origin</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h5 id="dispatch.experimental.durable.function.DurableFunction" class="doc doc-heading">
          <code>DurableFunction</code>


</h5>


  <div class="doc doc-contents ">

  
      <p>A wrapper for generator functions and async functions that make
their generator and coroutine instances serializable.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/experimental/durable/function.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DurableFunction</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A wrapper for generator functions and async functions that make</span>
<span class="sd">    their generator and coroutine instances serializable.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">:</span> <span class="n">FunctionType</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registered_fn</span> <span class="o">=</span> <span class="n">register_function</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">registered_fn</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">GeneratorType</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">DurableGenerator</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">registered_fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">CoroutineType</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">DurableCoroutine</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">registered_fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">AsyncGeneratorType</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;only synchronous generator functions are supported at this time&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;@durable function did not return a generator or coroutine&quot;</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">__name__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">registered_fn</span><span class="o">.</span><span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h5 id="dispatch.experimental.durable.function.DurableGenerator" class="doc doc-heading">
          <code>DurableGenerator</code>


</h5>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="dispatch.experimental.durable.serializable.Serializable" href="#dispatch.experimental.durable.serializable.Serializable">Serializable</a></code>, <code><span title="typing.Generator">Generator</span>[<span title="dispatch.experimental.durable.function._YieldT">_YieldT</span>, <span title="dispatch.experimental.durable.function._SendT">_SendT</span>, <span title="dispatch.experimental.durable.function._ReturnT">_ReturnT</span>]</code></p>

  
      <p>A wrapper for a generator that makes it serializable (can be pickled).
Instances behave like the generators they wrap.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/experimental/durable/function.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DurableGenerator</span><span class="p">(</span><span class="n">Serializable</span><span class="p">,</span> <span class="n">Generator</span><span class="p">[</span><span class="n">_YieldT</span><span class="p">,</span> <span class="n">_SendT</span><span class="p">,</span> <span class="n">_ReturnT</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A wrapper for a generator that makes it serializable (can be pickled).</span>
<span class="sd">    Instances behave like the generators they wrap.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">generator</span><span class="p">:</span> <span class="n">GeneratorType</span><span class="p">,</span>
        <span class="n">registered_fn</span><span class="p">:</span> <span class="n">RegisteredFunction</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">coro_await</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generator</span> <span class="o">=</span> <span class="n">generator</span>
        <span class="n">Serializable</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">registered_fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">coro_await</span><span class="o">=</span><span class="n">coro_await</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">_YieldT</span><span class="p">,</span> <span class="n">_SendT</span><span class="p">,</span> <span class="n">_ReturnT</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_YieldT</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">send</span><span class="p">:</span> <span class="n">_SendT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_YieldT</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">send</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">throw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tb</span><span class="p">:</span> <span class="n">TracebackType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_YieldT</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">throw</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">tb</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">Serializable</span><span class="o">.</span><span class="n">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generator</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">GeneratorType</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gi_running</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">gi_running</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gi_suspended</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">gi_suspended</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gi_code</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CodeType</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">gi_code</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gi_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FrameType</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">gi_frame</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gi_yieldfrom</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeneratorType</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">gi_yieldfrom</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>



<div class="doc doc-object doc-function">



<h5 id="dispatch.experimental.durable.function.durable" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">durable</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Returns a "durable" function that creates serializable
generators or coroutines.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>fn</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A generator function or async function.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>dispatch/experimental/durable/function.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">durable</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DurableFunction</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a &quot;durable&quot; function that creates serializable</span>
<span class="sd">    generators or coroutines.</span>

<span class="sd">    Args:</span>
<span class="sd">        fn: A generator function or async function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">DurableFunction</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="dispatch.experimental.durable.registry" class="doc doc-heading">
          <code>registry</code>


</h4>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="dispatch.experimental.durable.registry.RegisteredFunction" class="doc doc-heading">
          <code>RegisteredFunction</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

  
      <p>A function that can be referenced in durable state.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/experimental/durable/registry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">RegisteredFunction</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A function that can be referenced in durable state.&quot;&quot;&quot;</span>

    <span class="n">key</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">fn</span><span class="p">:</span> <span class="n">FunctionType</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">lineno</span><span class="p">:</span> <span class="nb">int</span>
    <span class="nb">hash</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>



<div class="doc doc-object doc-function">



<h5 id="dispatch.experimental.durable.registry.lookup_function" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">lookup_function</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Lookup a registered function by key.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>key</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Unique identifier for the function.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>RegisteredFunction</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="dispatch.experimental.durable.registry.RegisteredFunction" href="#dispatch.experimental.durable.registry.RegisteredFunction">RegisteredFunction</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the function that was registered with the specified key.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>KeyError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A function has not been registered with this key.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>dispatch/experimental/durable/registry.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">lookup_function</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RegisteredFunction</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Lookup a registered function by key.</span>

<span class="sd">    Args:</span>
<span class="sd">        key: Unique identifier for the function.</span>

<span class="sd">    Returns:</span>
<span class="sd">        RegisteredFunction: the function that was registered with the specified key.</span>

<span class="sd">    Raises:</span>
<span class="sd">        KeyError: A function has not been registered with this key.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_REGISTRY</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h5 id="dispatch.experimental.durable.registry.register_function" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">register_function</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Register a function in the in-memory function registry.</p>
<p>When serializing a registered function, a reference to the function
is stored along with details about its location and contents. When
deserializing the function, the registry is consulted in order to
find the function associated with the reference (and in order to
check whether the function is the same).</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>fn</code></td>
          <td>
                <code><span title="types.FunctionType">FunctionType</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The function to register.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="dispatch.experimental.durable.registry.RegisteredFunction" href="#dispatch.experimental.durable.registry.RegisteredFunction">RegisteredFunction</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Unique identifier for the function.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>ValueError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The function conflicts with another registered function.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>dispatch/experimental/durable/registry.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">register_function</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="n">FunctionType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RegisteredFunction</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Register a function in the in-memory function registry.</span>

<span class="sd">    When serializing a registered function, a reference to the function</span>
<span class="sd">    is stored along with details about its location and contents. When</span>
<span class="sd">    deserializing the function, the registry is consulted in order to</span>
<span class="sd">    find the function associated with the reference (and in order to</span>
<span class="sd">    check whether the function is the same).</span>

<span class="sd">    Args:</span>
<span class="sd">        fn: The function to register.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Unique identifier for the function.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: The function conflicts with another registered function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="vm">__code__</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">co_qualname</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">_REGISTRY</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;durable function already registered with key </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">filename</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">co_filename</span>
    <span class="n">lineno</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">co_firstlineno</span>
    <span class="n">code_hash</span> <span class="o">=</span> <span class="s2">&quot;sha256:&quot;</span> <span class="o">+</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">code</span><span class="o">.</span><span class="n">co_code</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="n">wrapper</span> <span class="o">=</span> <span class="n">RegisteredFunction</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="nb">hash</span><span class="o">=</span><span class="n">code_hash</span>
    <span class="p">)</span>

    <span class="n">_REGISTRY</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">wrapper</span>
    <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="dispatch.experimental.durable.serializable" class="doc doc-heading">
          <code>serializable</code>


</h4>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="dispatch.experimental.durable.serializable.Serializable" class="doc doc-heading">
          <code>Serializable</code>


</h5>


  <div class="doc doc-contents ">

  
      <p>A wrapper for a generator or coroutine that makes it serializable.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/experimental/durable/serializable.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Serializable</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A wrapper for a generator or coroutine that makes it serializable.&quot;&quot;&quot;</span>

    <span class="n">g</span><span class="p">:</span> <span class="n">GeneratorType</span> <span class="o">|</span> <span class="n">CoroutineType</span>
    <span class="n">registered_fn</span><span class="p">:</span> <span class="n">RegisteredFunction</span>
    <span class="n">coro_await</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">args</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
    <span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">g</span><span class="p">:</span> <span class="n">GeneratorType</span> <span class="o">|</span> <span class="n">CoroutineType</span><span class="p">,</span>
        <span class="n">registered_fn</span><span class="p">:</span> <span class="n">RegisteredFunction</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">coro_await</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="n">g</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registered_fn</span> <span class="o">=</span> <span class="n">registered_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coro_await</span> <span class="o">=</span> <span class="n">coro_await</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span>
        <span class="n">rfn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">registered_fn</span>

        <span class="c1"># Capture the details necessary to recreate the generator.</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">ext</span><span class="o">.</span><span class="n">get_frame_ip</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="n">ext</span><span class="o">.</span><span class="n">get_frame_sp</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="n">frame_state</span> <span class="o">=</span> <span class="n">ext</span><span class="o">.</span><span class="n">get_frame_state</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="p">[</span><span class="n">ext</span><span class="o">.</span><span class="n">get_frame_stack_at</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ext</span><span class="o">.</span><span class="n">get_frame_sp</span><span class="p">(</span><span class="n">g</span><span class="p">))]</span>

        <span class="k">if</span> <span class="n">TRACE</span><span class="p">:</span>
            <span class="n">typ</span> <span class="o">=</span> <span class="s2">&quot;GENERATOR&quot;</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">GeneratorType</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;COROUTINE&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[DURABLE] </span><span class="si">{</span><span class="n">typ</span><span class="si">}</span><span class="s2"> STATE (</span><span class="si">{</span><span class="n">rfn</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">):&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;function = </span><span class="si">{</span><span class="n">rfn</span><span class="o">.</span><span class="n">fn</span><span class="o">.</span><span class="vm">__qualname__</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">rfn</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">rfn</span><span class="o">.</span><span class="n">lineno</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;code hash = </span><span class="si">{</span><span class="n">rfn</span><span class="o">.</span><span class="n">hash</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;args = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;kwargs = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;coro await = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">coro_await</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;IP = </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SP = </span><span class="si">{</span><span class="n">sp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;frame state = </span><span class="si">{</span><span class="n">frame_state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">is_null</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stack</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">is_null</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;stack[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] = NULL&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;stack[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] = </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>

        <span class="n">state</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="n">rfn</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
                <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="n">rfn</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                <span class="s2">&quot;lineno&quot;</span><span class="p">:</span> <span class="n">rfn</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                <span class="s2">&quot;hash&quot;</span><span class="p">:</span> <span class="n">rfn</span><span class="o">.</span><span class="n">hash</span><span class="p">,</span>
                <span class="s2">&quot;coro_await&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coro_await</span><span class="p">,</span>
                <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span>
                <span class="s2">&quot;kwargs&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;frame&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="n">ip</span><span class="p">,</span>
                <span class="s2">&quot;sp&quot;</span><span class="p">:</span> <span class="n">sp</span><span class="p">,</span>
                <span class="s2">&quot;stack&quot;</span><span class="p">:</span> <span class="n">stack</span><span class="p">,</span>
                <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="n">frame_state</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">function_state</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;function&quot;</span><span class="p">]</span>
        <span class="n">frame_state</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;frame&quot;</span><span class="p">]</span>

        <span class="c1"># Recreate the generator/coroutine by looking up the constructor</span>
        <span class="c1"># and calling it with the same args/kwargs.</span>
        <span class="n">key</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">code_hash</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">coro_await</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">function_state</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">],</span>
            <span class="n">function_state</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">],</span>
            <span class="n">function_state</span><span class="p">[</span><span class="s2">&quot;lineno&quot;</span><span class="p">],</span>
            <span class="n">function_state</span><span class="p">[</span><span class="s2">&quot;hash&quot;</span><span class="p">],</span>
            <span class="n">function_state</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">],</span>
            <span class="n">function_state</span><span class="p">[</span><span class="s2">&quot;kwargs&quot;</span><span class="p">],</span>
            <span class="n">function_state</span><span class="p">[</span><span class="s2">&quot;coro_await&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">rfn</span> <span class="o">=</span> <span class="n">lookup_function</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="o">!=</span> <span class="n">rfn</span><span class="o">.</span><span class="n">filename</span> <span class="ow">or</span> <span class="n">lineno</span> <span class="o">!=</span> <span class="n">rfn</span><span class="o">.</span><span class="n">lineno</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;location mismatch for function </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">lineno</span><span class="si">}</span><span class="s2"> vs. expected </span><span class="si">{</span><span class="n">rfn</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">rfn</span><span class="o">.</span><span class="n">lineno</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">code_hash</span> <span class="o">!=</span> <span class="n">rfn</span><span class="o">.</span><span class="n">hash</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;hash mismatch for function </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">code_hash</span><span class="si">}</span><span class="s2"> vs. expected </span><span class="si">{</span><span class="n">rfn</span><span class="o">.</span><span class="n">hash</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">g</span> <span class="o">=</span> <span class="n">rfn</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">coro_await</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="fm">__await__</span><span class="p">()</span>

        <span class="c1"># Restore the frame state (stack + stack pointer + instruction pointer).</span>
        <span class="n">ext</span><span class="o">.</span><span class="n">set_frame_ip</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">frame_state</span><span class="p">[</span><span class="s2">&quot;ip&quot;</span><span class="p">])</span>
        <span class="n">ext</span><span class="o">.</span><span class="n">set_frame_sp</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">frame_state</span><span class="p">[</span><span class="s2">&quot;sp&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">is_null</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frame_state</span><span class="p">[</span><span class="s2">&quot;stack&quot;</span><span class="p">]):</span>
            <span class="n">ext</span><span class="o">.</span><span class="n">set_frame_stack_at</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">is_null</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="n">ext</span><span class="o">.</span><span class="n">set_frame_state</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">frame_state</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="n">g</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registered_fn</span> <span class="o">=</span> <span class="n">rfn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coro_await</span> <span class="o">=</span> <span class="n">coro_await</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>




  </div>

  </div>

</div>


  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="dispatch.experimental.multicolor" class="doc doc-heading">
          <code>multicolor</code>


</h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="dispatch.experimental.multicolor.CustomYield" class="doc doc-heading">
          <code>CustomYield</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="dispatch.experimental.multicolor.yields.YieldType" href="#dispatch.experimental.multicolor.yields.YieldType">YieldType</a></code></p>

  
      <p>A yield from a function marked with @yields.</p>



  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code><span title="dispatch.experimental.multicolor.CustomYield.type">type</span></code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The type of yield that was specified in the @yields decorator.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="dispatch.experimental.multicolor.CustomYield.args">args</span></code></td>
          <td>
                <code>list[<span title="typing.Any">Any</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Positional arguments to the function call.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="dispatch.experimental.multicolor.CustomYield.kwargs">kwargs</span></code></td>
          <td>
                <code>dict[str, <span title="typing.Any">Any</span>] | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Keyword arguments to the function call.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>dispatch/experimental/multicolor/yields.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">CustomYield</span><span class="p">(</span><span class="n">YieldType</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A yield from a function marked with @yields.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        type: The type of yield that was specified in the @yields decorator.</span>
<span class="sd">        args: Positional arguments to the function call.</span>
<span class="sd">        kwargs: Keyword arguments to the function call.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">type</span><span class="p">:</span> <span class="n">Any</span>
    <span class="n">args</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
    <span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">kwarg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h4 id="dispatch.experimental.multicolor.GeneratorYield" class="doc doc-heading">
          <code>GeneratorYield</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="dispatch.experimental.multicolor.yields.YieldType" href="#dispatch.experimental.multicolor.yields.YieldType">YieldType</a></code></p>

  
      <p>A yield from a generator.</p>



  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code><span title="dispatch.experimental.multicolor.GeneratorYield.value">value</span></code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The value that was yielded from the generator.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>dispatch/experimental/multicolor/yields.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">GeneratorYield</span><span class="p">(</span><span class="n">YieldType</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A yield from a generator.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        value: The value that was yielded from the generator.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">value</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h4 id="dispatch.experimental.multicolor.NoSourceError" class="doc doc-heading">
          <code>NoSourceError</code>


</h4>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code>RuntimeError</code></p>

  
      <p>Function source code is not available.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/experimental/multicolor/parse.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NoSourceError</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function source code is not available.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>

  </div>


</div>



<div class="doc doc-object doc-function">



<h4 id="dispatch.experimental.multicolor.compile_function" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">compile_function</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">decorator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cache_key</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Compile a regular function into a generator that yields data passed
to functions marked with the @multicolor.yields decorator. Decorated yield
functions can be called from anywhere in the call stack, and functions
in between do not have to be generators or async functions (coroutines).</p>
<p>Example:</p>
<pre><code>@multicolor.yields(type="sleep")
def sleep(seconds): ...

def parent():
    sleep(3)  # yield point

def grandparent():
    parent()

compiled_grandparent = multicolor.compile_function(grandparent)
generator = compiled_grandparent()
for item in generator:
    print(item)  # multicolor.CustomYield(type="sleep", args=[3])
</code></pre>
<p>Two-way data flow works as expected. At a yield point, generator.send(value)
can be used to send data back to the yield point and to resume execution.
The data sent back will be the return value of the function decorated with
@multicolor.yields:</p>
<pre><code>@multicolor.yields(type="add")
def add(a: int, b: int) -&gt; int:
    return a + b  # default/synchronous implementation

def scheduler(generator):
    try:
        send = None
        while True:
            item = generator.send(send)
            match item:
                case multicolor.CustomYield(type="add"):
                    a, b = item.args
                    print(f"adding {a} + {b}")
                    send = a + b
    except StopIteration as e:
        return e.value  # return value

def adder(a: int, b: int) -&gt; int:
    return add(a, b)

compiled_adder = multicolor.compile_function(adder)
generator = compiled_adder(1, 2)
result = scheduler(generator)
print(result) # 3
</code></pre>
<p>The @multicolor.yields decorator does not change the implementation of
the function it decorates. If the function is run without being
compiled, the default implementation will be used instead:</p>
<pre><code>print(adder(1, 2))  # 3
</code></pre>
<p>The default implementation could also raise an error, to ensure that
the function is only ever called from a compiled function.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>fn</code></td>
          <td>
                <code><span title="types.FunctionType">FunctionType</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The function to compile.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>decorator</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An optional decorator to apply to the compiled function.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>cache_key</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Cache key to use when caching compiled functions.</p>
            </div>
          </td>
          <td>
                <code>&#39;default&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>FunctionType</code></td>          <td>
                <code><span title="types.FunctionType">FunctionType</span> | <span title="types.MethodType">MethodType</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A compiled generator function.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>dispatch/experimental/multicolor/compile.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compile_function</span><span class="p">(</span>
    <span class="n">fn</span><span class="p">:</span> <span class="n">FunctionType</span><span class="p">,</span> <span class="n">decorator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cache_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FunctionType</span> <span class="o">|</span> <span class="n">MethodType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compile a regular function into a generator that yields data passed</span>
<span class="sd">    to functions marked with the @multicolor.yields decorator. Decorated yield</span>
<span class="sd">    functions can be called from anywhere in the call stack, and functions</span>
<span class="sd">    in between do not have to be generators or async functions (coroutines).</span>

<span class="sd">    Example:</span>

<span class="sd">        @multicolor.yields(type=&quot;sleep&quot;)</span>
<span class="sd">        def sleep(seconds): ...</span>

<span class="sd">        def parent():</span>
<span class="sd">            sleep(3)  # yield point</span>

<span class="sd">        def grandparent():</span>
<span class="sd">            parent()</span>

<span class="sd">        compiled_grandparent = multicolor.compile_function(grandparent)</span>
<span class="sd">        generator = compiled_grandparent()</span>
<span class="sd">        for item in generator:</span>
<span class="sd">            print(item)  # multicolor.CustomYield(type=&quot;sleep&quot;, args=[3])</span>

<span class="sd">    Two-way data flow works as expected. At a yield point, generator.send(value)</span>
<span class="sd">    can be used to send data back to the yield point and to resume execution.</span>
<span class="sd">    The data sent back will be the return value of the function decorated with</span>
<span class="sd">    @multicolor.yields:</span>

<span class="sd">        @multicolor.yields(type=&quot;add&quot;)</span>
<span class="sd">        def add(a: int, b: int) -&gt; int:</span>
<span class="sd">            return a + b  # default/synchronous implementation</span>

<span class="sd">        def scheduler(generator):</span>
<span class="sd">            try:</span>
<span class="sd">                send = None</span>
<span class="sd">                while True:</span>
<span class="sd">                    item = generator.send(send)</span>
<span class="sd">                    match item:</span>
<span class="sd">                        case multicolor.CustomYield(type=&quot;add&quot;):</span>
<span class="sd">                            a, b = item.args</span>
<span class="sd">                            print(f&quot;adding {a} + {b}&quot;)</span>
<span class="sd">                            send = a + b</span>
<span class="sd">            except StopIteration as e:</span>
<span class="sd">                return e.value  # return value</span>

<span class="sd">        def adder(a: int, b: int) -&gt; int:</span>
<span class="sd">            return add(a, b)</span>

<span class="sd">        compiled_adder = multicolor.compile_function(adder)</span>
<span class="sd">        generator = compiled_adder(1, 2)</span>
<span class="sd">        result = scheduler(generator)</span>
<span class="sd">        print(result) # 3</span>

<span class="sd">    The @multicolor.yields decorator does not change the implementation of</span>
<span class="sd">    the function it decorates. If the function is run without being</span>
<span class="sd">    compiled, the default implementation will be used instead:</span>

<span class="sd">        print(adder(1, 2))  # 3</span>

<span class="sd">    The default implementation could also raise an error, to ensure that</span>
<span class="sd">    the function is only ever called from a compiled function.</span>

<span class="sd">    Args:</span>
<span class="sd">        fn: The function to compile.</span>
<span class="sd">        decorator: An optional decorator to apply to the compiled function.</span>
<span class="sd">        cache_key: Cache key to use when caching compiled functions.</span>

<span class="sd">    Returns:</span>
<span class="sd">        FunctionType: A compiled generator function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">compiled_fn</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_compile_internal</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">decorator</span><span class="p">,</span> <span class="n">cache_key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">compiled_fn</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="dispatch.experimental.multicolor.no_yields" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">no_yields</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Decorator that hints that a function (and anything called
recursively) does not yield.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/experimental/multicolor/yields.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">no_yields</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorator that hints that a function (and anything called</span>
<span class="sd">    recursively) does not yield.&quot;&quot;&quot;</span>
    <span class="n">fn</span><span class="o">.</span><span class="n">_multicolor_no_yields</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># type: ignore[attr-defined]</span>
    <span class="k">return</span> <span class="n">fn</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-module">



<h4 id="dispatch.experimental.multicolor.compile" class="doc doc-heading">
          <code>compile</code>


</h4>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="dispatch.experimental.multicolor.compile.CallTransformer" class="doc doc-heading">
          <code>CallTransformer</code>


</h5>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="ast.NodeTransformer">NodeTransformer</span></code></p>

  
      <p>Replace explicit function calls with a gadget that recursively compiles
functions into generators and then replaces the function call with a
yield from.</p>
<p>The transformations are only valid for ASTs that have passed through the
desugaring pass; only ast.Expr(value=ast.Call(...)) and
ast.Assign(targets=..., value=ast.Call(..)) nodes are transformed here.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/experimental/multicolor/compile.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CallTransformer</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">NodeTransformer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Replace explicit function calls with a gadget that recursively compiles</span>
<span class="sd">    functions into generators and then replaces the function call with a</span>
<span class="sd">    yield from.</span>

<span class="sd">    The transformations are only valid for ASTs that have passed through the</span>
<span class="sd">    desugaring pass; only ast.Expr(value=ast.Call(...)) and</span>
<span class="sd">    ast.Assign(targets=..., value=ast.Call(..)) nodes are transformed here.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">visit_Assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">node</span>
        <span class="n">assign_stmt</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">(</span><span class="n">targets</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_call_gadget</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">assign_stmt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">visit_Expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">node</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_call_gadget</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_build_call_gadget</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">fn_call</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">,</span> <span class="n">assign</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">:</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">fn_call</span><span class="o">.</span><span class="n">func</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">elts</span><span class="o">=</span><span class="n">fn_call</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">fn_call</span><span class="o">.</span><span class="n">keywords</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">expr</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;dict&quot;</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">()),</span>
                <span class="n">args</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">keywords</span><span class="o">=</span><span class="n">fn_call</span><span class="o">.</span><span class="n">keywords</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="n">compiled_fn</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;_multicolor_compiled_fn&quot;</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Store</span><span class="p">())</span>
        <span class="n">compiled_fn_call</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span>
            <span class="n">func</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;_multicolor_compiled_fn&quot;</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">()),</span>
            <span class="n">args</span><span class="o">=</span><span class="n">fn_call</span><span class="o">.</span><span class="n">args</span><span class="p">,</span>
            <span class="n">keywords</span><span class="o">=</span><span class="n">fn_call</span><span class="o">.</span><span class="n">keywords</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">assign</span><span class="p">:</span>
            <span class="n">assign</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;_multicolor_result&quot;</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">())</span>
            <span class="n">assign_result</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">stmt</span> <span class="o">=</span> <span class="n">assign</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">assign_result</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Pass</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">rewrite_template</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            if hasattr(__fn__, &quot;_multicolor_yield_type&quot;):</span>
<span class="sd">                _multicolor_result = yield _multicolor_custom_yield(type=__fn__._multicolor_yield_type, args=__args__, kwargs=__kwargs__)</span>
<span class="sd">                __assign_result__</span>
<span class="sd">            elif hasattr(__fn__, &quot;_multicolor_no_yields&quot;):</span>
<span class="sd">                _multicolor_result = __fn_call__</span>
<span class="sd">                __assign_result__</span>
<span class="sd">            else:</span>
<span class="sd">                _multicolor_result = None</span>
<span class="sd">                try:</span>
<span class="sd">                    if isinstance(__fn__, type):</span>
<span class="sd">                        raise _multicolor_no_source_error # FIXME: this bypasses compilation for calls that are actually class instantiations</span>
<span class="sd">                    __compiled_fn__, _multicolor_color = _multicolor_compile(__fn__, _multicolor_decorator, _multicolor_cache_key)</span>
<span class="sd">                except _multicolor_no_source_error:</span>
<span class="sd">                    _multicolor_result = __fn_call__</span>
<span class="sd">                else:</span>
<span class="sd">                    _multicolor_generator = __compiled_fn_call__</span>
<span class="sd">                    if _multicolor_color == _multicolor_generator_color:</span>
<span class="sd">                        _multicolor_result = []</span>
<span class="sd">                        for _multicolor_yield in _multicolor_generator:</span>
<span class="sd">                            if isinstance(_multicolor_yield, _multicolor_generator_yield):</span>
<span class="sd">                                _multicolor_result.append(_multicolor_yield.value)</span>
<span class="sd">                            else:</span>
<span class="sd">                                yield _multicolor_yield</span>
<span class="sd">                    else:</span>
<span class="sd">                        _multicolor_result = yield from _multicolor_generator</span>
<span class="sd">                finally:</span>
<span class="sd">                    __assign_result__</span>
<span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
            <span class="n">__fn__</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span>
            <span class="n">__fn_call__</span><span class="o">=</span><span class="n">fn_call</span><span class="p">,</span>
            <span class="n">__args__</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
            <span class="n">__kwargs__</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="n">__compiled_fn__</span><span class="o">=</span><span class="n">compiled_fn</span><span class="p">,</span>
            <span class="n">__compiled_fn_call__</span><span class="o">=</span><span class="n">compiled_fn_call</span><span class="p">,</span>
            <span class="n">__assign_result__</span><span class="o">=</span><span class="n">assign_result</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h5 id="dispatch.experimental.multicolor.compile.FunctionColor" class="doc doc-heading">
          <code>FunctionColor</code>


</h5>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="enum.Enum">Enum</span></code></p>

  
      <p>Color (aka. type/flavor) of a function.</p>
<p>There are four colors of functions in Python:
* regular (e.g. def fn(): pass)
* generator (e.g. def fn(): yield)
* async (e.g. async def fn(): pass)
* async generator (e.g. async def fn(): yield)</p>
<p>Only the first two colors are supported at this time.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/experimental/multicolor/compile.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FunctionColor</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Color (aka. type/flavor) of a function.</span>

<span class="sd">    There are four colors of functions in Python:</span>
<span class="sd">    * regular (e.g. def fn(): pass)</span>
<span class="sd">    * generator (e.g. def fn(): yield)</span>
<span class="sd">    * async (e.g. async def fn(): pass)</span>
<span class="sd">    * async generator (e.g. async def fn(): yield)</span>

<span class="sd">    Only the first two colors are supported at this time.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REGULAR_FUNCTION</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">GENERATOR_FUNCTION</span> <span class="o">=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h5 id="dispatch.experimental.multicolor.compile.GeneratorTransformer" class="doc doc-heading">
          <code>GeneratorTransformer</code>


</h5>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="ast.NodeTransformer">NodeTransformer</span></code></p>

  
      <p>Wrap ast.Yield values in a GeneratorYield container.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/experimental/multicolor/compile.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GeneratorTransformer</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">NodeTransformer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrap ast.Yield values in a GeneratorYield container.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">visit_Yield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Yield</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ast</span><span class="o">.</span><span class="n">Yield</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="n">wrapped_value</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span>
            <span class="n">func</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;_multicolor_generator_yield&quot;</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">()),</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">keywords</span><span class="o">=</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">keyword</span><span class="p">(</span><span class="n">arg</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)],</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">Yield</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">wrapped_value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>



<div class="doc doc-object doc-function">



<h5 id="dispatch.experimental.multicolor.compile.compile_function" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">compile_function</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">decorator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cache_key</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Compile a regular function into a generator that yields data passed
to functions marked with the @multicolor.yields decorator. Decorated yield
functions can be called from anywhere in the call stack, and functions
in between do not have to be generators or async functions (coroutines).</p>
<p>Example:</p>
<pre><code>@multicolor.yields(type="sleep")
def sleep(seconds): ...

def parent():
    sleep(3)  # yield point

def grandparent():
    parent()

compiled_grandparent = multicolor.compile_function(grandparent)
generator = compiled_grandparent()
for item in generator:
    print(item)  # multicolor.CustomYield(type="sleep", args=[3])
</code></pre>
<p>Two-way data flow works as expected. At a yield point, generator.send(value)
can be used to send data back to the yield point and to resume execution.
The data sent back will be the return value of the function decorated with
@multicolor.yields:</p>
<pre><code>@multicolor.yields(type="add")
def add(a: int, b: int) -&gt; int:
    return a + b  # default/synchronous implementation

def scheduler(generator):
    try:
        send = None
        while True:
            item = generator.send(send)
            match item:
                case multicolor.CustomYield(type="add"):
                    a, b = item.args
                    print(f"adding {a} + {b}")
                    send = a + b
    except StopIteration as e:
        return e.value  # return value

def adder(a: int, b: int) -&gt; int:
    return add(a, b)

compiled_adder = multicolor.compile_function(adder)
generator = compiled_adder(1, 2)
result = scheduler(generator)
print(result) # 3
</code></pre>
<p>The @multicolor.yields decorator does not change the implementation of
the function it decorates. If the function is run without being
compiled, the default implementation will be used instead:</p>
<pre><code>print(adder(1, 2))  # 3
</code></pre>
<p>The default implementation could also raise an error, to ensure that
the function is only ever called from a compiled function.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>fn</code></td>
          <td>
                <code><span title="types.FunctionType">FunctionType</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The function to compile.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>decorator</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An optional decorator to apply to the compiled function.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>cache_key</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Cache key to use when caching compiled functions.</p>
            </div>
          </td>
          <td>
                <code>&#39;default&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>FunctionType</code></td>          <td>
                <code><span title="types.FunctionType">FunctionType</span> | <span title="types.MethodType">MethodType</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A compiled generator function.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>dispatch/experimental/multicolor/compile.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compile_function</span><span class="p">(</span>
    <span class="n">fn</span><span class="p">:</span> <span class="n">FunctionType</span><span class="p">,</span> <span class="n">decorator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cache_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FunctionType</span> <span class="o">|</span> <span class="n">MethodType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compile a regular function into a generator that yields data passed</span>
<span class="sd">    to functions marked with the @multicolor.yields decorator. Decorated yield</span>
<span class="sd">    functions can be called from anywhere in the call stack, and functions</span>
<span class="sd">    in between do not have to be generators or async functions (coroutines).</span>

<span class="sd">    Example:</span>

<span class="sd">        @multicolor.yields(type=&quot;sleep&quot;)</span>
<span class="sd">        def sleep(seconds): ...</span>

<span class="sd">        def parent():</span>
<span class="sd">            sleep(3)  # yield point</span>

<span class="sd">        def grandparent():</span>
<span class="sd">            parent()</span>

<span class="sd">        compiled_grandparent = multicolor.compile_function(grandparent)</span>
<span class="sd">        generator = compiled_grandparent()</span>
<span class="sd">        for item in generator:</span>
<span class="sd">            print(item)  # multicolor.CustomYield(type=&quot;sleep&quot;, args=[3])</span>

<span class="sd">    Two-way data flow works as expected. At a yield point, generator.send(value)</span>
<span class="sd">    can be used to send data back to the yield point and to resume execution.</span>
<span class="sd">    The data sent back will be the return value of the function decorated with</span>
<span class="sd">    @multicolor.yields:</span>

<span class="sd">        @multicolor.yields(type=&quot;add&quot;)</span>
<span class="sd">        def add(a: int, b: int) -&gt; int:</span>
<span class="sd">            return a + b  # default/synchronous implementation</span>

<span class="sd">        def scheduler(generator):</span>
<span class="sd">            try:</span>
<span class="sd">                send = None</span>
<span class="sd">                while True:</span>
<span class="sd">                    item = generator.send(send)</span>
<span class="sd">                    match item:</span>
<span class="sd">                        case multicolor.CustomYield(type=&quot;add&quot;):</span>
<span class="sd">                            a, b = item.args</span>
<span class="sd">                            print(f&quot;adding {a} + {b}&quot;)</span>
<span class="sd">                            send = a + b</span>
<span class="sd">            except StopIteration as e:</span>
<span class="sd">                return e.value  # return value</span>

<span class="sd">        def adder(a: int, b: int) -&gt; int:</span>
<span class="sd">            return add(a, b)</span>

<span class="sd">        compiled_adder = multicolor.compile_function(adder)</span>
<span class="sd">        generator = compiled_adder(1, 2)</span>
<span class="sd">        result = scheduler(generator)</span>
<span class="sd">        print(result) # 3</span>

<span class="sd">    The @multicolor.yields decorator does not change the implementation of</span>
<span class="sd">    the function it decorates. If the function is run without being</span>
<span class="sd">    compiled, the default implementation will be used instead:</span>

<span class="sd">        print(adder(1, 2))  # 3</span>

<span class="sd">    The default implementation could also raise an error, to ensure that</span>
<span class="sd">    the function is only ever called from a compiled function.</span>

<span class="sd">    Args:</span>
<span class="sd">        fn: The function to compile.</span>
<span class="sd">        decorator: An optional decorator to apply to the compiled function.</span>
<span class="sd">        cache_key: Cache key to use when caching compiled functions.</span>

<span class="sd">    Returns:</span>
<span class="sd">        FunctionType: A compiled generator function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">compiled_fn</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_compile_internal</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">decorator</span><span class="p">,</span> <span class="n">cache_key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">compiled_fn</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="dispatch.experimental.multicolor.desugar" class="doc doc-heading">
          <code>desugar</code>


</h4>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="dispatch.experimental.multicolor.desugar.Desugar" class="doc doc-heading">
          <code>Desugar</code>


</h5>


  <div class="doc doc-contents ">

  
      <p>The desugar pass simplifies subsequent AST transformations that need
to replace an expression (e.g. a function call) with a statement (e.g. an
if branch) in a function definition.</p>
<p>The pass recursively simplifies control flow and compound expressions
in a function definition such that:
- expressions that are children of statements either have no children, or
  only have children of type ast.Name and/or ast.Constant
- those parent expressions are either part of an ast.Expr(value=expr)
  statement or an ast.Assign(value=expr) statement</p>
<p>The pass does not recurse into lambda expressions, or nested function or
class definitions.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/experimental/multicolor/desugar.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Desugar</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The desugar pass simplifies subsequent AST transformations that need</span>
<span class="sd">    to replace an expression (e.g. a function call) with a statement (e.g. an</span>
<span class="sd">    if branch) in a function definition.</span>

<span class="sd">    The pass recursively simplifies control flow and compound expressions</span>
<span class="sd">    in a function definition such that:</span>
<span class="sd">    - expressions that are children of statements either have no children, or</span>
<span class="sd">      only have children of type ast.Name and/or ast.Constant</span>
<span class="sd">    - those parent expressions are either part of an ast.Expr(value=expr)</span>
<span class="sd">      statement or an ast.Assign(value=expr) statement</span>

<span class="sd">    The pass does not recurse into lambda expressions, or nested function or</span>
<span class="sd">    class definitions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">desugar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stmts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_stmts</span><span class="p">(</span><span class="n">stmts</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_desugar_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stmt</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">]]:</span>
        <span class="n">deps</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">match</span> <span class="n">stmt</span><span class="p">:</span>
            <span class="c1"># Pass</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">Pass</span><span class="p">():</span>
                <span class="k">pass</span>

            <span class="c1"># Break</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">Break</span><span class="p">():</span>
                <span class="k">pass</span>

            <span class="c1"># Continue</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">Continue</span><span class="p">():</span>
                <span class="k">pass</span>

            <span class="c1"># Import(alias* names)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">Import</span><span class="p">():</span>
                <span class="k">pass</span>

            <span class="c1"># ImportFrom(identifier? module, alias* names, int? level)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">ImportFrom</span><span class="p">():</span>
                <span class="k">pass</span>

            <span class="c1"># Nonlocal(identifier* names)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">Nonlocal</span><span class="p">():</span>
                <span class="k">pass</span>

            <span class="c1"># Global(identifier* names)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">Global</span><span class="p">():</span>
                <span class="k">pass</span>

            <span class="c1"># Return(expr? value)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">Return</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">stmt</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">stmt</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

            <span class="c1"># Expr(expr value)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">():</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">expr_stmt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Assert(expr test, expr? msg)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assert</span><span class="p">():</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">test</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">stmt</span><span class="o">.</span><span class="n">msg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">stmt</span><span class="o">.</span><span class="n">msg</span><span class="p">,</span> <span class="n">msg_deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
                    <span class="n">deps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">msg_deps</span><span class="p">)</span>

            <span class="c1"># Assign(expr* targets, expr value, string? type_comment)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">():</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_exprs</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">value_deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="n">deps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">value_deps</span><span class="p">)</span>

            <span class="c1"># AugAssign(expr target, operator op, expr value)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">AugAssign</span><span class="p">():</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                    <span class="n">ast</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="n">stmt</span><span class="o">.</span><span class="n">target</span>
                <span class="p">)</span>  <span class="c1"># ast.Name | ast.Attribute | ast.Subscript</span>
                <span class="n">target</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span> <span class="o">|</span> <span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span> <span class="o">|</span> <span class="n">ast</span><span class="o">.</span><span class="n">Subscript</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">value_deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="n">deps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">value_deps</span><span class="p">)</span>

            <span class="c1"># AnnAssign(expr target, expr annotation, expr? value, int simple)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">AnnAssign</span><span class="p">():</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                    <span class="n">ast</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="n">stmt</span><span class="o">.</span><span class="n">target</span>
                <span class="p">)</span>  <span class="c1"># ast.Name | ast.Attribute | ast.Subscript</span>
                <span class="n">target</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span> <span class="o">|</span> <span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span> <span class="o">|</span> <span class="n">ast</span><span class="o">.</span><span class="n">Subscript</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">annotation</span><span class="p">,</span> <span class="n">annotation_deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">annotation</span><span class="p">)</span>
                <span class="n">deps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">annotation_deps</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">stmt</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">stmt</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">value_deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                    <span class="n">deps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">value_deps</span><span class="p">)</span>

            <span class="c1"># Delete(expr* targets)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">Delete</span><span class="p">():</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_exprs</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="n">del_stmt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Raise(expr? exc, expr? cause)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">Raise</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">stmt</span><span class="o">.</span><span class="n">exc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">stmt</span><span class="o">.</span><span class="n">exc</span><span class="p">,</span> <span class="n">exc_deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">exc</span><span class="p">)</span>
                    <span class="n">deps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">exc_deps</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">stmt</span><span class="o">.</span><span class="n">cause</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">stmt</span><span class="o">.</span><span class="n">cause</span><span class="p">,</span> <span class="n">cause_deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">cause</span><span class="p">)</span>
                    <span class="n">deps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">cause_deps</span><span class="p">)</span>

            <span class="c1"># If(expr test, stmt* body, stmt* orelse)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">If</span><span class="p">():</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">test</span><span class="p">)</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_stmts</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">orelse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_stmts</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">orelse</span><span class="p">)</span>

            <span class="c1"># While(expr test, stmt* body, stmt* orelse)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">While</span><span class="p">():</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">test</span><span class="p">)</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_stmts</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">orelse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_stmts</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">orelse</span><span class="p">)</span>

            <span class="c1"># For(expr target, expr iter, stmt* body, stmt* orelse, string? type_comment)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">For</span><span class="p">():</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">iter</span><span class="p">,</span> <span class="n">iter_deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">iter</span><span class="p">)</span>
                <span class="n">deps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">iter_deps</span><span class="p">)</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_stmts</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">orelse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_stmts</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">orelse</span><span class="p">)</span>

            <span class="c1"># AsyncFor(expr target, expr iter, stmt* body, stmt* orelse, string? type_comment)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">AsyncFor</span><span class="p">():</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">iter</span><span class="p">,</span> <span class="n">iter_deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">iter</span><span class="p">)</span>
                <span class="n">deps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">iter_deps</span><span class="p">)</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_stmts</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">orelse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_stmts</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">orelse</span><span class="p">)</span>

            <span class="c1"># Try(stmt* body, excepthandler* handlers, stmt* orelse, stmt* finalbody)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">Try</span><span class="p">():</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_stmts</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">handlers</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_except_handlers</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">handlers</span><span class="p">)</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">orelse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_stmts</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">orelse</span><span class="p">)</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">finalbody</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_stmts</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">finalbody</span><span class="p">)</span>

            <span class="c1"># TryStar(stmt* body, excepthandler* handlers, stmt* orelse, stmt* finalbody)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">TryStar</span><span class="p">():</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_stmts</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">handlers</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_except_handlers</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">handlers</span><span class="p">)</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">orelse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_stmts</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">orelse</span><span class="p">)</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">finalbody</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_stmts</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">finalbody</span><span class="p">)</span>

            <span class="c1"># Match(expr subject, match_case* cases)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">Match</span><span class="p">():</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">subject</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">subject</span><span class="p">)</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">cases</span><span class="p">,</span> <span class="n">match_case_deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_match_cases</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">cases</span><span class="p">)</span>
                <span class="n">deps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">match_case_deps</span><span class="p">)</span>

            <span class="c1"># With(withitem* items, stmt* body, string? type_comment)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">With</span><span class="p">():</span>
                <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">last</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="n">stmt</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">With</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="p">[</span><span class="n">last</span><span class="p">],</span> <span class="n">body</span><span class="o">=</span><span class="n">stmt</span><span class="o">.</span><span class="n">body</span><span class="p">)]</span>

                <span class="n">stmt</span><span class="o">.</span><span class="n">items</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_withitems</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_stmts</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

            <span class="c1"># AsyncWith(withitem* items, stmt* body, string? type_comment)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">AsyncWith</span><span class="p">():</span>
                <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">last</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="n">stmt</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">AsyncWith</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="p">[</span><span class="n">last</span><span class="p">],</span> <span class="n">body</span><span class="o">=</span><span class="n">stmt</span><span class="o">.</span><span class="n">body</span><span class="p">)]</span>

                <span class="n">stmt</span><span class="o">.</span><span class="n">items</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_withitems</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
                <span class="n">stmt</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_stmts</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

            <span class="c1"># FunctionDef(identifier name, arguments args, stmt* body, expr* decorator_list, expr? returns, string? type_comment)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">():</span>
                <span class="k">pass</span>  <span class="c1"># do not recurse</span>

            <span class="c1"># AsyncFunctionDef(identifier name, arguments args, stmt* body, expr* decorator_list, expr? returns, string? type_comment)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">AsyncFunctionDef</span><span class="p">():</span>
                <span class="k">pass</span>  <span class="c1"># do not recurse</span>

            <span class="c1"># ClassDef(identifier name, expr* bases, keyword* keywords, stmt* body, expr* decorator_list)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">ClassDef</span><span class="p">():</span>
                <span class="k">pass</span>  <span class="c1"># do not recurse</span>

            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;desugar </span><span class="si">{</span><span class="n">stmt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">stmt</span><span class="p">,</span> <span class="n">deps</span>

    <span class="k">def</span> <span class="nf">_desugar_expr</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="n">expr_stmt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">del_stmt</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">]]:</span>
        <span class="c1"># These cases have no nested expressions or statements. Return</span>
        <span class="c1"># early so that no superfluous temporaries are generated.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
            <span class="c1"># Name(identifier id, expr_context ctx)</span>
            <span class="k">return</span> <span class="n">expr</span><span class="p">,</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Constant</span><span class="p">):</span>
            <span class="c1"># Constant(constant value, string? kind)</span>
            <span class="k">return</span> <span class="n">expr</span><span class="p">,</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
            <span class="c1"># Attribute(expr value, identifier attr, expr_context ctx)</span>
            <span class="k">return</span> <span class="n">expr</span><span class="p">,</span> <span class="p">[]</span>

        <span class="n">deps</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">wrapper</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">create_temporary</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">expr_stmt</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">del_stmt</span>
        <span class="n">is_store</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">match</span> <span class="n">expr</span><span class="p">:</span>
            <span class="c1"># Call(expr func, expr* args, keyword* keywords)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">():</span>
                <span class="n">expr</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>
                <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="n">args_deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_exprs</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
                <span class="n">deps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">args_deps</span><span class="p">)</span>
                <span class="n">expr</span><span class="o">.</span><span class="n">keywords</span><span class="p">,</span> <span class="n">keywords_deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_keywords</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">keywords</span><span class="p">)</span>
                <span class="n">deps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">keywords_deps</span><span class="p">)</span>

            <span class="c1"># BinOp(expr left, operator op, expr right)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">():</span>
                <span class="n">expr</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
                <span class="n">expr</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">right_deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">right</span><span class="p">)</span>
                <span class="n">deps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">right_deps</span><span class="p">)</span>

            <span class="c1"># UnaryOp(unaryop op, expr operand)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">UnaryOp</span><span class="p">():</span>
                <span class="n">expr</span><span class="o">.</span><span class="n">operand</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">operand</span><span class="p">)</span>

            <span class="c1"># BoolOp(boolop op, expr* values)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">BoolOp</span><span class="p">():</span>
                <span class="n">expr</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_exprs</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

            <span class="c1"># Tuple(expr* elts, expr_context ctx)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">():</span>
                <span class="n">expr</span><span class="o">.</span><span class="n">elts</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_exprs</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">elts</span><span class="p">)</span>
                <span class="n">is_store</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">ctx</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Store</span><span class="p">)</span>

            <span class="c1"># List(expr* elts, expr_context ctx)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">List</span><span class="p">():</span>
                <span class="n">expr</span><span class="o">.</span><span class="n">elts</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_exprs</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">elts</span><span class="p">)</span>
                <span class="n">is_store</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">ctx</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Store</span><span class="p">)</span>

            <span class="c1"># Set(expr* elts)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">Set</span><span class="p">():</span>
                <span class="n">expr</span><span class="o">.</span><span class="n">elts</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_exprs</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">elts</span><span class="p">)</span>

            <span class="c1"># Dict(expr* keys, expr* values)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">Dict</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">keys</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">key</span><span class="p">,</span> <span class="n">key_deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                        <span class="n">deps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">key_deps</span><span class="p">)</span>
                    <span class="n">expr</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
                <span class="n">expr</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">values_deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_exprs</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                <span class="n">deps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">values_deps</span><span class="p">)</span>

            <span class="c1"># Starred(expr value, expr_context ctx)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">Starred</span><span class="p">():</span>
                <span class="n">expr</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="n">is_store</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">ctx</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Store</span><span class="p">)</span>
                <span class="n">create_temporary</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># Compare(expr left, cmpop* ops, expr* comparators)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">Compare</span><span class="p">():</span>
                <span class="n">expr</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
                <span class="n">expr</span><span class="o">.</span><span class="n">comparators</span><span class="p">,</span> <span class="n">comparators_deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_exprs</span><span class="p">(</span>
                    <span class="n">expr</span><span class="o">.</span><span class="n">comparators</span>
                <span class="p">)</span>
                <span class="n">deps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">comparators_deps</span><span class="p">)</span>

            <span class="c1"># NamedExpr(expr target, expr value)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">NamedExpr</span><span class="p">():</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>  <span class="c1"># ast.Name</span>
                <span class="n">target</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
                <span class="n">expr</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
                <span class="n">expr</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">value_deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="n">deps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">value_deps</span><span class="p">)</span>

                <span class="c1"># We need to preserve the assignment so that the target is accessible</span>
                <span class="c1"># from subsequent expressions/statements. ast.NamedExpr isn&#39;t valid as</span>
                <span class="c1"># a standalone a statement, so we need to convert to ast.Assign.</span>
                <span class="n">deps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">(</span><span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">expr</span><span class="o">.</span><span class="n">target</span><span class="p">],</span> <span class="n">value</span><span class="o">=</span><span class="n">expr</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
                <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">target</span>

            <span class="c1"># Lambda(arguments args, expr body)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">Lambda</span><span class="p">():</span>
                <span class="k">pass</span>  <span class="c1"># do not recurse</span>

            <span class="c1"># Await(expr value)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">Await</span><span class="p">():</span>
                <span class="n">expr</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

            <span class="c1"># Yield(expr? value)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">Yield</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">expr</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

            <span class="c1"># YieldFrom(expr value)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">YieldFrom</span><span class="p">():</span>
                <span class="n">expr</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

            <span class="c1"># JoinedStr(expr* values)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">JoinedStr</span><span class="p">():</span>
                <span class="n">expr</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_exprs</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

            <span class="c1"># FormattedValue(expr value, int conversion, expr? format_spec)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">FormattedValue</span><span class="p">():</span>
                <span class="n">expr</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="c1"># Note: expr.format_spec is an expression, but we do not expect to</span>
                <span class="c1"># find compound expressions there.</span>

                <span class="n">conversion</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">conversion</span>
                <span class="n">format_spec</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">format_spec</span>
                <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">value</span>
                <span class="n">create_temporary</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">FormattedValue</span><span class="p">(</span>
                        <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">conversion</span><span class="o">=</span><span class="n">conversion</span><span class="p">,</span> <span class="n">format_spec</span><span class="o">=</span><span class="n">format_spec</span>
                    <span class="p">)</span>

            <span class="c1"># Attribute(expr value, identifier attr, expr_context ctx)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span><span class="p">():</span>
                <span class="n">expr</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="n">is_store</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">ctx</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Store</span><span class="p">)</span>

            <span class="c1"># Subscript(expr value, expr slice, expr_context ctx)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">Subscript</span><span class="p">():</span>
                <span class="n">expr</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="n">expr</span><span class="o">.</span><span class="n">slice</span><span class="p">,</span> <span class="n">slice_deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">slice</span><span class="p">)</span>
                <span class="n">deps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">slice_deps</span><span class="p">)</span>
                <span class="n">is_store</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">ctx</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Store</span><span class="p">)</span>

            <span class="c1"># Slice(expr? lower, expr? upper, expr? step)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">Slice</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">lower</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">expr</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span> <span class="n">lower_deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">lower</span><span class="p">)</span>
                    <span class="n">deps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">lower_deps</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">upper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">expr</span><span class="o">.</span><span class="n">upper</span><span class="p">,</span> <span class="n">upper_deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">upper</span><span class="p">)</span>
                    <span class="n">deps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">upper_deps</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">expr</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="n">step_deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
                    <span class="n">deps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">step_deps</span><span class="p">)</span>
                <span class="n">is_store</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># IfExp(expr test, expr body, expr orelse)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">IfExp</span><span class="p">():</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_name</span><span class="p">()</span>
                <span class="n">if_stmt</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_stmt</span><span class="p">(</span>
                    <span class="n">ast</span><span class="o">.</span><span class="n">If</span><span class="p">(</span>
                        <span class="n">test</span><span class="o">=</span><span class="n">expr</span><span class="o">.</span><span class="n">test</span><span class="p">,</span>
                        <span class="n">body</span><span class="o">=</span><span class="p">[</span>
                            <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">(</span>
                                <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">tmp</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Store</span><span class="p">())],</span>
                                <span class="n">value</span><span class="o">=</span><span class="n">expr</span><span class="o">.</span><span class="n">body</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">],</span>
                        <span class="n">orelse</span><span class="o">=</span><span class="p">[</span>
                            <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">(</span>
                                <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">tmp</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Store</span><span class="p">())],</span>
                                <span class="n">value</span><span class="o">=</span><span class="n">expr</span><span class="o">.</span><span class="n">orelse</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">],</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">deps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">if_stmt</span><span class="p">)</span>
                <span class="n">expr</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">tmp</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">())</span>
                <span class="n">create_temporary</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># ListComp(expr elt, comprehension* generators)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">ListComp</span><span class="p">():</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_name</span><span class="p">()</span>

                <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">(</span>
                        <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">tmp</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Store</span><span class="p">())],</span>
                        <span class="n">value</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">elts</span><span class="o">=</span><span class="p">[],</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">()),</span>
                    <span class="p">)</span>
                <span class="p">]</span>

                <span class="n">inner_statement</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">stmt</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">(</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span>
                        <span class="n">func</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span><span class="p">(</span>
                            <span class="n">value</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">tmp</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">()),</span>
                            <span class="n">attr</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span>
                            <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span>
                        <span class="p">),</span>
                        <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">expr</span><span class="o">.</span><span class="n">elt</span><span class="p">],</span>
                        <span class="n">keywords</span><span class="o">=</span><span class="p">[],</span>
                    <span class="p">)</span>
                <span class="p">)</span>

                <span class="n">deps</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_comprehensions</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">generators</span><span class="p">,</span> <span class="n">inner_statement</span><span class="p">)</span>
                <span class="n">expr</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">tmp</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">())</span>
                <span class="n">create_temporary</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># SetComp(expr elt, comprehension* generators)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">SetComp</span><span class="p">():</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_name</span><span class="p">()</span>

                <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">(</span>
                        <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">tmp</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Store</span><span class="p">())],</span>
                        <span class="n">value</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span>
                            <span class="n">func</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;set&quot;</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">()),</span>
                            <span class="n">args</span><span class="o">=</span><span class="p">[],</span>
                            <span class="n">keywords</span><span class="o">=</span><span class="p">[],</span>
                        <span class="p">),</span>
                    <span class="p">)</span>
                <span class="p">]</span>

                <span class="n">inner_statement</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">(</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span>
                        <span class="n">func</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span><span class="p">(</span>
                            <span class="n">value</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">tmp</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">()),</span>
                            <span class="n">attr</span><span class="o">=</span><span class="s2">&quot;add&quot;</span><span class="p">,</span>
                            <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span>
                        <span class="p">),</span>
                        <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">expr</span><span class="o">.</span><span class="n">elt</span><span class="p">],</span>
                        <span class="n">keywords</span><span class="o">=</span><span class="p">[],</span>
                    <span class="p">)</span>
                <span class="p">)</span>

                <span class="n">deps</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_comprehensions</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">generators</span><span class="p">,</span> <span class="n">inner_statement</span><span class="p">)</span>
                <span class="n">expr</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">tmp</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">())</span>
                <span class="n">create_temporary</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># DictComp(expr key, expr value, comprehension* generators)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">DictComp</span><span class="p">():</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_name</span><span class="p">()</span>

                <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">(</span>
                        <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">tmp</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Store</span><span class="p">())],</span>
                        <span class="n">value</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="p">[],</span> <span class="n">values</span><span class="o">=</span><span class="p">[]),</span>
                    <span class="p">)</span>
                <span class="p">]</span>

                <span class="n">inner_statement</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">(</span>
                    <span class="n">targets</span><span class="o">=</span><span class="p">[</span>
                        <span class="n">ast</span><span class="o">.</span><span class="n">Subscript</span><span class="p">(</span>
                            <span class="n">value</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">tmp</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Store</span><span class="p">()),</span>
                            <span class="nb">slice</span><span class="o">=</span><span class="n">expr</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
                            <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Store</span><span class="p">(),</span>
                        <span class="p">)</span>
                    <span class="p">],</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">expr</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">deps</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_comprehensions</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">generators</span><span class="p">,</span> <span class="n">inner_statement</span><span class="p">)</span>
                <span class="n">expr</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">tmp</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">())</span>
                <span class="n">create_temporary</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># GeneratorExp(expr elt, comprehension* generators)</span>
            <span class="k">case</span> <span class="n">ast</span><span class="o">.</span><span class="n">GeneratorExp</span><span class="p">():</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_name</span><span class="p">()</span>
                <span class="n">inner_statement</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Yield</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">expr</span><span class="o">.</span><span class="n">elt</span><span class="p">))</span>
                <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_comprehensions</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">generators</span><span class="p">,</span> <span class="n">inner_statement</span><span class="p">)</span>
                <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">tmp</span><span class="p">,</span>
                        <span class="n">args</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span>
                            <span class="n">args</span><span class="o">=</span><span class="p">[],</span>
                            <span class="n">posonlyargs</span><span class="o">=</span><span class="p">[],</span>
                            <span class="n">kwonlyargs</span><span class="o">=</span><span class="p">[],</span>
                            <span class="n">kw_defaults</span><span class="o">=</span><span class="p">[],</span>
                            <span class="n">defaults</span><span class="o">=</span><span class="p">[],</span>
                        <span class="p">),</span>
                        <span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
                        <span class="n">decorator_list</span><span class="o">=</span><span class="p">[],</span>
                    <span class="p">)</span>
                <span class="p">]</span>
                <span class="n">expr</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span>
                    <span class="n">func</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">tmp</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">()),</span> <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">keywords</span><span class="o">=</span><span class="p">[]</span>
                <span class="p">)</span>

            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;desugar </span><span class="si">{</span><span class="n">expr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">create_temporary</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_store</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_name</span><span class="p">()</span>
            <span class="n">deps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">(</span><span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">tmp</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Store</span><span class="p">())],</span> <span class="n">value</span><span class="o">=</span><span class="n">expr</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">tmp</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">wrapper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">wrapper</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">expr</span><span class="p">,</span> <span class="n">deps</span>

    <span class="k">def</span> <span class="nf">_desugar_stmts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stmts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">]:</span>
        <span class="n">desugared</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">stmts</span><span class="p">:</span>
            <span class="n">stmt</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_stmt</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
            <span class="n">desugared</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">deps</span><span class="p">)</span>
            <span class="n">desugared</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">desugared</span>

    <span class="k">def</span> <span class="nf">_desugar_exprs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">exprs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">expr</span><span class="p">],</span> <span class="n">del_stmt</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">expr</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">]]:</span>
        <span class="n">desugared</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">deps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">exprs</span><span class="p">:</span>
            <span class="n">expr</span><span class="p">,</span> <span class="n">expr_deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">del_stmt</span><span class="o">=</span><span class="n">del_stmt</span><span class="p">)</span>
            <span class="n">deps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">expr_deps</span><span class="p">)</span>
            <span class="n">desugared</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">desugared</span><span class="p">,</span> <span class="n">deps</span>

    <span class="k">def</span> <span class="nf">_desugar_keywords</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">keywords</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">keyword</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">keyword</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">]]:</span>
        <span class="c1"># keyword(identifier? arg, expr value)</span>
        <span class="n">desugared</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">deps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
            <span class="n">keyword</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">keyword_deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span><span class="n">keyword</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">deps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">keyword_deps</span><span class="p">)</span>
            <span class="n">desugared</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">desugared</span><span class="p">,</span> <span class="n">deps</span>

    <span class="k">def</span> <span class="nf">_desugar_except_handlers</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">handlers</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">ExceptHandler</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">ExceptHandler</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">]]:</span>
        <span class="c1"># excepthandler = ExceptHandler(expr? type, identifier? name, stmt* body)</span>
        <span class="n">desugared</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">deps</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">handlers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">handler</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># FIXME: exception type exprs need special handling. Each handler&#39;s</span>
                <span class="c1">#  type expr is evaluated one at a time until there&#39;s a match. The</span>
                <span class="c1">#  remaining handler&#39;s type exprs are not evaluated.</span>
                <span class="c1"># handler.type, type_deps = self._desugar_expr(handler.type)</span>
                <span class="c1"># deps.extend(type_deps)</span>
                <span class="k">pass</span>
            <span class="n">handler</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_stmts</span><span class="p">(</span><span class="n">handler</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
            <span class="n">desugared</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">desugared</span><span class="p">,</span> <span class="n">deps</span>

    <span class="k">def</span> <span class="nf">_desugar_match_cases</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">cases</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">match_case</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">match_case</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">]]:</span>
        <span class="c1"># match_case(pattern pattern, expr? guard, stmt* body)</span>
        <span class="n">desugared</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">match_case</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">deps</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="n">cases</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">case</span><span class="o">.</span><span class="n">guard</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># FIXME: match guards need special handling; they shouldn&#39;t be evaluated</span>
                <span class="c1">#  unless the pattern matches.</span>
                <span class="c1"># case.guard, guard_deps = self._desugar_expr(case.guard)</span>
                <span class="c1"># deps.extend(guard_deps)</span>
                <span class="k">pass</span>
            <span class="k">case</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_stmts</span><span class="p">(</span><span class="n">case</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
            <span class="n">desugared</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">case</span><span class="p">)</span>
            <span class="c1"># You&#39;re supposed to be able to pass the AST root to this function</span>
            <span class="c1"># to have it repair (fill in missing) line numbers and such. It</span>
            <span class="c1"># seems there&#39;s a bug where it doesn&#39;t recurse into match cases.</span>
            <span class="c1"># Work around the issue by manually fixing the match case here.</span>
            <span class="n">ast</span><span class="o">.</span><span class="n">fix_missing_locations</span><span class="p">(</span><span class="n">case</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">desugared</span><span class="p">,</span> <span class="n">deps</span>

    <span class="k">def</span> <span class="nf">_desugar_withitems</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">withitems</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">withitem</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">withitem</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">]]:</span>
        <span class="c1"># withitem(expr context_expr, expr? optional_vars)</span>
        <span class="n">desugared</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">deps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">withitem</span> <span class="ow">in</span> <span class="n">withitems</span><span class="p">:</span>
            <span class="n">withitem</span><span class="o">.</span><span class="n">context_expr</span><span class="p">,</span> <span class="n">context_expr_deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span>
                <span class="n">withitem</span><span class="o">.</span><span class="n">context_expr</span>
            <span class="p">)</span>
            <span class="n">deps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">context_expr_deps</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">withitem</span><span class="o">.</span><span class="n">optional_vars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">withitem</span><span class="o">.</span><span class="n">optional_vars</span><span class="p">,</span> <span class="n">optional_vars_deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_expr</span><span class="p">(</span>
                    <span class="n">withitem</span><span class="o">.</span><span class="n">optional_vars</span>
                <span class="p">)</span>
                <span class="n">deps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">optional_vars_deps</span><span class="p">)</span>
            <span class="n">desugared</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">withitem</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">desugared</span><span class="p">,</span> <span class="n">deps</span>

    <span class="k">def</span> <span class="nf">_desugar_comprehensions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">comprehensions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">comprehension</span><span class="p">],</span> <span class="n">inner_statement</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">stmt</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">]:</span>
        <span class="c1"># comprehension(expr target, expr iter, expr* ifs, int is_async)</span>
        <span class="n">stmt</span> <span class="o">=</span> <span class="n">inner_statement</span>
        <span class="k">while</span> <span class="n">comprehensions</span><span class="p">:</span>
            <span class="n">last_for</span> <span class="o">=</span> <span class="n">comprehensions</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">while</span> <span class="n">last_for</span><span class="o">.</span><span class="n">ifs</span><span class="p">:</span>
                <span class="n">test</span> <span class="o">=</span> <span class="n">last_for</span><span class="o">.</span><span class="n">ifs</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">stmt</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">If</span><span class="p">(</span><span class="n">test</span><span class="o">=</span><span class="n">test</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="p">[</span><span class="n">stmt</span><span class="p">],</span> <span class="n">orelse</span><span class="o">=</span><span class="p">[])</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">AsyncFor</span> <span class="k">if</span> <span class="n">last_for</span><span class="o">.</span><span class="n">is_async</span> <span class="k">else</span> <span class="n">ast</span><span class="o">.</span><span class="n">For</span>
            <span class="n">stmt</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
                <span class="n">target</span><span class="o">=</span><span class="n">last_for</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="n">last_for</span><span class="o">.</span><span class="n">iter</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="p">[</span><span class="n">stmt</span><span class="p">],</span> <span class="n">orelse</span><span class="o">=</span><span class="p">[]</span>
            <span class="p">)</span>

        <span class="n">stmt</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desugar_stmt</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">deps</span> <span class="o">+</span> <span class="p">[</span><span class="n">stmt</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_new_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;_v</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name_count</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">name</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>



<div class="doc doc-object doc-function">



<h5 id="dispatch.experimental.multicolor.desugar.desugar_function" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">desugar_function</span><span class="p">(</span><span class="n">fn_def</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Desugar a function to simplify subsequent AST transformations.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>fn_def</code></td>
          <td>
                <code><span title="ast.FunctionDef">FunctionDef</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A function definition.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>FunctionDef</code></td>          <td>
                <code><span title="ast.FunctionDef">FunctionDef</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The desugared function definition.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>dispatch/experimental/multicolor/desugar.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">desugar_function</span><span class="p">(</span><span class="n">fn_def</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Desugar a function to simplify subsequent AST transformations.</span>

<span class="sd">    Args:</span>
<span class="sd">        fn_def: A function definition.</span>

<span class="sd">    Returns:</span>
<span class="sd">        FunctionDef: The desugared function definition.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fn_def</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">Desugar</span><span class="p">()</span><span class="o">.</span><span class="n">desugar</span><span class="p">(</span><span class="n">fn_def</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
    <span class="n">ast</span><span class="o">.</span><span class="n">fix_missing_locations</span><span class="p">(</span><span class="n">fn_def</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fn_def</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="dispatch.experimental.multicolor.generator" class="doc doc-heading">
          <code>generator</code>


</h4>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="dispatch.experimental.multicolor.generator.YieldCounter" class="doc doc-heading">
          <code>YieldCounter</code>


</h5>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="ast.NodeVisitor">NodeVisitor</span></code></p>

  
      <p>AST visitor that walks an ast.FunctionDef to count yield and yield from
statements.</p>
<p>The resulting count can be used to determine if the input function is
a generator or not.</p>
<p>Yields from nested function/class definitions are not counted.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/experimental/multicolor/generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">YieldCounter</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">NodeVisitor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;AST visitor that walks an ast.FunctionDef to count yield and yield from</span>
<span class="sd">    statements.</span>

<span class="sd">    The resulting count can be used to determine if the input function is</span>
<span class="sd">    a generator or not.</span>

<span class="sd">    Yields from nested function/class definitions are not counted.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">visit_Yield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Yield</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">visit_YieldFrom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">YieldFrom</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">visit_FunctionDef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_visit_nested</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">visit_AsyncFunctionDef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">AsyncFunctionDef</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_visit_nested</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">visit_ClassDef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">ClassDef</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_visit_nested</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_visit_nested</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>  <span class="c1"># do not recurse</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">-=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>



<div class="doc doc-object doc-function">



<h5 id="dispatch.experimental.multicolor.generator.empty_generator" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">empty_generator</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>A generator that yields nothing.</p>
<p>A <code>yield from</code> this generator can be inserted into a function definition in
order to turn the function into a generator, without causing any visible
side effects.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/experimental/multicolor/generator.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">empty_generator</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A generator that yields nothing.</span>

<span class="sd">    A `yield from` this generator can be inserted into a function definition in</span>
<span class="sd">    order to turn the function into a generator, without causing any visible</span>
<span class="sd">    side effects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">yield</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h5 id="dispatch.experimental.multicolor.generator.is_generator" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">is_generator</span><span class="p">(</span><span class="n">fn_def</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Returns a boolean indicating whether a function is a
generator function.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>fn_def</code></td>
          <td>
                <code><span title="ast.FunctionDef">FunctionDef</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A function definition.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>dispatch/experimental/multicolor/generator.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_generator</span><span class="p">(</span><span class="n">fn_def</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a boolean indicating whether a function is a</span>
<span class="sd">    generator function.</span>

<span class="sd">    Args:</span>
<span class="sd">        fn_def: A function definition.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">yield_counter</span> <span class="o">=</span> <span class="n">YieldCounter</span><span class="p">()</span>
    <span class="n">yield_counter</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">fn_def</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">yield_counter</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="dispatch.experimental.multicolor.parse" class="doc doc-heading">
          <code>parse</code>


</h4>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="dispatch.experimental.multicolor.parse.NoSourceError" class="doc doc-heading">
          <code>NoSourceError</code>


</h5>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code>RuntimeError</code></p>

  
      <p>Function source code is not available.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/experimental/multicolor/parse.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NoSourceError</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function source code is not available.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>

  </div>


</div>



<div class="doc doc-object doc-function">



<h5 id="dispatch.experimental.multicolor.parse.parse_function" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">parse_function</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Parse an AST from a function. The function source must be available.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>fn</code></td>
          <td>
                <code><span title="types.FunctionType">FunctionType</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The function to parse.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-internal" title="dispatch.experimental.multicolor.parse.NoSourceError" href="#dispatch.experimental.multicolor.parse.NoSourceError">NoSourceError</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If the function source cannot be retrieved.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>dispatch/experimental/multicolor/parse.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parse_function</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="n">FunctionType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse an AST from a function. The function source must be available.</span>

<span class="sd">    Args:</span>
<span class="sd">        fn: The function to parse.</span>

<span class="sd">    Raises:</span>
<span class="sd">        NoSourceError: If the function source cannot be retrieved.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># The source is not always available. For example, the function</span>
        <span class="c1"># may be defined in a C extension, or may be a builtin function.</span>
        <span class="k">raise</span> <span class="n">NoSourceError</span> <span class="kn">from</span> <span class="nn">e</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoSourceError</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IndentationError</span><span class="p">:</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">src</span><span class="p">))</span>

    <span class="n">fn_def</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">,</span> <span class="n">module</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">module</span><span class="p">,</span> <span class="n">fn_def</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="dispatch.experimental.multicolor.template" class="doc doc-heading">
          <code>template</code>


</h4>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="dispatch.experimental.multicolor.template.NameTransformer" class="doc doc-heading">
          <code>NameTransformer</code>


</h5>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="ast.NodeTransformer">NodeTransformer</span></code></p>

  
      <p>Replace ast.Name nodes in an AST.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/experimental/multicolor/template.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NameTransformer</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">NodeTransformer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Replace ast.Name nodes in an AST.&quot;&quot;&quot;</span>

    <span class="n">exprs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">expr</span><span class="p">]</span>
    <span class="n">stmts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">replacements</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">expr</span> <span class="o">|</span> <span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exprs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stmts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">replacements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">expr</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">exprs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stmts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>

    <span class="k">def</span> <span class="nf">visit_Name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ast</span><span class="o">.</span><span class="n">expr</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprs</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">node</span>

    <span class="k">def</span> <span class="nf">visit_Expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">node</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stmts</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">node</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>



<div class="doc doc-object doc-function">



<h5 id="dispatch.experimental.multicolor.template.rewrite_template" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">rewrite_template</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="o">**</span><span class="n">replacements</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Create an AST by parsing a template string and then replacing
embedded identifiers with the provided AST nodes.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>template</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>String containing source code (one or more statements).</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>**replacements</code></td>
          <td>
                <code><span title="ast.expr">expr</span> | <span title="ast.stmt">stmt</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dictionary mapping identifiers to replacement nodes.</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list[<span title="ast.stmt">stmt</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list[ast.stmt]: List of AST statements.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>dispatch/experimental/multicolor/template.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rewrite_template</span><span class="p">(</span>
    <span class="n">template</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">replacements</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">expr</span> <span class="o">|</span> <span class="n">ast</span><span class="o">.</span><span class="n">stmt</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create an AST by parsing a template string and then replacing</span>
<span class="sd">    embedded identifiers with the provided AST nodes.</span>

<span class="sd">    Args:</span>
<span class="sd">        template: String containing source code (one or more statements).</span>
<span class="sd">        **replacements: Dictionary mapping identifiers to replacement nodes.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[ast.stmt]: List of AST statements.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">template</span><span class="p">))</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">NameTransformer</span><span class="p">(</span><span class="o">**</span><span class="n">replacements</span><span class="p">)</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">root</span><span class="o">.</span><span class="n">body</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="dispatch.experimental.multicolor.yields" class="doc doc-heading">
          <code>yields</code>


</h4>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="dispatch.experimental.multicolor.yields.CustomYield" class="doc doc-heading">
          <code>CustomYield</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="dispatch.experimental.multicolor.yields.YieldType" href="#dispatch.experimental.multicolor.yields.YieldType">YieldType</a></code></p>

  
      <p>A yield from a function marked with @yields.</p>



  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code><span title="dispatch.experimental.multicolor.yields.CustomYield.type">type</span></code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The type of yield that was specified in the @yields decorator.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="dispatch.experimental.multicolor.yields.CustomYield.args">args</span></code></td>
          <td>
                <code>list[<span title="typing.Any">Any</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Positional arguments to the function call.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="dispatch.experimental.multicolor.yields.CustomYield.kwargs">kwargs</span></code></td>
          <td>
                <code>dict[str, <span title="typing.Any">Any</span>] | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Keyword arguments to the function call.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>dispatch/experimental/multicolor/yields.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">CustomYield</span><span class="p">(</span><span class="n">YieldType</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A yield from a function marked with @yields.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        type: The type of yield that was specified in the @yields decorator.</span>
<span class="sd">        args: Positional arguments to the function call.</span>
<span class="sd">        kwargs: Keyword arguments to the function call.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">type</span><span class="p">:</span> <span class="n">Any</span>
    <span class="n">args</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
    <span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">kwarg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h5 id="dispatch.experimental.multicolor.yields.GeneratorYield" class="doc doc-heading">
          <code>GeneratorYield</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="dispatch.experimental.multicolor.yields.YieldType" href="#dispatch.experimental.multicolor.yields.YieldType">YieldType</a></code></p>

  
      <p>A yield from a generator.</p>



  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code><span title="dispatch.experimental.multicolor.yields.GeneratorYield.value">value</span></code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The value that was yielded from the generator.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>dispatch/experimental/multicolor/yields.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">GeneratorYield</span><span class="p">(</span><span class="n">YieldType</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A yield from a generator.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        value: The value that was yielded from the generator.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">value</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h5 id="dispatch.experimental.multicolor.yields.YieldType" class="doc doc-heading">
          <code>YieldType</code>


</h5>


  <div class="doc doc-contents ">

  
      <p>Base class for yield types.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/experimental/multicolor/yields.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">YieldType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for yield types.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>

  </div>


</div>



<div class="doc doc-object doc-function">



<h5 id="dispatch.experimental.multicolor.yields.no_yields" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">no_yields</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Decorator that hints that a function (and anything called
recursively) does not yield.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/experimental/multicolor/yields.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">no_yields</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorator that hints that a function (and anything called</span>
<span class="sd">    recursively) does not yield.&quot;&quot;&quot;</span>
    <span class="n">fn</span><span class="o">.</span><span class="n">_multicolor_no_yields</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># type: ignore[attr-defined]</span>
    <span class="k">return</span> <span class="n">fn</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h5 id="dispatch.experimental.multicolor.yields.yields" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">yields</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Returns a decorator that marks functions as a type of yield.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>type</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Opaque type for this yield.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>dispatch/experimental/multicolor/yields.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">yields</span><span class="p">(</span><span class="nb">type</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a decorator that marks functions as a type of yield.</span>

<span class="sd">    Args:</span>
<span class="sd">        type: Opaque type for this yield.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="n">FunctionType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FunctionType</span><span class="p">:</span>
        <span class="n">fn</span><span class="o">.</span><span class="n">_multicolor_yield_type</span> <span class="o">=</span> <span class="nb">type</span>  <span class="c1"># type: ignore[attr-defined]</span>
        <span class="k">return</span> <span class="n">fn</span>

    <span class="k">return</span> <span class="n">decorator</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>


  </div>

  </div>

</div>


  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="dispatch.fastapi" class="doc doc-heading">
          <code>fastapi</code>


</h2>

  <div class="doc doc-contents ">
  
      <p>Integration of Dispatch programmable endpoints for FastAPI.</p>
<p>Example:</p>
<pre><code>import fastapi
from dispatch.fastapi import Dispatch

app = fastapi.FastAPI()
dispatch = Dispatch(app, api_key="test-key")

@dispatch.function()
def my_function():
    return "Hello World!"

@app.get("/")
def read_root():
    dispatch.call(my_function)
</code></pre>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="dispatch.fastapi.Dispatch" class="doc doc-heading">
          <code>Dispatch</code>


</h3>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="dispatch.function.Registry" href="#dispatch.function.Registry">Registry</a></code></p>

  
      <p>A Dispatch programmable endpoint, powered by FastAPI.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/fastapi.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Dispatch</span><span class="p">(</span><span class="n">Registry</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A Dispatch programmable endpoint, powered by FastAPI.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">app</span><span class="p">:</span> <span class="n">fastapi</span><span class="o">.</span><span class="n">FastAPI</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">verification_key</span><span class="p">:</span> <span class="n">Ed25519PublicKey</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">api_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a Dispatch endpoint, and integrate it into a FastAPI app.</span>

<span class="sd">        It mounts a sub-app that implements the Dispatch gRPC interface.</span>

<span class="sd">        Args:</span>
<span class="sd">            app: The FastAPI app to configure.</span>

<span class="sd">            endpoint: Full URL of the application the Dispatch programmable</span>
<span class="sd">              endpoint will be running on. Uses the value of the</span>
<span class="sd">              DISPATCH_ENDPOINT_URL environment variable by default.</span>

<span class="sd">            verification_key: Key to use when verifying signed requests. Uses</span>
<span class="sd">              the value of the DISPATCH_VERIFICATION_KEY environment variable</span>
<span class="sd">              by default. The environment variable is expected to carry an</span>
<span class="sd">              Ed25519 public key in base64 or PEM format.</span>
<span class="sd">              If not set, request signature verification is disabled (a warning</span>
<span class="sd">              will be logged by the constructor).</span>

<span class="sd">            api_key: Dispatch API key to use for authentication. Uses the value of</span>
<span class="sd">              the DISPATCH_API_KEY environment variable by default.</span>

<span class="sd">            api_url: The URL of the Dispatch API to use. Uses the value of the</span>
<span class="sd">              DISPATCH_API_URL environment variable if set, otherwise</span>
<span class="sd">              defaults to the public Dispatch API (DEFAULT_API_URL).</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If any of the required arguments are missing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">app</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;missing FastAPI app as first argument of the Dispatch constructor&quot;</span>
            <span class="p">)</span>

        <span class="n">endpoint_from</span> <span class="o">=</span> <span class="s2">&quot;endpoint argument&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">endpoint</span><span class="p">:</span>
            <span class="n">endpoint</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DISPATCH_ENDPOINT_URL&quot;</span><span class="p">)</span>
            <span class="n">endpoint_from</span> <span class="o">=</span> <span class="s2">&quot;DISPATCH_ENDPOINT_URL&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">endpoint</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;missing application endpoint: set it with the DISPATCH_ENDPOINT_URL environment variable&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">verification_key</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">verification_key_raw</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;DISPATCH_VERIFICATION_KEY&quot;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Be forgiving when accepting keys in PEM format.</span>
                <span class="n">verification_key_raw</span> <span class="o">=</span> <span class="n">verification_key_raw</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">n&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">verification_key</span> <span class="o">=</span> <span class="n">public_key_from_pem</span><span class="p">(</span><span class="n">verification_key_raw</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">verification_key</span> <span class="o">=</span> <span class="n">public_key_from_bytes</span><span class="p">(</span>
                        <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">verification_key_raw</span><span class="p">)</span>
                    <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;configuring Dispatch endpoint </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">)</span>

        <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">_urlparse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">endpoint_from</span><span class="si">}</span><span class="s2"> must be a full URL with protocol and domain (e.g., https://example.com)&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">verification_key</span><span class="p">:</span>
            <span class="n">base64_key</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">verification_key</span><span class="o">.</span><span class="n">public_bytes_raw</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;verifying request signatures using key </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">base64_key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;request verification is disabled because DISPATCH_VERIFICATION_KEY is not set&quot;</span>
            <span class="p">)</span>

        <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">api_url</span><span class="o">=</span><span class="n">api_url</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">client</span><span class="p">)</span>

        <span class="n">function_service</span> <span class="o">=</span> <span class="n">_new_app</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verification_key</span><span class="p">)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s2">&quot;/dispatch.sdk.v1.FunctionService&quot;</span><span class="p">,</span> <span class="n">function_service</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h4 id="dispatch.fastapi.Dispatch.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verification_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">api_url</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Initialize a Dispatch endpoint, and integrate it into a FastAPI app.</p>
<p>It mounts a sub-app that implements the Dispatch gRPC interface.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>app</code></td>
          <td>
                <code><span title="fastapi.FastAPI">FastAPI</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The FastAPI app to configure.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>endpoint</code></td>
          <td>
                <code>str | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Full URL of the application the Dispatch programmable
endpoint will be running on. Uses the value of the
DISPATCH_ENDPOINT_URL environment variable by default.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>verification_key</code></td>
          <td>
                <code><span title="dispatch.signature.Ed25519PublicKey">Ed25519PublicKey</span> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Key to use when verifying signed requests. Uses
the value of the DISPATCH_VERIFICATION_KEY environment variable
by default. The environment variable is expected to carry an
Ed25519 public key in base64 or PEM format.
If not set, request signature verification is disabled (a warning
will be logged by the constructor).</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>api_key</code></td>
          <td>
                <code>str | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dispatch API key to use for authentication. Uses the value of
the DISPATCH_API_KEY environment variable by default.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>api_url</code></td>
          <td>
                <code>str | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The URL of the Dispatch API to use. Uses the value of the
DISPATCH_API_URL environment variable if set, otherwise
defaults to the public Dispatch API (DEFAULT_API_URL).</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>ValueError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If any of the required arguments are missing.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>dispatch/fastapi.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">fastapi</span><span class="o">.</span><span class="n">FastAPI</span><span class="p">,</span>
    <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">verification_key</span><span class="p">:</span> <span class="n">Ed25519PublicKey</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">api_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize a Dispatch endpoint, and integrate it into a FastAPI app.</span>

<span class="sd">    It mounts a sub-app that implements the Dispatch gRPC interface.</span>

<span class="sd">    Args:</span>
<span class="sd">        app: The FastAPI app to configure.</span>

<span class="sd">        endpoint: Full URL of the application the Dispatch programmable</span>
<span class="sd">          endpoint will be running on. Uses the value of the</span>
<span class="sd">          DISPATCH_ENDPOINT_URL environment variable by default.</span>

<span class="sd">        verification_key: Key to use when verifying signed requests. Uses</span>
<span class="sd">          the value of the DISPATCH_VERIFICATION_KEY environment variable</span>
<span class="sd">          by default. The environment variable is expected to carry an</span>
<span class="sd">          Ed25519 public key in base64 or PEM format.</span>
<span class="sd">          If not set, request signature verification is disabled (a warning</span>
<span class="sd">          will be logged by the constructor).</span>

<span class="sd">        api_key: Dispatch API key to use for authentication. Uses the value of</span>
<span class="sd">          the DISPATCH_API_KEY environment variable by default.</span>

<span class="sd">        api_url: The URL of the Dispatch API to use. Uses the value of the</span>
<span class="sd">          DISPATCH_API_URL environment variable if set, otherwise</span>
<span class="sd">          defaults to the public Dispatch API (DEFAULT_API_URL).</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If any of the required arguments are missing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">app</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;missing FastAPI app as first argument of the Dispatch constructor&quot;</span>
        <span class="p">)</span>

    <span class="n">endpoint_from</span> <span class="o">=</span> <span class="s2">&quot;endpoint argument&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">endpoint</span><span class="p">:</span>
        <span class="n">endpoint</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DISPATCH_ENDPOINT_URL&quot;</span><span class="p">)</span>
        <span class="n">endpoint_from</span> <span class="o">=</span> <span class="s2">&quot;DISPATCH_ENDPOINT_URL&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">endpoint</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;missing application endpoint: set it with the DISPATCH_ENDPOINT_URL environment variable&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">verification_key</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">verification_key_raw</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;DISPATCH_VERIFICATION_KEY&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Be forgiving when accepting keys in PEM format.</span>
            <span class="n">verification_key_raw</span> <span class="o">=</span> <span class="n">verification_key_raw</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">n&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">verification_key</span> <span class="o">=</span> <span class="n">public_key_from_pem</span><span class="p">(</span><span class="n">verification_key_raw</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">verification_key</span> <span class="o">=</span> <span class="n">public_key_from_bytes</span><span class="p">(</span>
                    <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">verification_key_raw</span><span class="p">)</span>
                <span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;configuring Dispatch endpoint </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">)</span>

    <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">_urlparse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">endpoint_from</span><span class="si">}</span><span class="s2"> must be a full URL with protocol and domain (e.g., https://example.com)&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">verification_key</span><span class="p">:</span>
        <span class="n">base64_key</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">verification_key</span><span class="o">.</span><span class="n">public_bytes_raw</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;verifying request signatures using key </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">base64_key</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;request verification is disabled because DISPATCH_VERIFICATION_KEY is not set&quot;</span>
        <span class="p">)</span>

    <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">api_url</span><span class="o">=</span><span class="n">api_url</span><span class="p">)</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">client</span><span class="p">)</span>

    <span class="n">function_service</span> <span class="o">=</span> <span class="n">_new_app</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verification_key</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s2">&quot;/dispatch.sdk.v1.FunctionService&quot;</span><span class="p">,</span> <span class="n">function_service</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="dispatch.function" class="doc doc-heading">
          <code>function</code>


</h2>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="dispatch.function.PrimitiveFunctionType" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">PrimitiveFunctionType</span><span class="p">:</span> <span class="n">TypeAlias</span> <span class="o">=</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Input</span><span class="p">],</span> <span class="n">Output</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>A primitive function is a function that accepts a dispatch.function.Input
and unconditionally returns a dispatch.function.Output. It must not raise
exceptions.</p>
  </div>

</div>


<div class="doc doc-object doc-class">



<h3 id="dispatch.function.Function" class="doc doc-heading">
          <code>Function</code>


</h3>


  <div class="doc doc-contents ">

  
      <p>Callable wrapper around a function meant to be used throughout the
Dispatch Python SDK.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/function.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Function</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Callable wrapper around a function meant to be used throughout the</span>
<span class="sd">    Dispatch Python SDK.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">client</span><span class="p">:</span> <span class="n">Client</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Input</span><span class="p">],</span> <span class="n">Output</span><span class="p">],</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_endpoint</span> <span class="o">=</span> <span class="n">endpoint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span> <span class="o">=</span> <span class="n">client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_func</span> <span class="o">=</span> <span class="n">func</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">endpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoint</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DispatchID</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dispatch a call to the function.</span>

<span class="sd">        The Registry this function was registered with must be initialized</span>
<span class="sd">        with a Client / api_key for this call facility to be available.</span>

<span class="sd">        Args:</span>
<span class="sd">            *args: Positional arguments for the function.</span>
<span class="sd">            **kwargs: Keyword arguments for the function.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DispatchID: ID of the dispatched call.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: if a Dispatch client has not been configured.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">primitive_dispatch</span><span class="p">(</span><span class="n">_Arguments</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="n">kwargs</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">primitive_dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DispatchID</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dispatch a primitive call.</span>

<span class="sd">        The Registry this function was registered with must be initialized</span>
<span class="sd">        with a Client / api_key for this call facility to be available.</span>

<span class="sd">        Args:</span>
<span class="sd">            input: Input to the function.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DispatchID: ID of the dispatched call.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: if a Dispatch client has not been configured.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Dispatch Client has not been configured (api_key not provided)&quot;</span>
            <span class="p">)</span>

        <span class="p">[</span><span class="n">dispatch_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">dispatch</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">primitive_call_with</span><span class="p">(</span><span class="nb">input</span><span class="p">)])</span>
        <span class="k">return</span> <span class="n">dispatch_id</span>

    <span class="k">def</span> <span class="nf">call_with</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">correlation_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Call</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a Call for this function with the provided input. Useful to</span>
<span class="sd">        generate calls when polling.</span>

<span class="sd">        Args:</span>
<span class="sd">            *args: Positional arguments for the function.</span>
<span class="sd">            correlation_id: optional arbitrary integer the caller can use to</span>
<span class="sd">              match this call to a call result.</span>
<span class="sd">            **kwargs: Keyword arguments for the function.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Call: can be passed to Output.poll().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">primitive_call_with</span><span class="p">(</span>
            <span class="n">_Arguments</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="n">kwargs</span><span class="p">),</span> <span class="n">correlation_id</span><span class="o">=</span><span class="n">correlation_id</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">primitive_call_with</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">correlation_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Call</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a Call for this function with the provided input. Useful to</span>
<span class="sd">        generate calls when polling.</span>

<span class="sd">        Args:</span>
<span class="sd">            input: any pickle-able Python value that will be passed as input to</span>
<span class="sd">              this function.</span>
<span class="sd">            correlation_id: optional arbitrary integer the caller can use to</span>
<span class="sd">              match this call to a call result.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Call: can be passed to Output.poll().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Call</span><span class="p">(</span>
            <span class="n">correlation_id</span><span class="o">=</span><span class="n">correlation_id</span><span class="p">,</span>
            <span class="n">endpoint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="p">,</span>
            <span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="nb">input</span><span class="o">=</span><span class="nb">input</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h4 id="dispatch.function.Function.call_with" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">call_with</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">correlation_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Create a Call for this function with the provided input. Useful to
generate calls when polling.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>*args</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Positional arguments for the function.</p>
            </div>
          </td>
          <td>
                <code>()</code>
          </td>
        </tr>
        <tr>
          <td><code>correlation_id</code></td>
          <td>
                <code>int | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>optional arbitrary integer the caller can use to
match this call to a call result.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>**kwargs</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Keyword arguments for the function.</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>Call</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="dispatch.proto.Call" href="#dispatch.proto.Call">Call</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>can be passed to Output.poll().</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>dispatch/function.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">call_with</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">correlation_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Call</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a Call for this function with the provided input. Useful to</span>
<span class="sd">    generate calls when polling.</span>

<span class="sd">    Args:</span>
<span class="sd">        *args: Positional arguments for the function.</span>
<span class="sd">        correlation_id: optional arbitrary integer the caller can use to</span>
<span class="sd">          match this call to a call result.</span>
<span class="sd">        **kwargs: Keyword arguments for the function.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Call: can be passed to Output.poll().</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">primitive_call_with</span><span class="p">(</span>
        <span class="n">_Arguments</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="n">kwargs</span><span class="p">),</span> <span class="n">correlation_id</span><span class="o">=</span><span class="n">correlation_id</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="dispatch.function.Function.dispatch" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">dispatch</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Dispatch a call to the function.</p>
<p>The Registry this function was registered with must be initialized
with a Client / api_key for this call facility to be available.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>*args</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Positional arguments for the function.</p>
            </div>
          </td>
          <td>
                <code>()</code>
          </td>
        </tr>
        <tr>
          <td><code>**kwargs</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Keyword arguments for the function.</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>DispatchID</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="dispatch.id.DispatchID" href="#dispatch.id.DispatchID">DispatchID</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>ID of the dispatched call.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>RuntimeError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>if a Dispatch client has not been configured.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>dispatch/function.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DispatchID</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dispatch a call to the function.</span>

<span class="sd">    The Registry this function was registered with must be initialized</span>
<span class="sd">    with a Client / api_key for this call facility to be available.</span>

<span class="sd">    Args:</span>
<span class="sd">        *args: Positional arguments for the function.</span>
<span class="sd">        **kwargs: Keyword arguments for the function.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DispatchID: ID of the dispatched call.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: if a Dispatch client has not been configured.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">primitive_dispatch</span><span class="p">(</span><span class="n">_Arguments</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="n">kwargs</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="dispatch.function.Function.primitive_call_with" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">primitive_call_with</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">correlation_id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Create a Call for this function with the provided input. Useful to
generate calls when polling.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>any pickle-able Python value that will be passed as input to
this function.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>correlation_id</code></td>
          <td>
                <code>int | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>optional arbitrary integer the caller can use to
match this call to a call result.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>Call</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="dispatch.proto.Call" href="#dispatch.proto.Call">Call</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>can be passed to Output.poll().</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>dispatch/function.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">primitive_call_with</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">correlation_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Call</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a Call for this function with the provided input. Useful to</span>
<span class="sd">    generate calls when polling.</span>

<span class="sd">    Args:</span>
<span class="sd">        input: any pickle-able Python value that will be passed as input to</span>
<span class="sd">          this function.</span>
<span class="sd">        correlation_id: optional arbitrary integer the caller can use to</span>
<span class="sd">          match this call to a call result.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Call: can be passed to Output.poll().</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Call</span><span class="p">(</span>
        <span class="n">correlation_id</span><span class="o">=</span><span class="n">correlation_id</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="p">,</span>
        <span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="nb">input</span><span class="o">=</span><span class="nb">input</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="dispatch.function.Function.primitive_dispatch" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">primitive_dispatch</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Dispatch a primitive call.</p>
<p>The Registry this function was registered with must be initialized
with a Client / api_key for this call facility to be available.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Input to the function.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>DispatchID</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="dispatch.id.DispatchID" href="#dispatch.id.DispatchID">DispatchID</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>ID of the dispatched call.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>RuntimeError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>if a Dispatch client has not been configured.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>dispatch/function.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">primitive_dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DispatchID</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dispatch a primitive call.</span>

<span class="sd">    The Registry this function was registered with must be initialized</span>
<span class="sd">    with a Client / api_key for this call facility to be available.</span>

<span class="sd">    Args:</span>
<span class="sd">        input: Input to the function.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DispatchID: ID of the dispatched call.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: if a Dispatch client has not been configured.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s2">&quot;Dispatch Client has not been configured (api_key not provided)&quot;</span>
        <span class="p">)</span>

    <span class="p">[</span><span class="n">dispatch_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">dispatch</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">primitive_call_with</span><span class="p">(</span><span class="nb">input</span><span class="p">)])</span>
    <span class="k">return</span> <span class="n">dispatch_id</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h3 id="dispatch.function.Registry" class="doc doc-heading">
          <code>Registry</code>


</h3>


  <div class="doc doc-contents ">

  
      <p>Registry of local functions.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/function.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Registry</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Registry of local functions.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">Client</span> <span class="o">|</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a local function registry.</span>

<span class="sd">        Args:</span>
<span class="sd">            endpoint: URL of the endpoint that the function is accessible from.</span>
<span class="sd">            client: Optional client for the Dispatch API. If provided, calls</span>
<span class="sd">              to local functions can be dispatched directly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_functions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Function</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_endpoint</span> <span class="o">=</span> <span class="n">endpoint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span> <span class="o">=</span> <span class="n">client</span>

    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">FunctionType</span><span class="p">],</span> <span class="n">Function</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a decorator that registers functions.&quot;&quot;&quot;</span>

        <span class="c1"># Note: the indirection here means that we can add parameters</span>
        <span class="c1"># to the decorator later without breaking existing apps.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_register_function</span>

    <span class="k">def</span> <span class="nf">coroutine</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">FunctionType</span><span class="p">],</span> <span class="n">Function</span> <span class="o">|</span> <span class="n">FunctionType</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a decorator that registers coroutine functions.&quot;&quot;&quot;</span>

        <span class="c1"># Note: the indirection here means that we can add parameters</span>
        <span class="c1"># to the decorator later without breaking existing apps.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_register_coroutine</span>

    <span class="k">def</span> <span class="nf">primitive_function</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">PrimitiveFunctionType</span><span class="p">],</span> <span class="n">Function</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a decorator that registers primitive functions.&quot;&quot;&quot;</span>

        <span class="c1"># Note: the indirection here means that we can add parameters</span>
        <span class="c1"># to the decorator later without breaking existing apps.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_register_primitive_function</span>

    <span class="k">def</span> <span class="nf">_register_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">FunctionType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Function</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a function with the Dispatch programmable endpoints.</span>

<span class="sd">        Args:</span>
<span class="sd">            func: The function to register.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Function: A registered Dispatch Function.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the function is already registered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;async functions must be registered via @dispatch.coroutine&quot;</span>
            <span class="p">)</span>

        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">primitive_func</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="n">Input</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">input_arguments</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;incorrect input for function&quot;</span><span class="p">)</span>
                <span class="n">raw_output</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;@dispatch.function: &#39;</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; raised an exception&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">Output</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">Error</span><span class="o">.</span><span class="n">from_exception</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Output</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">raw_output</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_register_primitive_function</span><span class="p">(</span><span class="n">primitive_func</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_register_coroutine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">FunctionType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Function</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;(EXPERIMENTAL) Register a coroutine function with the Dispatch</span>
<span class="sd">        programmable endpoints.</span>

<span class="sd">        The function is compiled into a durable coroutine.</span>

<span class="sd">        The coroutine can use directives such as poll() partway through</span>
<span class="sd">        execution. The coroutine will be suspended at these yield points,</span>
<span class="sd">        and will resume execution from the same point when results are</span>
<span class="sd">        available. The state of the coroutine is stored durably across</span>
<span class="sd">        yield points.</span>

<span class="sd">        Args:</span>
<span class="sd">            func: The coroutine to register.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Function: A registered Dispatch Function.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the function is already registered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inspect</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__qualname__</span><span class="si">}</span><span class="s2"> must be an async function&quot;</span><span class="p">)</span>

        <span class="n">durable_func</span> <span class="o">=</span> <span class="n">durable</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">primitive_func</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="n">Input</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">schedule</span><span class="p">(</span><span class="n">durable_func</span><span class="p">,</span> <span class="nb">input</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_register_primitive_function</span><span class="p">(</span><span class="n">primitive_func</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_register_primitive_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">PrimitiveFunctionType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Function</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a primitive function with the Dispatch programmable endpoints.</span>

<span class="sd">        Args:</span>
<span class="sd">            func: The function to register.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Function: A registered Dispatch Function.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the function is already registered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__qualname__</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;registering function &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_functions</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Function </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> already registered&quot;</span><span class="p">)</span>
        <span class="n">wrapped_func</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endpoint</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_functions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">wrapped_func</span>
        <span class="k">return</span> <span class="n">wrapped_func</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h4 id="dispatch.function.Registry.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">client</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Initialize a local function registry.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>endpoint</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>URL of the endpoint that the function is accessible from.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>client</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="dispatch.client.Client" href="#dispatch.client.Client">Client</a> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Optional client for the Dispatch API. If provided, calls
to local functions can be dispatched directly.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>dispatch/function.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">Client</span> <span class="o">|</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize a local function registry.</span>

<span class="sd">    Args:</span>
<span class="sd">        endpoint: URL of the endpoint that the function is accessible from.</span>
<span class="sd">        client: Optional client for the Dispatch API. If provided, calls</span>
<span class="sd">          to local functions can be dispatched directly.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_functions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Function</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_endpoint</span> <span class="o">=</span> <span class="n">endpoint</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_client</span> <span class="o">=</span> <span class="n">client</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="dispatch.function.Registry.coroutine" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">coroutine</span><span class="p">()</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Returns a decorator that registers coroutine functions.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/function.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">coroutine</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">FunctionType</span><span class="p">],</span> <span class="n">Function</span> <span class="o">|</span> <span class="n">FunctionType</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a decorator that registers coroutine functions.&quot;&quot;&quot;</span>

    <span class="c1"># Note: the indirection here means that we can add parameters</span>
    <span class="c1"># to the decorator later without breaking existing apps.</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_register_coroutine</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="dispatch.function.Registry.function" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">function</span><span class="p">()</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Returns a decorator that registers functions.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/function.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">FunctionType</span><span class="p">],</span> <span class="n">Function</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a decorator that registers functions.&quot;&quot;&quot;</span>

    <span class="c1"># Note: the indirection here means that we can add parameters</span>
    <span class="c1"># to the decorator later without breaking existing apps.</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_register_function</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="dispatch.function.Registry.primitive_function" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">primitive_function</span><span class="p">()</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Returns a decorator that registers primitive functions.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/function.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">primitive_function</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">PrimitiveFunctionType</span><span class="p">],</span> <span class="n">Function</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a decorator that registers primitive functions.&quot;&quot;&quot;</span>

    <span class="c1"># Note: the indirection here means that we can add parameters</span>
    <span class="c1"># to the decorator later without breaking existing apps.</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_register_primitive_function</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="dispatch.id" class="doc doc-heading">
          <code>id</code>


</h2>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="dispatch.id.DispatchID" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">DispatchID</span><span class="p">:</span> <span class="n">TypeAlias</span> <span class="o">=</span> <span class="nb">str</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Unique identifier in Dispatch.</p>
<p>It should be treated as an opaque value.</p>
  </div>

</div>





  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="dispatch.integrations" class="doc doc-heading">
          <code>integrations</code>


</h2>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="dispatch.integrations.http" class="doc doc-heading">
          <code>http</code>


</h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h4 id="dispatch.integrations.http.http_response_code_status" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">http_response_code_status</span><span class="p">(</span><span class="n">code</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Returns a Status that's broadly equivalent to an HTTP response
status code.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/integrations/http.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">http_response_code_status</span><span class="p">(</span><span class="n">code</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Status</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a Status that&#39;s broadly equivalent to an HTTP response</span>
<span class="sd">    status code.&quot;&quot;&quot;</span>
    <span class="k">match</span> <span class="n">code</span><span class="p">:</span>
        <span class="k">case</span> <span class="mi">429</span><span class="p">:</span>  <span class="c1"># Too Many Requests</span>
            <span class="k">return</span> <span class="n">Status</span><span class="o">.</span><span class="n">THROTTLED</span>
        <span class="k">case</span> <span class="mi">501</span><span class="p">:</span>  <span class="c1"># Not Implemented</span>
            <span class="k">return</span> <span class="n">Status</span><span class="o">.</span><span class="n">PERMANENT_ERROR</span>

    <span class="n">category</span> <span class="o">=</span> <span class="n">code</span> <span class="o">//</span> <span class="mi">100</span>
    <span class="k">match</span> <span class="n">category</span><span class="p">:</span>
        <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># 1xx informational</span>
            <span class="k">return</span> <span class="n">Status</span><span class="o">.</span><span class="n">PERMANENT_ERROR</span>
        <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># 2xx success</span>
            <span class="k">return</span> <span class="n">Status</span><span class="o">.</span><span class="n">OK</span>
        <span class="k">case</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># 3xx redirection</span>
            <span class="k">return</span> <span class="n">Status</span><span class="o">.</span><span class="n">PERMANENT_ERROR</span>
        <span class="k">case</span> <span class="mi">4</span><span class="p">:</span>  <span class="c1"># 4xx client error</span>
            <span class="k">return</span> <span class="n">Status</span><span class="o">.</span><span class="n">PERMANENT_ERROR</span>
        <span class="k">case</span> <span class="mi">5</span><span class="p">:</span>  <span class="c1"># 5xx server error</span>
            <span class="k">return</span> <span class="n">Status</span><span class="o">.</span><span class="n">TEMPORARY_ERROR</span>

    <span class="k">return</span> <span class="n">Status</span><span class="o">.</span><span class="n">UNSPECIFIED</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="dispatch.integrations.httpx" class="doc doc-heading">
          <code>httpx</code>


</h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="dispatch.integrations.requests" class="doc doc-heading">
          <code>requests</code>


</h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">











  </div>

  </div>

</div>


  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="dispatch.proto" class="doc doc-heading">
          <code>proto</code>


</h2>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="dispatch.proto.Call" class="doc doc-heading">
          <code>Call</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">

  
      <p>Instruction to call a function.</p>
<p>Though this class can be built manually, it is recommended to use the
with_call method of a Function instead.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/proto.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Call</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Instruction to call a function.</span>

<span class="sd">    Though this class can be built manually, it is recommended to use the</span>
<span class="sd">    with_call method of a Function instead.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">function</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">input</span><span class="p">:</span> <span class="n">Any</span>
    <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">correlation_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_as_proto</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">call_pb</span><span class="o">.</span><span class="n">Call</span><span class="p">:</span>
        <span class="n">input_bytes</span> <span class="o">=</span> <span class="n">_pb_any_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">call_pb</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span>
            <span class="n">correlation_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">correlation_id</span><span class="p">,</span>
            <span class="n">endpoint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="p">,</span>
            <span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">,</span>
            <span class="nb">input</span><span class="o">=</span><span class="n">input_bytes</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h3 id="dispatch.proto.CallResult" class="doc doc-heading">
          <code>CallResult</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">

  
      <p>Result of a Call.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/proto.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">CallResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Result of a Call.&quot;&quot;&quot;</span>

    <span class="n">correlation_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">output</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">error</span><span class="p">:</span> <span class="n">Error</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_as_proto</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">call_pb</span><span class="o">.</span><span class="n">CallResult</span><span class="p">:</span>
        <span class="n">output_any</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">error_proto</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output_any</span> <span class="o">=</span> <span class="n">_pb_any_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">error_proto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">_as_proto</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">call_pb</span><span class="o">.</span><span class="n">CallResult</span><span class="p">(</span>
            <span class="n">correlation_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">correlation_id</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">output_any</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error_proto</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_from_proto</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">proto</span><span class="p">:</span> <span class="n">call_pb</span><span class="o">.</span><span class="n">CallResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallResult</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">proto</span><span class="o">.</span><span class="n">HasField</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">):</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">_any_unpickle</span><span class="p">(</span><span class="n">proto</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">proto</span><span class="o">.</span><span class="n">HasField</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">):</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">Error</span><span class="o">.</span><span class="n">_from_proto</span><span class="p">(</span><span class="n">proto</span><span class="o">.</span><span class="n">error</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">CallResult</span><span class="p">(</span>
            <span class="n">correlation_id</span><span class="o">=</span><span class="n">proto</span><span class="o">.</span><span class="n">correlation_id</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_value</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">correlation_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallResult</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CallResult</span><span class="p">(</span><span class="n">correlation_id</span><span class="o">=</span><span class="n">correlation_id</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_error</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="n">Error</span><span class="p">,</span> <span class="n">correlation_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallResult</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CallResult</span><span class="p">(</span><span class="n">correlation_id</span><span class="o">=</span><span class="n">correlation_id</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h3 id="dispatch.proto.Error" class="doc doc-heading">
          <code>Error</code>


</h3>


  <div class="doc doc-contents ">

  
      <p>Error when running a function.</p>
<p>This is not a Python exception, but potentially part of a CallResult or
Output.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/proto.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Error</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Error when running a function.</span>

<span class="sd">    This is not a Python exception, but potentially part of a CallResult or</span>
<span class="sd">    Output.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">Status</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new Error.</span>

<span class="sd">        Args:</span>
<span class="sd">            status: categorization of the error.</span>
<span class="sd">            type: arbitrary string, used for humans. Optional.</span>
<span class="sd">            message: arbitrary message. Optional.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Neither type or message was provided or status is</span>
<span class="sd">              invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">message</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least one of type or message is required&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="n">Status</span><span class="o">.</span><span class="n">OK</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Status cannot be OK&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_exception</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">ex</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">Status</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Error</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an Error from a Python exception, using its class qualified</span>
<span class="sd">        named as type.</span>

<span class="sd">        The status tries to be inferred, but can be overridden. If it is not</span>
<span class="sd">        provided or cannot be inferred, it defaults to TEMPORARY_ERROR.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">status_for_error</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Error</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">ex</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__qualname__</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_from_proto</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">proto</span><span class="p">:</span> <span class="n">error_pb</span><span class="o">.</span><span class="n">Error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Error</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">Status</span><span class="o">.</span><span class="n">UNSPECIFIED</span><span class="p">,</span> <span class="n">proto</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">proto</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_as_proto</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">error_pb</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">error_pb</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h4 id="dispatch.proto.Error.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Create a new Error.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>status</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="dispatch.status.Status" href="#dispatch.status.Status">Status</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>categorization of the error.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>type</code></td>
          <td>
                <code>str | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>arbitrary string, used for humans. Optional.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>message</code></td>
          <td>
                <code>str | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>arbitrary message. Optional.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>ValueError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Neither type or message was provided or status is
invalid.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>dispatch/proto.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">Status</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new Error.</span>

<span class="sd">    Args:</span>
<span class="sd">        status: categorization of the error.</span>
<span class="sd">        type: arbitrary string, used for humans. Optional.</span>
<span class="sd">        message: arbitrary message. Optional.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Neither type or message was provided or status is</span>
<span class="sd">          invalid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">message</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least one of type or message is required&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="n">Status</span><span class="o">.</span><span class="n">OK</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Status cannot be OK&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="dispatch.proto.Error.from_exception" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">from_exception</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Create an Error from a Python exception, using its class qualified
named as type.</p>
<p>The status tries to be inferred, but can be overridden. If it is not
provided or cannot be inferred, it defaults to TEMPORARY_ERROR.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/proto.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_exception</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">ex</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">Status</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Error</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create an Error from a Python exception, using its class qualified</span>
<span class="sd">    named as type.</span>

<span class="sd">    The status tries to be inferred, but can be overridden. If it is not</span>
<span class="sd">    provided or cannot be inferred, it defaults to TEMPORARY_ERROR.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">status_for_error</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Error</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">ex</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__qualname__</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h3 id="dispatch.proto.Input" class="doc doc-heading">
          <code>Input</code>


</h3>


  <div class="doc doc-contents ">

  
      <p>The input to a primitive function.</p>
<p>Functions always take a single argument of type Input. When the function is
run for the first time, it receives the input. When the function is a coroutine
that's resuming after a yield point, it receives the results of the yield
directive. Use the is_first_call and is_resume properties to differentiate
between the two cases.</p>
<p>This class is intended to be used as read-only.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/proto.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Input</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The input to a primitive function.</span>

<span class="sd">    Functions always take a single argument of type Input. When the function is</span>
<span class="sd">    run for the first time, it receives the input. When the function is a coroutine</span>
<span class="sd">    that&#39;s resuming after a yield point, it receives the results of the yield</span>
<span class="sd">    directive. Use the is_first_call and is_resume properties to differentiate</span>
<span class="sd">    between the two cases.</span>

<span class="sd">    This class is intended to be used as read-only.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">:</span> <span class="n">function_pb</span><span class="o">.</span><span class="n">RunRequest</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_input</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">HasField</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_input</span><span class="p">:</span>
            <span class="n">input_pb</span> <span class="o">=</span> <span class="n">google</span><span class="o">.</span><span class="n">protobuf</span><span class="o">.</span><span class="n">wrappers_pb2</span><span class="o">.</span><span class="n">BytesValue</span><span class="p">()</span>
            <span class="n">req</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">Unpack</span><span class="p">(</span><span class="n">input_pb</span><span class="p">)</span>
            <span class="n">input_bytes</span> <span class="o">=</span> <span class="n">input_pb</span><span class="o">.</span><span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_input</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">input_bytes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">state_bytes</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">poll_result</span><span class="o">.</span><span class="n">coroutine_state</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_bytes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_coroutine_state</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">state_bytes</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_coroutine_state</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_call_results</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">CallResult</span><span class="o">.</span><span class="n">_from_proto</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">req</span><span class="o">.</span><span class="n">poll_result</span><span class="o">.</span><span class="n">results</span>
            <span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_first_call</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_input</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_resume</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_first_call</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">input</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_first_call</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input</span>

    <span class="k">def</span> <span class="nf">input_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns positional and keyword arguments carried by the input.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_first_call</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_input</span><span class="p">,</span> <span class="n">_Arguments</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;input does not hold arguments&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input</span><span class="o">.</span><span class="n">kwargs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">coroutine_state</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_resume</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coroutine_state</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">call_results</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">CallResult</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_resume</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_results</span>

    <span class="k">def</span> <span class="nf">_assert_first_call</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_resume</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This input is for a resumed coroutine&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_assert_resume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_first_call</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This input is for a first function call&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h4 id="dispatch.proto.Input.input_arguments" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">input_arguments</span><span class="p">()</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Returns positional and keyword arguments carried by the input.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/proto.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">input_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns positional and keyword arguments carried by the input.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_assert_first_call</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_input</span><span class="p">,</span> <span class="n">_Arguments</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;input does not hold arguments&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input</span><span class="o">.</span><span class="n">kwargs</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h3 id="dispatch.proto.Output" class="doc doc-heading">
          <code>Output</code>


</h3>


  <div class="doc doc-contents ">

  
      <p>The output of a primitive function.</p>
<p>This class is meant to be instantiated and returned by authors of functions
to indicate the follow up action they need to take. Use the various class
methods create an instance of this class. For example Output.value() or
Output.poll().</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/proto.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Output</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The output of a primitive function.</span>

<span class="sd">    This class is meant to be instantiated and returned by authors of functions</span>
<span class="sd">    to indicate the follow up action they need to take. Use the various class</span>
<span class="sd">    methods create an instance of this class. For example Output.value() or</span>
<span class="sd">    Output.poll().</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proto</span><span class="p">:</span> <span class="n">function_pb</span><span class="o">.</span><span class="n">RunResponse</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_message</span> <span class="o">=</span> <span class="n">proto</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">Status</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Terminally exit the function with the provided return value.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">status_for_output</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="n">CallResult</span><span class="o">.</span><span class="n">from_value</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="n">Error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Terminally exit the function with the provided error.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="n">CallResult</span><span class="o">.</span><span class="n">from_error</span><span class="p">(</span><span class="n">error</span><span class="p">),</span> <span class="n">status</span><span class="o">=</span><span class="n">error</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">tail_call</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">tail_call</span><span class="p">:</span> <span class="n">Call</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Terminally exit the function, and instruct the orchestrator to</span>
<span class="sd">        tail call the specified function.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">tail_call</span><span class="o">=</span><span class="n">tail_call</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">exit</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tail_call</span><span class="p">:</span> <span class="n">Call</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">status</span><span class="p">:</span> <span class="n">Status</span> <span class="o">=</span> <span class="n">Status</span><span class="o">.</span><span class="n">OK</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Terminally exit the function.&quot;&quot;&quot;</span>
        <span class="n">result_proto</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">_as_proto</span><span class="p">()</span> <span class="k">if</span> <span class="n">result</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">tail_call_proto</span> <span class="o">=</span> <span class="n">tail_call</span><span class="o">.</span><span class="n">_as_proto</span><span class="p">()</span> <span class="k">if</span> <span class="n">tail_call</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">Output</span><span class="p">(</span>
            <span class="n">function_pb</span><span class="o">.</span><span class="n">RunResponse</span><span class="p">(</span>
                <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">_proto</span><span class="p">,</span>
                <span class="n">exit</span><span class="o">=</span><span class="n">exit_pb</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="n">result_proto</span><span class="p">,</span> <span class="n">tail_call</span><span class="o">=</span><span class="n">tail_call_proto</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">poll</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">calls</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">Call</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Suspend the function with a set of Calls, instructing the</span>
<span class="sd">        orchestrator to resume the function with the provided state when</span>
<span class="sd">        call results are ready.&quot;&quot;&quot;</span>
        <span class="n">state_bytes</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="n">poll</span> <span class="o">=</span> <span class="n">poll_pb</span><span class="o">.</span><span class="n">Poll</span><span class="p">(</span>
            <span class="n">coroutine_state</span><span class="o">=</span><span class="n">state_bytes</span><span class="p">,</span>
            <span class="c1"># FIXME: make this configurable</span>
            <span class="n">max_results</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">max_wait</span><span class="o">=</span><span class="n">duration_pb2</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">calls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">calls</span><span class="p">:</span>
                <span class="n">poll</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">_as_proto</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">Output</span><span class="p">(</span>
            <span class="n">function_pb</span><span class="o">.</span><span class="n">RunResponse</span><span class="p">(</span>
                <span class="n">status</span><span class="o">=</span><span class="n">status_pb</span><span class="o">.</span><span class="n">STATUS_OK</span><span class="p">,</span>
                <span class="n">poll</span><span class="o">=</span><span class="n">poll</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h4 id="dispatch.proto.Output.error" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">error</span><span class="p">(</span><span class="n">error</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Terminally exit the function with the provided error.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/proto.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="n">Error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Terminally exit the function with the provided error.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="n">CallResult</span><span class="o">.</span><span class="n">from_error</span><span class="p">(</span><span class="n">error</span><span class="p">),</span> <span class="n">status</span><span class="o">=</span><span class="n">error</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="dispatch.proto.Output.exit" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">exit</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tail_call</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">Status</span><span class="o">.</span><span class="n">OK</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Terminally exit the function.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/proto.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">exit</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tail_call</span><span class="p">:</span> <span class="n">Call</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">Status</span> <span class="o">=</span> <span class="n">Status</span><span class="o">.</span><span class="n">OK</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Terminally exit the function.&quot;&quot;&quot;</span>
    <span class="n">result_proto</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">_as_proto</span><span class="p">()</span> <span class="k">if</span> <span class="n">result</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">tail_call_proto</span> <span class="o">=</span> <span class="n">tail_call</span><span class="o">.</span><span class="n">_as_proto</span><span class="p">()</span> <span class="k">if</span> <span class="n">tail_call</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">Output</span><span class="p">(</span>
        <span class="n">function_pb</span><span class="o">.</span><span class="n">RunResponse</span><span class="p">(</span>
            <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">_proto</span><span class="p">,</span>
            <span class="n">exit</span><span class="o">=</span><span class="n">exit_pb</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="n">result_proto</span><span class="p">,</span> <span class="n">tail_call</span><span class="o">=</span><span class="n">tail_call_proto</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="dispatch.proto.Output.poll" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">poll</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">calls</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Suspend the function with a set of Calls, instructing the
orchestrator to resume the function with the provided state when
call results are ready.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/proto.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">poll</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">calls</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">Call</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Suspend the function with a set of Calls, instructing the</span>
<span class="sd">    orchestrator to resume the function with the provided state when</span>
<span class="sd">    call results are ready.&quot;&quot;&quot;</span>
    <span class="n">state_bytes</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
    <span class="n">poll</span> <span class="o">=</span> <span class="n">poll_pb</span><span class="o">.</span><span class="n">Poll</span><span class="p">(</span>
        <span class="n">coroutine_state</span><span class="o">=</span><span class="n">state_bytes</span><span class="p">,</span>
        <span class="c1"># FIXME: make this configurable</span>
        <span class="n">max_results</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">max_wait</span><span class="o">=</span><span class="n">duration_pb2</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">calls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">calls</span><span class="p">:</span>
            <span class="n">poll</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">_as_proto</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">Output</span><span class="p">(</span>
        <span class="n">function_pb</span><span class="o">.</span><span class="n">RunResponse</span><span class="p">(</span>
            <span class="n">status</span><span class="o">=</span><span class="n">status_pb</span><span class="o">.</span><span class="n">STATUS_OK</span><span class="p">,</span>
            <span class="n">poll</span><span class="o">=</span><span class="n">poll</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="dispatch.proto.Output.tail_call" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">tail_call</span><span class="p">(</span><span class="n">tail_call</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Terminally exit the function, and instruct the orchestrator to
tail call the specified function.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/proto.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">tail_call</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">tail_call</span><span class="p">:</span> <span class="n">Call</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Terminally exit the function, and instruct the orchestrator to</span>
<span class="sd">    tail call the specified function.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">tail_call</span><span class="o">=</span><span class="n">tail_call</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="dispatch.proto.Output.value" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Terminally exit the function with the provided return value.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/proto.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">Status</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Terminally exit the function with the provided return value.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">status_for_output</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="n">CallResult</span><span class="o">.</span><span class="n">from_value</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="dispatch.sdk" class="doc doc-heading">
          <code>sdk</code>


</h2>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="dispatch.sdk.v1" class="doc doc-heading">
          <code>v1</code>


</h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h4 id="dispatch.sdk.v1.call_pb2" class="doc doc-heading">
          <code>call_pb2</code>


</h4>

  <div class="doc doc-contents ">
  
      <p>Generated protocol buffer code.</p>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="dispatch.sdk.v1.call_pb2_grpc" class="doc doc-heading">
          <code>call_pb2_grpc</code>


</h4>

  <div class="doc doc-contents ">
  
      <p>Client and server classes corresponding to protobuf-defined services.</p>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="dispatch.sdk.v1.dispatch_pb2" class="doc doc-heading">
          <code>dispatch_pb2</code>


</h4>

  <div class="doc doc-contents ">
  
      <p>Generated protocol buffer code.</p>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="dispatch.sdk.v1.dispatch_pb2_grpc" class="doc doc-heading">
          <code>dispatch_pb2_grpc</code>


</h4>

  <div class="doc doc-contents ">
  
      <p>Client and server classes corresponding to protobuf-defined services.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="dispatch.sdk.v1.dispatch_pb2_grpc.DispatchService" class="doc doc-heading">
          <code>DispatchService</code>


</h5>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code>object</code></p>

  
      <p>DispatchService is a service allowing the trigger of programmable endpoints
from a dispatch SDK.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/sdk/v1/dispatch_pb2_grpc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DispatchService</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;DispatchService is a service allowing the trigger of programmable endpoints</span>
<span class="sd">    from a dispatch SDK.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">Dispatch</span><span class="p">(</span>
        <span class="n">request</span><span class="p">,</span>
        <span class="n">target</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="p">(),</span>
        <span class="n">channel_credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">call_credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">insecure</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">compression</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">wait_for_ready</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="n">grpc</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">unary_unary</span><span class="p">(</span>
            <span class="n">request</span><span class="p">,</span>
            <span class="n">target</span><span class="p">,</span>
            <span class="s2">&quot;/dispatch.sdk.v1.DispatchService/Dispatch&quot;</span><span class="p">,</span>
            <span class="n">dispatch_dot_sdk_dot_v1_dot_dispatch__pb2</span><span class="o">.</span><span class="n">DispatchRequest</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">,</span>
            <span class="n">dispatch_dot_sdk_dot_v1_dot_dispatch__pb2</span><span class="o">.</span><span class="n">DispatchResponse</span><span class="o">.</span><span class="n">FromString</span><span class="p">,</span>
            <span class="n">options</span><span class="p">,</span>
            <span class="n">channel_credentials</span><span class="p">,</span>
            <span class="n">insecure</span><span class="p">,</span>
            <span class="n">call_credentials</span><span class="p">,</span>
            <span class="n">compression</span><span class="p">,</span>
            <span class="n">wait_for_ready</span><span class="p">,</span>
            <span class="n">timeout</span><span class="p">,</span>
            <span class="n">metadata</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h5 id="dispatch.sdk.v1.dispatch_pb2_grpc.DispatchServiceServicer" class="doc doc-heading">
          <code>DispatchServiceServicer</code>


</h5>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code>object</code></p>

  
      <p>DispatchService is a service allowing the trigger of programmable endpoints
from a dispatch SDK.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/sdk/v1/dispatch_pb2_grpc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DispatchServiceServicer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;DispatchService is a service allowing the trigger of programmable endpoints</span>
<span class="sd">    from a dispatch SDK.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">Dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dispatch submits a list of asynchronous function calls to the service.</span>

<span class="sd">        The method does not wait for executions to complete before returning,</span>
<span class="sd">        it only ensures that the creation was persisted, and returns unique</span>
<span class="sd">        identifiers to represent the executions.</span>

<span class="sd">        The request contains a list of executions to be triggered; the method is</span>
<span class="sd">        atomic, either all executions are recorded, or none and an error is</span>
<span class="sd">        returned to explain the reason for the failure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">context</span><span class="o">.</span><span class="n">set_code</span><span class="p">(</span><span class="n">grpc</span><span class="o">.</span><span class="n">StatusCode</span><span class="o">.</span><span class="n">UNIMPLEMENTED</span><span class="p">)</span>
        <span class="n">context</span><span class="o">.</span><span class="n">set_details</span><span class="p">(</span><span class="s2">&quot;Method not implemented!&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Method not implemented!&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h6 id="dispatch.sdk.v1.dispatch_pb2_grpc.DispatchServiceServicer.Dispatch" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">Dispatch</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

</h6>


  <div class="doc doc-contents ">
  
      <p>Dispatch submits a list of asynchronous function calls to the service.</p>
<p>The method does not wait for executions to complete before returning,
it only ensures that the creation was persisted, and returns unique
identifiers to represent the executions.</p>
<p>The request contains a list of executions to be triggered; the method is
atomic, either all executions are recorded, or none and an error is
returned to explain the reason for the failure.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/sdk/v1/dispatch_pb2_grpc.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">Dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dispatch submits a list of asynchronous function calls to the service.</span>

<span class="sd">    The method does not wait for executions to complete before returning,</span>
<span class="sd">    it only ensures that the creation was persisted, and returns unique</span>
<span class="sd">    identifiers to represent the executions.</span>

<span class="sd">    The request contains a list of executions to be triggered; the method is</span>
<span class="sd">    atomic, either all executions are recorded, or none and an error is</span>
<span class="sd">    returned to explain the reason for the failure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">context</span><span class="o">.</span><span class="n">set_code</span><span class="p">(</span><span class="n">grpc</span><span class="o">.</span><span class="n">StatusCode</span><span class="o">.</span><span class="n">UNIMPLEMENTED</span><span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">set_details</span><span class="p">(</span><span class="s2">&quot;Method not implemented!&quot;</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Method not implemented!&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h5 id="dispatch.sdk.v1.dispatch_pb2_grpc.DispatchServiceStub" class="doc doc-heading">
          <code>DispatchServiceStub</code>


</h5>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code>object</code></p>

  
      <p>DispatchService is a service allowing the trigger of programmable endpoints
from a dispatch SDK.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/sdk/v1/dispatch_pb2_grpc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DispatchServiceStub</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;DispatchService is a service allowing the trigger of programmable endpoints</span>
<span class="sd">    from a dispatch SDK.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor.</span>

<span class="sd">        Args:</span>
<span class="sd">            channel: A grpc.Channel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Dispatch</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">unary_unary</span><span class="p">(</span>
            <span class="s2">&quot;/dispatch.sdk.v1.DispatchService/Dispatch&quot;</span><span class="p">,</span>
            <span class="n">request_serializer</span><span class="o">=</span><span class="n">dispatch_dot_sdk_dot_v1_dot_dispatch__pb2</span><span class="o">.</span><span class="n">DispatchRequest</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">,</span>
            <span class="n">response_deserializer</span><span class="o">=</span><span class="n">dispatch_dot_sdk_dot_v1_dot_dispatch__pb2</span><span class="o">.</span><span class="n">DispatchResponse</span><span class="o">.</span><span class="n">FromString</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h6 id="dispatch.sdk.v1.dispatch_pb2_grpc.DispatchServiceStub.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span></code>

</h6>


  <div class="doc doc-contents ">
  
      <p>Constructor.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>channel</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A grpc.Channel.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>dispatch/sdk/v1/dispatch_pb2_grpc.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor.</span>

<span class="sd">    Args:</span>
<span class="sd">        channel: A grpc.Channel.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Dispatch</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">unary_unary</span><span class="p">(</span>
        <span class="s2">&quot;/dispatch.sdk.v1.DispatchService/Dispatch&quot;</span><span class="p">,</span>
        <span class="n">request_serializer</span><span class="o">=</span><span class="n">dispatch_dot_sdk_dot_v1_dot_dispatch__pb2</span><span class="o">.</span><span class="n">DispatchRequest</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">,</span>
        <span class="n">response_deserializer</span><span class="o">=</span><span class="n">dispatch_dot_sdk_dot_v1_dot_dispatch__pb2</span><span class="o">.</span><span class="n">DispatchResponse</span><span class="o">.</span><span class="n">FromString</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="dispatch.sdk.v1.error_pb2" class="doc doc-heading">
          <code>error_pb2</code>


</h4>

  <div class="doc doc-contents ">
  
      <p>Generated protocol buffer code.</p>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="dispatch.sdk.v1.error_pb2_grpc" class="doc doc-heading">
          <code>error_pb2_grpc</code>


</h4>

  <div class="doc doc-contents ">
  
      <p>Client and server classes corresponding to protobuf-defined services.</p>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="dispatch.sdk.v1.exit_pb2" class="doc doc-heading">
          <code>exit_pb2</code>


</h4>

  <div class="doc doc-contents ">
  
      <p>Generated protocol buffer code.</p>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="dispatch.sdk.v1.exit_pb2_grpc" class="doc doc-heading">
          <code>exit_pb2_grpc</code>


</h4>

  <div class="doc doc-contents ">
  
      <p>Client and server classes corresponding to protobuf-defined services.</p>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="dispatch.sdk.v1.function_pb2" class="doc doc-heading">
          <code>function_pb2</code>


</h4>

  <div class="doc doc-contents ">
  
      <p>Generated protocol buffer code.</p>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="dispatch.sdk.v1.function_pb2_grpc" class="doc doc-heading">
          <code>function_pb2_grpc</code>


</h4>

  <div class="doc doc-contents ">
  
      <p>Client and server classes corresponding to protobuf-defined services.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="dispatch.sdk.v1.function_pb2_grpc.FunctionService" class="doc doc-heading">
          <code>FunctionService</code>


</h5>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code>object</code></p>

  
      <p>The FunctionService service is used to interface with programmable endpoints
exposing remote functions.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/sdk/v1/function_pb2_grpc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FunctionService</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The FunctionService service is used to interface with programmable endpoints</span>
<span class="sd">    exposing remote functions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">Run</span><span class="p">(</span>
        <span class="n">request</span><span class="p">,</span>
        <span class="n">target</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="p">(),</span>
        <span class="n">channel_credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">call_credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">insecure</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">compression</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">wait_for_ready</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="n">grpc</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">unary_unary</span><span class="p">(</span>
            <span class="n">request</span><span class="p">,</span>
            <span class="n">target</span><span class="p">,</span>
            <span class="s2">&quot;/dispatch.sdk.v1.FunctionService/Run&quot;</span><span class="p">,</span>
            <span class="n">dispatch_dot_sdk_dot_v1_dot_function__pb2</span><span class="o">.</span><span class="n">RunRequest</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">,</span>
            <span class="n">dispatch_dot_sdk_dot_v1_dot_function__pb2</span><span class="o">.</span><span class="n">RunResponse</span><span class="o">.</span><span class="n">FromString</span><span class="p">,</span>
            <span class="n">options</span><span class="p">,</span>
            <span class="n">channel_credentials</span><span class="p">,</span>
            <span class="n">insecure</span><span class="p">,</span>
            <span class="n">call_credentials</span><span class="p">,</span>
            <span class="n">compression</span><span class="p">,</span>
            <span class="n">wait_for_ready</span><span class="p">,</span>
            <span class="n">timeout</span><span class="p">,</span>
            <span class="n">metadata</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h5 id="dispatch.sdk.v1.function_pb2_grpc.FunctionServiceServicer" class="doc doc-heading">
          <code>FunctionServiceServicer</code>


</h5>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code>object</code></p>

  
      <p>The FunctionService service is used to interface with programmable endpoints
exposing remote functions.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/sdk/v1/function_pb2_grpc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FunctionServiceServicer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The FunctionService service is used to interface with programmable endpoints</span>
<span class="sd">    exposing remote functions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">Run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run runs the function identified by the request, and returns a response</span>
<span class="sd">        that either contains a result when the function completed, or a poll</span>
<span class="sd">        directive and the associated coroutine state if the function was suspended.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">context</span><span class="o">.</span><span class="n">set_code</span><span class="p">(</span><span class="n">grpc</span><span class="o">.</span><span class="n">StatusCode</span><span class="o">.</span><span class="n">UNIMPLEMENTED</span><span class="p">)</span>
        <span class="n">context</span><span class="o">.</span><span class="n">set_details</span><span class="p">(</span><span class="s2">&quot;Method not implemented!&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Method not implemented!&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h6 id="dispatch.sdk.v1.function_pb2_grpc.FunctionServiceServicer.Run" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">Run</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

</h6>


  <div class="doc doc-contents ">
  
      <p>Run runs the function identified by the request, and returns a response
that either contains a result when the function completed, or a poll
directive and the associated coroutine state if the function was suspended.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/sdk/v1/function_pb2_grpc.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">Run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run runs the function identified by the request, and returns a response</span>
<span class="sd">    that either contains a result when the function completed, or a poll</span>
<span class="sd">    directive and the associated coroutine state if the function was suspended.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">context</span><span class="o">.</span><span class="n">set_code</span><span class="p">(</span><span class="n">grpc</span><span class="o">.</span><span class="n">StatusCode</span><span class="o">.</span><span class="n">UNIMPLEMENTED</span><span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">set_details</span><span class="p">(</span><span class="s2">&quot;Method not implemented!&quot;</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Method not implemented!&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h5 id="dispatch.sdk.v1.function_pb2_grpc.FunctionServiceStub" class="doc doc-heading">
          <code>FunctionServiceStub</code>


</h5>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code>object</code></p>

  
      <p>The FunctionService service is used to interface with programmable endpoints
exposing remote functions.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/sdk/v1/function_pb2_grpc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FunctionServiceStub</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The FunctionService service is used to interface with programmable endpoints</span>
<span class="sd">    exposing remote functions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor.</span>

<span class="sd">        Args:</span>
<span class="sd">            channel: A grpc.Channel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Run</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">unary_unary</span><span class="p">(</span>
            <span class="s2">&quot;/dispatch.sdk.v1.FunctionService/Run&quot;</span><span class="p">,</span>
            <span class="n">request_serializer</span><span class="o">=</span><span class="n">dispatch_dot_sdk_dot_v1_dot_function__pb2</span><span class="o">.</span><span class="n">RunRequest</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">,</span>
            <span class="n">response_deserializer</span><span class="o">=</span><span class="n">dispatch_dot_sdk_dot_v1_dot_function__pb2</span><span class="o">.</span><span class="n">RunResponse</span><span class="o">.</span><span class="n">FromString</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h6 id="dispatch.sdk.v1.function_pb2_grpc.FunctionServiceStub.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span></code>

</h6>


  <div class="doc doc-contents ">
  
      <p>Constructor.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>channel</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A grpc.Channel.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>dispatch/sdk/v1/function_pb2_grpc.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor.</span>

<span class="sd">    Args:</span>
<span class="sd">        channel: A grpc.Channel.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Run</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">unary_unary</span><span class="p">(</span>
        <span class="s2">&quot;/dispatch.sdk.v1.FunctionService/Run&quot;</span><span class="p">,</span>
        <span class="n">request_serializer</span><span class="o">=</span><span class="n">dispatch_dot_sdk_dot_v1_dot_function__pb2</span><span class="o">.</span><span class="n">RunRequest</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">,</span>
        <span class="n">response_deserializer</span><span class="o">=</span><span class="n">dispatch_dot_sdk_dot_v1_dot_function__pb2</span><span class="o">.</span><span class="n">RunResponse</span><span class="o">.</span><span class="n">FromString</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="dispatch.sdk.v1.poll_pb2" class="doc doc-heading">
          <code>poll_pb2</code>


</h4>

  <div class="doc doc-contents ">
  
      <p>Generated protocol buffer code.</p>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="dispatch.sdk.v1.poll_pb2_grpc" class="doc doc-heading">
          <code>poll_pb2_grpc</code>


</h4>

  <div class="doc doc-contents ">
  
      <p>Client and server classes corresponding to protobuf-defined services.</p>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="dispatch.sdk.v1.status_pb2" class="doc doc-heading">
          <code>status_pb2</code>


</h4>

  <div class="doc doc-contents ">
  
      <p>Generated protocol buffer code.</p>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="dispatch.sdk.v1.status_pb2_grpc" class="doc doc-heading">
          <code>status_pb2_grpc</code>


</h4>

  <div class="doc doc-contents ">
  
      <p>Client and server classes corresponding to protobuf-defined services.</p>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>


  </div>

  </div>

</div>


  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="dispatch.signature" class="doc doc-heading">
          <code>signature</code>


</h2>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="dispatch.signature.sign_request" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">sign_request</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">created</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Sign a request using HTTP Message Signatures.</p>
<p>The function adds three additional headers: Content-Digest,
Signature-Input, and Signature. See the following spec for more details:
https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-message-signatures</p>
<p>The signature covers the request method, the URL host and path, the
Content-Type header, and the request body. At this time, an ED25519
signature is generated with a hard-coded key ID of "default".</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>request</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="dispatch.signature.request.Request" href="#dispatch.signature.request.Request">Request</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The request to sign.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>key</code></td>
          <td>
                <code><span title="cryptography.hazmat.primitives.asymmetric.ed25519.Ed25519PrivateKey">Ed25519PrivateKey</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The Ed25519 private key to use to generate the signature.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>created</code></td>
          <td>
                <code><span title="datetime.datetime">datetime</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The times at which the signature is created.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>dispatch/signature/__init__.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sign_request</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Ed25519PrivateKey</span><span class="p">,</span> <span class="n">created</span><span class="p">:</span> <span class="n">datetime</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sign a request using HTTP Message Signatures.</span>

<span class="sd">    The function adds three additional headers: Content-Digest,</span>
<span class="sd">    Signature-Input, and Signature. See the following spec for more details:</span>
<span class="sd">    https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-message-signatures</span>

<span class="sd">    The signature covers the request method, the URL host and path, the</span>
<span class="sd">    Content-Type header, and the request body. At this time, an ED25519</span>
<span class="sd">    signature is generated with a hard-coded key ID of &quot;default&quot;.</span>

<span class="sd">    Args:</span>
<span class="sd">        request: The request to sign.</span>
<span class="sd">        key: The Ed25519 private key to use to generate the signature.</span>
<span class="sd">        created: The times at which the signature is created.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;signing request with </span><span class="si">%d</span><span class="s2"> byte body&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="p">))</span>
    <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Content-Digest&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generate_content_digest</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

    <span class="n">signer</span> <span class="o">=</span> <span class="n">HTTPMessageSigner</span><span class="p">(</span>
        <span class="n">signature_algorithm</span><span class="o">=</span><span class="n">ALGORITHM</span><span class="p">,</span>
        <span class="n">key_resolver</span><span class="o">=</span><span class="n">KeyResolver</span><span class="p">(</span><span class="n">key_id</span><span class="o">=</span><span class="n">DEFAULT_KEY_ID</span><span class="p">,</span> <span class="n">private_key</span><span class="o">=</span><span class="n">key</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">signer</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span>
        <span class="n">request</span><span class="p">,</span>
        <span class="n">key_id</span><span class="o">=</span><span class="n">DEFAULT_KEY_ID</span><span class="p">,</span>
        <span class="n">covered_component_ids</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">COVERED_COMPONENT_IDS</span><span class="p">),</span>
        <span class="n">created</span><span class="o">=</span><span class="n">created</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;dispatch&quot;</span><span class="p">,</span>
        <span class="n">include_alg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;signed request successfully&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="dispatch.signature.verify_request" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">verify_request</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">max_age</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Verify a request containing an HTTP Message Signature.</p>
<p>The function checks three additional headers: Content-Digest,
Signature-Input, and Signature. See the following spec for more details:
https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-message-signatures</p>
<p>The function checks signatures that cover at least the request method, the
URL host and path, the Content-Type header, and the request body (via the
Content-Digest header). At this time, signatures must use a hard-coded key
ID of "default".</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>request</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="dispatch.signature.request.Request" href="#dispatch.signature.request.Request">Request</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The request to verify.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>key</code></td>
          <td>
                <code><span title="cryptography.hazmat.primitives.asymmetric.ed25519.Ed25519PublicKey">Ed25519PublicKey</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The Ed25519 public key to use to verify the signature.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>max_age</code></td>
          <td>
                <code><span title="datetime.timedelta">timedelta</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The maximum age of the signature.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>dispatch/signature/__init__.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">verify_request</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Ed25519PublicKey</span><span class="p">,</span> <span class="n">max_age</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Verify a request containing an HTTP Message Signature.</span>

<span class="sd">    The function checks three additional headers: Content-Digest,</span>
<span class="sd">    Signature-Input, and Signature. See the following spec for more details:</span>
<span class="sd">    https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-message-signatures</span>

<span class="sd">    The function checks signatures that cover at least the request method, the</span>
<span class="sd">    URL host and path, the Content-Type header, and the request body (via the</span>
<span class="sd">    Content-Digest header). At this time, signatures must use a hard-coded key</span>
<span class="sd">    ID of &quot;default&quot;.</span>

<span class="sd">    Args:</span>
<span class="sd">        request: The request to verify.</span>
<span class="sd">        key: The Ed25519 public key to use to verify the signature.</span>
<span class="sd">        max_age: The maximum age of the signature.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;verifying request signature&quot;</span><span class="p">)</span>

    <span class="c1"># Verify embedded signatures.</span>
    <span class="n">key_resolver</span> <span class="o">=</span> <span class="n">KeyResolver</span><span class="p">(</span><span class="n">key_id</span><span class="o">=</span><span class="n">DEFAULT_KEY_ID</span><span class="p">,</span> <span class="n">public_key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
    <span class="n">verifier</span> <span class="o">=</span> <span class="n">HTTPMessageVerifier</span><span class="p">(</span>
        <span class="n">signature_algorithm</span><span class="o">=</span><span class="n">ALGORITHM</span><span class="p">,</span> <span class="n">key_resolver</span><span class="o">=</span><span class="n">key_resolver</span>
    <span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">verifier</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">max_age</span><span class="o">=</span><span class="n">max_age</span><span class="p">)</span>

    <span class="c1"># Check that at least one signature covers the required components.</span>
    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="n">covered_components</span> <span class="o">=</span> <span class="n">extract_covered_components</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">covered_components</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="n">COVERED_COMPONENT_IDS</span><span class="p">):</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;no signatures found that covered all required components (</span><span class="si">{</span><span class="n">COVERED_COMPONENT_IDS</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check that the Content-Digest header matches the body.</span>
    <span class="n">verify_content_digest</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Content-Digest&quot;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-module">



<h3 id="dispatch.signature.digest" class="doc doc-heading">
          <code>digest</code>


</h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h4 id="dispatch.signature.digest.generate_content_digest" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">generate_content_digest</span><span class="p">(</span><span class="n">body</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Returns a SHA-512 Content-Digest header, according to
https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-digest-headers-13</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/signature/digest.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_content_digest</span><span class="p">(</span><span class="n">body</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a SHA-512 Content-Digest header, according to</span>
<span class="sd">    https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-digest-headers-13</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>

    <span class="n">digest</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha512</span><span class="p">(</span><span class="n">body</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">http_sfv</span><span class="o">.</span><span class="n">Dictionary</span><span class="p">({</span><span class="s2">&quot;sha-512&quot;</span><span class="p">:</span> <span class="n">digest</span><span class="p">}))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="dispatch.signature.digest.verify_content_digest" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">verify_content_digest</span><span class="p">(</span><span class="n">digest_header</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Verify a SHA-256 or SHA-512 Content-Digest header matches a
request body.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/signature/digest.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">verify_content_digest</span><span class="p">(</span><span class="n">digest_header</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">body</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bytes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Verify a SHA-256 or SHA-512 Content-Digest header matches a</span>
<span class="sd">    request body.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">digest_header</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">digest_header</span> <span class="o">=</span> <span class="n">digest_header</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>

    <span class="n">parsed_header</span> <span class="o">=</span> <span class="n">http_sfv</span><span class="o">.</span><span class="n">Dictionary</span><span class="p">()</span>
    <span class="n">parsed_header</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">digest_header</span><span class="p">)</span>

    <span class="c1"># See https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-digest-headers-13#establish-hash-algorithm-registry</span>
    <span class="k">if</span> <span class="s2">&quot;sha-512&quot;</span> <span class="ow">in</span> <span class="n">parsed_header</span><span class="p">:</span>
        <span class="n">digest</span> <span class="o">=</span> <span class="n">parsed_header</span><span class="p">[</span><span class="s2">&quot;sha-512&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">expect_digest</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha512</span><span class="p">(</span><span class="n">body</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
    <span class="k">elif</span> <span class="s2">&quot;sha-256&quot;</span> <span class="ow">in</span> <span class="n">parsed_header</span><span class="p">:</span>
        <span class="n">digest</span> <span class="o">=</span> <span class="n">parsed_header</span><span class="p">[</span><span class="s2">&quot;sha-256&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">expect_digest</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">body</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;missing content digest&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">hmac</span><span class="o">.</span><span class="n">compare_digest</span><span class="p">(</span><span class="n">digest</span><span class="p">,</span> <span class="n">expect_digest</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;unexpected content digest&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="dispatch.signature.key" class="doc doc-heading">
          <code>key</code>


</h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="dispatch.signature.key.KeyResolver" class="doc doc-heading">
          <code>KeyResolver</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="http_message_signatures.HTTPSignatureKeyResolver">HTTPSignatureKeyResolver</span></code></p>

  
      <p>KeyResolver provides public and private keys.</p>
<p>At this time, multiple keys and/or key types are not supported.
Keys must be Ed25519 keys and have an ID of DEFAULT_KEY_ID.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/signature/key.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">KeyResolver</span><span class="p">(</span><span class="n">HTTPSignatureKeyResolver</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;KeyResolver provides public and private keys.</span>

<span class="sd">    At this time, multiple keys and/or key types are not supported.</span>
<span class="sd">    Keys must be Ed25519 keys and have an ID of DEFAULT_KEY_ID.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">public_key</span><span class="p">:</span> <span class="n">Ed25519PublicKey</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">private_key</span><span class="p">:</span> <span class="n">Ed25519PrivateKey</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">resolve_public_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key_id</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_id</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">public_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;public key &#39;</span><span class="si">{</span><span class="n">key_id</span><span class="si">}</span><span class="s2">&#39; not available&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">public_key</span>

    <span class="k">def</span> <span class="nf">resolve_private_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key_id</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_id</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">private_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;private key &#39;</span><span class="si">{</span><span class="n">key_id</span><span class="si">}</span><span class="s2">&#39; not available&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">private_key</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>



<div class="doc doc-object doc-function">



<h4 id="dispatch.signature.key.private_key_from_bytes" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">private_key_from_bytes</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Returns an Ed25519 private key from 32 raw bytes.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/signature/key.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">private_key_from_bytes</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Ed25519PrivateKey</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns an Ed25519 private key from 32 raw bytes.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Ed25519PrivateKey</span><span class="o">.</span><span class="n">from_private_bytes</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="dispatch.signature.key.private_key_from_pem" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">private_key_from_pem</span><span class="p">(</span><span class="n">pem</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Returns an Ed25519 private key given a PEM representation
and optional password.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/signature/key.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">private_key_from_pem</span><span class="p">(</span>
    <span class="n">pem</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Ed25519PrivateKey</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns an Ed25519 private key given a PEM representation</span>
<span class="sd">    and optional password.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pem</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">pem</span> <span class="o">=</span> <span class="n">pem</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">password</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>

    <span class="n">key</span> <span class="o">=</span> <span class="n">load_pem_private_key</span><span class="p">(</span><span class="n">pem</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">Ed25519PrivateKey</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unexpected private key type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">key</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="dispatch.signature.key.public_key_from_bytes" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">public_key_from_bytes</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Returns an Ed25519 public key from 32 raw bytes.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/signature/key.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">public_key_from_bytes</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Ed25519PublicKey</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns an Ed25519 public key from 32 raw bytes.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Ed25519PublicKey</span><span class="o">.</span><span class="n">from_public_bytes</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="dispatch.signature.key.public_key_from_pem" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">public_key_from_pem</span><span class="p">(</span><span class="n">pem</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Returns an Ed25519 public key given a PEM representation.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/signature/key.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">public_key_from_pem</span><span class="p">(</span><span class="n">pem</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Ed25519PublicKey</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns an Ed25519 public key given a PEM representation.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pem</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">pem</span> <span class="o">=</span> <span class="n">pem</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>

    <span class="n">key</span> <span class="o">=</span> <span class="n">load_pem_public_key</span><span class="p">(</span><span class="n">pem</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">Ed25519PublicKey</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unexpected public key type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">key</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="dispatch.signature.request" class="doc doc-heading">
          <code>request</code>


</h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="dispatch.signature.request.Request" class="doc doc-heading">
          <code>Request</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">

  
      <p>A framework-agnostic representation of an HTTP request.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/signature/request.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Request</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A framework-agnostic representation of an HTTP request.&quot;&quot;&quot;</span>

    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">headers</span><span class="p">:</span> <span class="n">CaseInsensitiveDict</span>
    <span class="n">body</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bytes</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>




  </div>

  </div>

</div>


  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="dispatch.status" class="doc doc-heading">
          <code>status</code>


</h2>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="dispatch.status.Status" class="doc doc-heading">
          <code>Status</code>


</h3>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code>int</code>, <code><span title="enum.Enum">Enum</span></code></p>

  
      <p>Enumeration of the possible values that can be used in the return status
of functions.</p>

            <details class="quote">
              <summary>Source code in <code>dispatch/status.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@enum</span><span class="o">.</span><span class="n">unique</span>
<span class="k">class</span> <span class="nc">Status</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Enumeration of the possible values that can be used in the return status</span>
<span class="sd">    of functions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">UNSPECIFIED</span> <span class="o">=</span> <span class="n">status_pb</span><span class="o">.</span><span class="n">STATUS_UNSPECIFIED</span>
    <span class="n">OK</span> <span class="o">=</span> <span class="n">status_pb</span><span class="o">.</span><span class="n">STATUS_OK</span>
    <span class="n">TIMEOUT</span> <span class="o">=</span> <span class="n">status_pb</span><span class="o">.</span><span class="n">STATUS_TIMEOUT</span>
    <span class="n">THROTTLED</span> <span class="o">=</span> <span class="n">status_pb</span><span class="o">.</span><span class="n">STATUS_THROTTLED</span>
    <span class="n">INVALID_ARGUMENT</span> <span class="o">=</span> <span class="n">status_pb</span><span class="o">.</span><span class="n">STATUS_INVALID_ARGUMENT</span>
    <span class="n">INVALID_RESPONSE</span> <span class="o">=</span> <span class="n">status_pb</span><span class="o">.</span><span class="n">STATUS_INVALID_RESPONSE</span>
    <span class="n">TEMPORARY_ERROR</span> <span class="o">=</span> <span class="n">status_pb</span><span class="o">.</span><span class="n">STATUS_TEMPORARY_ERROR</span>
    <span class="n">PERMANENT_ERROR</span> <span class="o">=</span> <span class="n">status_pb</span><span class="o">.</span><span class="n">STATUS_PERMANENT_ERROR</span>
    <span class="n">INCOMPATIBLE_STATE</span> <span class="o">=</span> <span class="n">status_pb</span><span class="o">.</span><span class="n">STATUS_INCOMPATIBLE_STATE</span>

    <span class="n">_proto</span><span class="p">:</span> <span class="n">status_pb</span><span class="o">.</span><span class="n">Status</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>



<div class="doc doc-object doc-function">



<h3 id="dispatch.status.register_error_type" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">register_error_type</span><span class="p">(</span><span class="n">error_type</span><span class="p">,</span> <span class="n">handler</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Register an error type, and a handler which derives a Status from
errors of this type.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/status.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">register_error_type</span><span class="p">(</span>
    <span class="n">error_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="ne">Exception</span><span class="p">],</span> <span class="n">handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="ne">Exception</span><span class="p">],</span> <span class="n">Status</span><span class="p">]</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Register an error type, and a handler which derives a Status from</span>
<span class="sd">    errors of this type.&quot;&quot;&quot;</span>
    <span class="n">_ERROR_TYPES</span><span class="p">[</span><span class="n">error_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">handler</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="dispatch.status.register_output_type" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">register_output_type</span><span class="p">(</span><span class="n">output_type</span><span class="p">,</span> <span class="n">handler</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Register an output type, and a handler which derives a Status from
outputs of this type.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/status.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">register_output_type</span><span class="p">(</span><span class="n">output_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Status</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Register an output type, and a handler which derives a Status from</span>
<span class="sd">    outputs of this type.&quot;&quot;&quot;</span>
    <span class="n">_OUTPUT_TYPES</span><span class="p">[</span><span class="n">output_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">handler</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="dispatch.status.status_for_error" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">status_for_error</span><span class="p">(</span><span class="n">error</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns a Status that corresponds to the specified error.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/status.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">status_for_error</span><span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Status</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a Status that corresponds to the specified error.&quot;&quot;&quot;</span>
    <span class="c1"># See if the error matches one of the registered types.</span>
    <span class="n">handler</span> <span class="o">=</span> <span class="n">_find_handler</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">_ERROR_TYPES</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">handler</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="c1"># If not, resort to standard error categorization.</span>
    <span class="c1">#</span>
    <span class="c1"># See https://docs.python.org/3/library/exceptions.html</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">Status</span><span class="o">.</span><span class="n">PERMANENT_ERROR</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Raise the exception and catch it so that the interpreter deals</span>
        <span class="c1"># with exception groups and chaining for us.</span>
        <span class="k">raise</span> <span class="n">error</span>
    <span class="k">except</span> <span class="ne">TimeoutError</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">Status</span><span class="o">.</span><span class="n">TIMEOUT</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">Status</span><span class="o">.</span><span class="n">INVALID_ARGUMENT</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">EOFError</span><span class="p">,</span> <span class="ne">InterruptedError</span><span class="p">,</span> <span class="ne">KeyboardInterrupt</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
        <span class="c1"># For OSError, we might want to categorize the values of errno to</span>
        <span class="c1"># determine whether the error is temporary or permanent.</span>
        <span class="c1">#</span>
        <span class="c1"># In general, permanent errors from the OS are rare because they tend to</span>
        <span class="c1"># be caused by invalid use of syscalls, which are unlikely at higher</span>
        <span class="c1"># abstraction levels.</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">Status</span><span class="o">.</span><span class="n">TEMPORARY_ERROR</span>
    <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">status</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="dispatch.status.status_for_output" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">status_for_output</span><span class="p">(</span><span class="n">output</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns a Status that corresponds to the specified output value.</p>

          <details class="quote">
            <summary>Source code in <code>dispatch/status.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">status_for_output</span><span class="p">(</span><span class="n">output</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Status</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a Status that corresponds to the specified output value.&quot;&quot;&quot;</span>
    <span class="c1"># See if the output value matches one of the registered types.</span>
    <span class="n">handler</span> <span class="o">=</span> <span class="n">_find_handler</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">_OUTPUT_TYPES</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">handler</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Status</span><span class="o">.</span><span class="n">OK</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>


  </div>

  </div>

</div>







  
  




  



                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": ".", "features": [], "search": "assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
    
  </body>
</html>